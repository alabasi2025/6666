import { EngineInfo } from "./EngineInfoDialog";

type PageInfoMatcher = {
  match: (path: string) => boolean;
  info: EngineInfo;
};

const DEFAULT_INFO: EngineInfo = {
  title: "معلومات الشاشة",
  description: "وصف هذه الشاشة سيُضاف قريباً.",
  process: "يتم العمل على توثيق هذه الشاشة بالكامل.",
  mechanism: "لا توجد تفاصيل تقنية متاحة حالياً.",
  relatedScreens: [
    { name: "الرئيسية", path: "/dashboard", description: "العودة لواجهة التحكم الرئيسية" },
  ],
  businessLogic: "سيتم توثيق منطق العمل لهذه الشاشة قريباً.",
};

const PAGE_INFO: PageInfoMatcher[] = [
  {
    match: (path) => path === "/",
    info: {
      title: "الصفحة الرئيسية",
      description: "تعريف بالنظام وروابط سريعة لتسجيل الدخول أو البدء.",
      process: `1) استعراض المزايا الأساسية والإحصاءات العامة
2) استخدام الأزرار للانتقال لتسجيل الدخول أو إنشاء حساب
3) الاطلاع على الأقسام (المزايا، الفوائد، الأسئلة المتكررة إن وجدت) ثم اتخاذ قرار الدخول`,
      mechanism: `- الصفحة ثابتة ولا تتطلب بيانات جلسة
- الأزرار تستعمل التوجيه إلى /login أو فتح رابط البدء
- يمكن لاحقاً ربط البطاقات بمصادر بيانات عامة`,
      relatedScreens: [
        { name: "تسجيل الدخول", path: "/login", description: "الدخول للنظام" },
        { name: "لوحة التحكم", path: "/dashboard", description: "الانتقال بعد تسجيل الدخول" },
      ],
      businessLogic: `لا يوجد منطق أعمال؛ الغرض هو العرض التعريفي والتوجيه لرحلة المستخدم (تسجيل/دخول).`,
    },
  },
  {
    match: (path) => path.startsWith("/login"),
    info: {
      title: "تسجيل الدخول",
      description: "الدخول للنظام باستخدام رقم الهاتف وكلمة المرور.",
      process: `1) إدخال رقم الهاتف
2) إدخال كلمة المرور (أو تركها فارغة في الوضع التجريبي حيث يتم استخدام قيمة افتراضية)
3) إرسال النموذج للتحقق من الاعتماد
4) عند النجاح: تحويل تلقائي للوحة التحكم /dashboard
5) عند الفشل: إظهار رسالة خطأ`,
      mechanism: `- النموذج يستدعي tRPC: auth.loginWithPhone
- يتم حفظ الهاتف/كلمة المرور في localStorage لتيسير التعبئة التلقائية
- عرض حالة التحميل وأخطاء الخادم عبر toast`,
      relatedScreens: [
        { name: "الرئيسية", path: "/", description: "العودة للصفحة التعريفية" },
        { name: "التسجيل", path: "/register", description: "إنشاء حساب جديد" },
      ],
      businessLogic: `التحقق من الهوية وإصدار جلسة مصادقة تتيح الوصول لجميع وحدات النظام حسب الصلاحيات.`,
    },
  },
  {
    match: (path) => path.startsWith("/register"),
    info: {
      title: "إنشاء حساب جديد",
      description: "تعبئة بيانات المستخدم لإنشاء حساب والدخول للنظام.",
      process: `1) إدخال الاسم، الهاتف، البريد (اختياري)، كلمة المرور وتأكيدها
2) التحقق من اكتمال الحقول وصحة كلمة المرور والتطابق
3) إرسال الطلب لإنشاء الحساب
4) عند النجاح: توجيه إلى شاشة تسجيل الدخول`,
      mechanism: `- استدعاء tRPC: auth.register لإنشاء المستخدم
- التحقق من صحة الطول والتطابق داخل الواجهة قبل الإرسال
- استخدام toast لعرض الأخطاء أو النجاح`,
      relatedScreens: [
        { name: "تسجيل الدخول", path: "/login", description: "الدخول للحساب بعد الإنشاء" },
        { name: "الرئيسية", path: "/", description: "معلومات عامة عن النظام" },
      ],
      businessLogic: `التحقق من تميّز الهاتف وصلاحية كلمة المرور ثم إنشاء المستخدم وتمكينه من الدخول اللاحق.`,
    },
  },
  // Organization
  {
    match: (path) => path === "/dashboard/organization/businesses",
    info: {
      title: "الشركات",
      description: "إدارة تعريف الشركات والكود والبيانات التعريفية.",
      process: `1) عند تحميل الصفحة:
   - يتم استدعاء tRPC: organization.businesses.list لجلب جميع الشركات
   - يتم عرض الشركات في جدول مع ترقيم تلقائي (pagination)
   - يتم تطبيق فلاتر البحث حسب الاسم أو الكود إن وجدت

2) إضافة شركة جديدة:
   - النقر على زر "إضافة شركة"
   - فتح نموذج يحتوي على: الاسم (مطلوب)، الكود (فريد)، رقم السجل التجاري، العنوان، الهاتف، البريد الإلكتروني
   - التحقق من عدم تكرار الكود قبل الحفظ
   - إرسال البيانات عبر tRPC: organization.businesses.create
   - عند النجاح: إغلاق النموذج وتحديث القائمة تلقائياً
   - عند الفشل: عرض رسالة خطأ توضح السبب (مثل: الكود موجود مسبقاً)

3) تعديل شركة:
   - النقر على زر التعديل في صف الشركة
   - تحميل البيانات الحالية في النموذج
   - تعديل الحقول المطلوبة (مع الحفاظ على الكود كمعرّف ثابت)
   - حفظ التغييرات عبر tRPC: organization.businesses.update
   - تحديث القائمة فوراً

4) تعطيل/تفعيل شركة:
   - تغيير حالة الشركة (نشط/غير نشط) عبر toggle
   - عند التعطيل: يتم التحقق من عدم وجود فروع أو محطات نشطة مرتبطة
   - إذا وُجدت كيانات مرتبطة: يتم عرض تحذير وطلب نقلها أولاً
   - عند التأكيد: تحديث الحالة عبر API

5) ربط الشركة بالوحدات:
   - عند إنشاء فرع أو محطة: يتم اختيار الشركة من قائمة منسدلة
   - يتم التحقق من أن الشركة نشطة قبل السماح بالربط`,
      mechanism: `- استعلام tRPC: organization.businesses.list.useQuery() مع:
  * معاملات: businessId (اختياري للفلترة)، activeOnly (افتراضي: false)
  * إرجاع: مصفوفة من الشركات مع: id, name, code, registrationNumber, address, phone, email, active, createdAt, updatedAt
  * حالة التحميل: يتم عرض spinner أثناء الجلب
  * حالة الخطأ: عرض رسالة خطأ مع إمكانية إعادة المحاولة

- نموذج الإنشاء/التعديل:
  * استخدام React Hook Form للتحكم في الحقول
  * التحقق من صحة البيانات: الاسم (مطلوب، 3-100 حرف)، الكود (مطلوب، فريد، 2-20 حرف)
  * التحقق من صحة البريد الإلكتروني (إن وُجد) باستخدام regex
  * التحقق من صحة رقم الهاتف (إن وُجد) باستخدام regex محلي

- عملية الحفظ:
  * tRPC mutation: organization.businesses.create أو update
  * معاملات: جميع حقول النموذج + businessId (للتعديل)
  * معالجة الاستجابة:
    - النجاح: toast.success + إغلاق النموذج + refetch للقائمة
    - الفشل: toast.error مع رسالة الخطأ من الخادم

- الترقيم والبحث:
  * استخدام usePagination hook (إن وُجد) أو state محلي
  * البحث: filter على القائمة المحملة أو استعلام جديد مع معامل search
  * الترتيب: حسب الاسم أو تاريخ الإنشاء (قابل للتعديل)`,
      relatedScreens: [
        { name: "الفروع", path: "/dashboard/organization/branches", description: "ربط الفروع بالشركة - يجب اختيار الشركة عند إنشاء فرع جديد" },
        { name: "المحطات", path: "/dashboard/organization/stations", description: "إلحاق المحطات بالشركة - يتم اختيار الشركة والفرع عند إنشاء محطة" },
        { name: "المستخدمين", path: "/dashboard/users", description: "تعيين المستخدمين للشركة - يحدد نطاق الصلاحيات" },
        { name: "المحاسبة", path: "/dashboard/accounting/chart-of-accounts", description: "ربط الحسابات بالشركة - كل شركة لها شجرة حسابات مستقلة" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) التدرج الهرمي:
   - الشركة هي المستوى الأعلى في الهيكل التنظيمي
   - لا يمكن حذف شركة مرتبطة بفروع أو محطات نشطة
   - عند تعطيل شركة: يتم تعطيل جميع الفروع والمحطات المرتبطة تلقائياً (cascade)

2) الكود الفريد:
   - كل شركة يجب أن يكون لها كود فريد على مستوى النظام
   - الكود لا يمكن تغييره بعد الإنشاء (immutable)
   - يتم استخدام الكود كمعرّف في التكاملات والتصدير

3) العزل المالي:
   - كل شركة لها شجرة حسابات مستقلة
   - التقارير المالية تُفلتر حسب الشركة
   - لا يمكن ربط حركة مالية بين شركتين مباشرة (يحتاج نظام وسيط)

4) الصلاحيات:
   - المستخدم يمكن أن يكون مرتبطاً بشركة واحدة أو أكثر
   - الصلاحيات تُطبق على نطاق الشركة المحددة
   - المدير العام يمكنه الوصول لجميع الشركات

5) التكامل:
   - عند إنشاء شركة: يتم إنشاء شجرة حسابات افتراضية تلقائياً
   - يتم إنشاء حسابات وسيطة للربط مع الأنظمة الأخرى (إن وُجد نظام وسيط)
   - يتم إعداد التقويم المالي الافتراضي (12 شهر من يناير)`,
    },
  },
  {
    match: (path) => path === "/dashboard/organization/branches",
    info: {
      title: "الفروع",
      description: "إدارة الفروع وتبعيتها للشركات.",
      process: `1) اختيار الشركة
2) إنشاء الفرع مع البيانات الأساسية
3) تحرير أو إيقاف الفرع
4) ربط الفرع بالمحطات والأصول لاحقاً`,
      mechanism: `- جلب الفروع مفلترة حسب الشركة
- نماذج CRUD عبر tRPC
- استخدام فلاتر بحث وترقيم في الجدول`,
      relatedScreens: [
        { name: "الشركات", path: "/dashboard/organization/businesses", description: "مرجع التبعية" },
        { name: "المحطات", path: "/dashboard/organization/stations", description: "إسناد المحطات للفروع" },
      ],
      businessLogic: "الفروع تضبط النطاق الجغرافي والإداري الذي تُسند إليه المحطات والأصول والمستخدمون.",
    },
  },
  {
    match: (path) => path === "/dashboard/organization/stations",
    info: {
      title: "المحطات",
      description: "إدارة المحطات وربطها بالفروع والشركات.",
      process: `1) اختيار الشركة/الفرع
2) إضافة محطة مع الإحداثيات والأنواع
3) تحرير حالة المحطة ونطاق خدمتها
4) ربطها بالأصول التشغيلية لاحقاً`,
      mechanism: `- جلب المحطات مع فلاتر فرع/شركة
- نماذج إدخال ترسل عبر tRPC
- عرض في جدول مع حالة وتواريخ`,
      relatedScreens: [
        { name: "المخطط التشغيلي", path: "/dashboard/operations/structure", description: "تضمين المحطات في الهيكل" },
        { name: "الأصول", path: "/dashboard/assets", description: "إلحاق الأصول بالمحطة" },
      ],
      businessLogic: "المحطة عقدة تشغيلية رئيسية تربط الشبكة والأصول والفرق الميدانية بالسياق الجغرافي.",
    },
  },
  // Operations
  {
    match: (path) => path === "/dashboard/operations/structure",
    info: {
      title: "هيكل المحطات",
      description: "عرض وتعديل الهيكل التشغيلي للمحطات.",
      process: `1) استعراض الهيكل الشجري للمحطات
2) إضافة/تحرير عقدة تشغيلية
3) ربط العقد بالأصول أو الفروع`,
      mechanism: `- تحميل البيانات الهيكلية في قائمة/شجرة
- عمليات CRUD عبر API مع إعادة تحميل جزئي`,
      relatedScreens: [
        { name: "المحطات", path: "/dashboard/organization/stations", description: "مصدر بيانات المحطات" },
        { name: "الأصول", path: "/dashboard/assets", description: "ربط الأصول بالعقد التشغيلية" },
      ],
      businessLogic: "يحفظ تناسق الشبكة التشغيلية ويؤثر على التوزيع والصيانة والتقارير.",
    },
  },
  {
    match: (path) => path === "/dashboard/operations/network",
    info: {
      title: "شبكة التوزيع",
      description: "إدارة خطوط وشبكة التوزيع.",
      process: `1) استعراض مكونات الشبكة
2) إضافة/تحرير عقد وروابط
3) تعيين مواقع وقدرات للخطوط`,
      mechanism: `- جداول/بطاقات تعرض العقد والروابط
- عمليات حفظ عبر tRPC مع التحقق`,
      relatedScreens: [
        { name: "المخطط التشغيلي", path: "/dashboard/operations/structure", description: "تطابق الهيكل مع الشبكة" },
        { name: "المهام الميدانية", path: "/dashboard/fieldops/operations", description: "توجيه الأعمال بحسب الشبكة" },
      ],
      businessLogic: "النمذجة الصحيحة للشبكة ضرورية للتوزيع، الأعطال، والتقارير التشغيلية.",
    },
  },
  {
    match: (path) => path === "/dashboard/operations/misc-assets",
    info: {
      title: "الأصول المتنوعة",
      description: "إدارة أصول تشغيلية غير مصنفة.",
      process: `1) تسجيل أصل متنوع مع النوع والموقع
2) تتبع حالته أو نقله
3) ربطه بالهيكل أو الصيانة عند الحاجة`,
      mechanism: `- جدول بأصول متنوعة مع مرشحات
- نماذج CRUD عبر API`,
      relatedScreens: [
        { name: "الأصول", path: "/dashboard/assets", description: "إدارة فئات الأصول الأساسية" },
        { name: "الصيانة", path: "/dashboard/maintenance/work-orders", description: "إنشاء أوامر عمل للأصل" },
      ],
      businessLogic: "يتيح تتبع عناصر داعمة للشبكة لا تندرج في فئات الأصول الرئيسية.",
    },
  },
  // Users
  {
    match: (path) => path === "/dashboard/users",
    info: {
      title: "المستخدمين",
      description: "إدارة حسابات المستخدمين وتفعيلهم.",
      process: `1) إضافة مستخدم مع بيانات الاتصال والدور
2) تفعيل/إيقاف المستخدم
3) تحديث بيانات الوصول`,
      mechanism: `- جلب المستخدمين عبر tRPC مع ترقيم
- نماذج إضافة/تعديل؛ حفظ عبر API
- عرض شارات الحالة`,
      relatedScreens: [
        { name: "الأدوار والصلاحيات", path: "/dashboard/users/roles", description: "ضبط الصلاحيات" },
        { name: "الإعدادات", path: "/dashboard/settings", description: "سياسات الوصول العامة" },
      ],
      businessLogic: "ضمان التحكم في صلاحيات الوصول وربط المستخدمين بالأدوار المناسبة.",
    },
  },
  {
    match: (path) => path === "/dashboard/users/roles",
    info: {
      title: "الأدوار والصلاحيات",
      description: "تعريف الأدوار وتوزيع الصلاحيات.",
      process: `1) إنشاء دور جديد
2) تعيين الأذونات (قراءة/إنشاء/تعديل/حذف) للوحدات
3) ربط المستخدمين بالأدوار`,
      mechanism: `- نماذج أدوار مع مصفوفة صلاحيات
- حفظ عبر API وتحديث فوري`,
      relatedScreens: [
        { name: "المستخدمين", path: "/dashboard/users", description: "تطبيق الدور على المستخدم" },
      ],
      businessLogic: "الأدوار تتحكم في الوصول لكل وحدة، ما يضمن الامتثال الأمني والحوكمة.",
    },
  },
  // Accounting
  {
    match: (path) => path === "/dashboard/accounting/chart-of-accounts",
    info: {
      title: "شجرة الحسابات",
      description: "إدارة الحسابات الرئيسية والفرعية.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: accounting.accounts.tree.useQuery({ businessId })
   - جلب الشجرة الكاملة للحسابات مع المستويات الهرمية
   - عرض الشجرة في مكون TreeView مع إمكانية التوسيع/الطي
   - عرض لكل حساب: الكود، الاسم، النوع، الرصيد الحالي، الحالة
   - تطبيق فلاتر حسب النوع أو الحالة

2) إضافة حساب رئيسي:
   - النقر على "إضافة حساب رئيسي"
   - فتح نموذج يحتوي على:
     * الكود (مطلوب - يجب أن يكون فريداً، مثل: 1، 2، 3...)
     * الاسم (مطلوب - مثل: الأصول، الخصوم، الإيرادات)
     * النوع (مطلوب - أصول/خصوم/إيرادات/مصروفات/حقوق ملكية)
     * التصنيف (اختياري - تصنيف إضافي داخل النوع)
     * الحساب الرئيسي (لا يوجد - لأنه حساب رئيسي)
     * الحالة (افتراضي: نشط)
   - التحقق من:
     * عدم تكرار الكود
     * أن الكود يتبع نظام الترقيم (1-9 للحسابات الرئيسية)
     * أن الاسم فريد داخل نفس النوع
   - حفظ الحساب عبر tRPC: accounting.accounts.create
   - تحديث الشجرة تلقائياً

3) إضافة حساب فرعي:
   - النقر على حساب رئيسي ثم "إضافة حساب فرعي"
   - فتح نموذج مشابه ولكن:
     * الكود: يجب أن يبدأ بكود الحساب الرئيسي (مثل: 1.1، 1.2...)
     * الحساب الرئيسي: محدد مسبقاً (الحساب المحدد)
   - التحقق من:
     * أن الكود يتبع التسلسل الصحيح (1.1، 1.2، 1.3...)
     * أن الكود فريد على مستوى النظام
   - حفظ الحساب الفرعي
   - يمكن إضافة مستويات فرعية متعددة (1.1.1، 1.1.2...)

4) تعديل حساب:
   - النقر على حساب في الشجرة ثم "تعديل"
   - يمكن تعديل:
     * الاسم (مع التحقق من عدم التكرار)
     * التصنيف
     * الحالة (نشط/معطل)
   - لا يمكن تعديل:
     * الكود (immutable بعد الإنشاء)
     * النوع (يحتاج حذف وإنشاء جديد)
     * الحساب الرئيسي (يحتاج نقل)
   - حفظ التعديلات عبر tRPC: accounting.accounts.update

5) نقل حساب:
   - تغيير تبعية حساب فرعي لحساب رئيسي آخر
   - النقر على "نقل" ثم اختيار الحساب الرئيسي الجديد
   - التحقق من:
     * أن الحساب الجديد من نفس النوع
     * أن الحساب لا يحتوي على حركات (أو نقل الحركات معه)
   - تحديث الكود تلقائياً ليتوافق مع الحساب الرئيسي الجديد
   - حفظ النقل عبر tRPC: accounting.accounts.move

6) تعطيل/تفعيل حساب:
   - النقر على toggle الحالة
   - عند التعطيل:
     * لا يمكن استخدام الحساب في قيود جديدة
     * القيود القديمة تبقى كما هي
     * يتم عرض تحذير إذا كان الحساب يحتوي على أرصدة
   - عند التفعيل: يمكن استخدام الحساب مرة أخرى

7) عرض تفاصيل الحساب:
   - النقر على حساب في الشجرة
   - عرض:
     * المعلومات الأساسية
     * الحسابات الفرعية (إن وُجدت)
     * الرصيد الحالي (مدين/دائن)
     * عدد الحركات المرتبطة
     * آخر حركة`,
      mechanism: `- استعلام الشجرة:
  * tRPC: accounting.accounts.tree.useQuery({ businessId })
  * الإرجاع: Account[] مع هيكل شجري (parent-child)
  * Account type: { id, code, name, type, category, parentId, level, balance, status, children?, ... }
  * التحديث التلقائي: refetch عند إضافة/تعديل حساب

- عرض الشجرة:
  * استخدام مكون TreeView (مثل: react-treeview أو shadcn/ui Tree)
  * توسيع/طي العقد
  * بحث في الشجرة (filter حسب الاسم أو الكود)
  * ترتيب حسب الكود أو الاسم

- نموذج الحساب:
  * استخدام React Hook Form مع التحقق:
    - code: required, unique, pattern(/^[0-9]+(\.[0-9]+)*$/)
    - name: required, minLength(3), maxLength(200)
    - type: required, enum(['assets', 'liabilities', 'revenue', 'expenses', 'equity'])
    - parentId: optional (null للحسابات الرئيسية)
  * التحقق من الكود:
    - للحسابات الرئيسية: يجب أن يكون رقم واحد (1-9)
    - للحسابات الفرعية: يجب أن يبدأ بكود الحساب الرئيسي
    - tRPC: accounting.accounts.checkCode({ code, businessId })
  * جلب الحسابات الرئيسية:
    - عند إضافة حساب فرعي: جلب قائمة الحسابات الرئيسية من نفس النوع
    - tRPC: accounting.accounts.list({ businessId, type, level: 1 })

- عمليات CRUD:
  * Create: accounting.accounts.create.mutate({ businessId, ...formData })
  * Update: accounting.accounts.update.mutate({ id, ...formData })
  * Delete: accounting.accounts.delete.mutate({ id }) - soft delete (تعطيل)
  * Move: accounting.accounts.move.mutate({ id, newParentId })
  * معالجة الأخطاء: try-catch مع toast.error

- حساب الرصيد:
  * الرصيد = مجموع الحركات المدينة - مجموع الحركات الدائنة
  * يتم حساب الرصيد تلقائياً عند جلب الحساب
  * للحسابات الرئيسية: الرصيد = مجموع أرصدة الحسابات الفرعية

- التحقق من الاستخدام:
  * قبل حذف/تعطيل حساب: التحقق من وجود حركات مرتبطة
  * tRPC: accounting.accounts.checkUsage({ accountId })
  * إذا وُجدت حركات: عرض تحذير مع خيار نقل الحركات`,
      relatedScreens: [
        { name: "القيود اليومية", path: "/dashboard/accounting/journal-entries", description: "استخدام الحسابات في القيود - يجب أن تكون الحسابات نشطة" },
        { name: "دفتر الأستاذ", path: "/dashboard/accounting/general-ledger", description: "ترحيل الحركات للحسابات - يتم عرض الرصيد لكل حساب" },
        { name: "ميزان المراجعة", path: "/dashboard/accounting/trial-balance", description: "التحقق من توازن الحسابات - يعتمد على الشجرة" },
        { name: "التقارير المالية", path: "/dashboard/reports/financial", description: "استخدام الحسابات في التقارير - يتم تجميع البيانات حسب الشجرة" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) الهيكل الهرمي:
   - الحسابات الرئيسية: المستوى الأول (1، 2، 3...)
   - الحسابات الفرعية: المستوى الثاني (1.1، 1.2...)
   - يمكن إضافة مستويات فرعية متعددة (1.1.1، 1.1.2...)
   - الحد الأقصى للمستويات: 5 مستويات (قابل للتعديل)

2) نظام الترقيم:
   - الحسابات الرئيسية: أرقام من 1-9 (أو أكثر حسب الحاجة)
   - الحسابات الفرعية: تبدأ بكود الحساب الرئيسي + نقطة + رقم
   - مثال: 1 (أصول)، 1.1 (أصول متداولة)، 1.1.1 (نقدية)

3) أنواع الحسابات:
   - أصول: ما تملكه الشركة (نقدية، بنوك، أصول ثابتة...)
   - خصوم: ما تدين به الشركة (دائنين، قروض...)
   - إيرادات: الدخل (مبيعات، خدمات...)
   - مصروفات: التكاليف (رواتب، إيجار...)
   - حقوق ملكية: رأس المال والأرباح المحتجزة

4) القواعد المحاسبية:
   - الأصول والخصوم: رصيد مدين = زيادة، رصيد دائن = نقصان
   - الإيرادات: رصيد دائن = زيادة، رصيد مدين = نقصان
   - المصروفات: رصيد مدين = زيادة، رصيد دائن = نقصان

5) الحسابات الرئيسية الافتراضية:
   - عند إنشاء شركة جديدة: يتم إنشاء شجرة حسابات افتراضية تلقائياً
   - الشجرة الافتراضية تحتوي على الحسابات الأساسية:
     * 1: الأصول
     * 2: الخصوم
     * 3: حقوق الملكية
     * 4: الإيرادات
     * 5: المصروفات

6) الحسابات الفرعية:
   - يمكن إضافة حسابات فرعية تحت أي حساب رئيسي
   - الحسابات الفرعية ترث نوع الحساب الرئيسي
   - الرصيد الإجمالي = مجموع أرصدة الحسابات الفرعية

7) التعطيل والحذف:
   - لا يمكن حذف حساب يحتوي على حركات
   - يمكن تعطيل حساب (لا يمكن استخدامه في قيود جديدة)
   - عند تعطيل حساب رئيسي: يتم تعطيل جميع الحسابات الفرعية تلقائياً

8) النقل:
   - يمكن نقل حساب فرعي من حساب رئيسي لآخر
   - يجب أن يكون الحسابان من نفس النوع
   - يتم تحديث الكود تلقائياً

9) التقارير:
   - الشجرة تُستخدم في:
     * ميزان المراجعة
     * القوائم المالية
     * تقارير الأرصدة
   - يتم تجميع البيانات حسب المستوى الهرمي`,
    },
  },
  {
    match: (path) => path === "/dashboard/accounting/journal-entries",
    info: {
      title: "القيود اليومية",
      description: "تسجيل القيود يدويًا أو مراجعتها.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: accounting.journalEntries.list.useQuery() مع معاملات:
     * businessId (مطلوب)
     * dateFrom, dateTo (للفلترة حسب التاريخ)
     * accountId (اختياري - للفلترة حسب الحساب)
     * status (اختياري - مسودة/مرحّل/ملغي)
     * page, limit (للترقيم)
   - عرض القيود في جدول مع أعمدة: الرقم، التاريخ، الوصف، المبلغ، الحالة
   - تطبيق فلاتر متعددة
   - عرض ملخص: إجمالي القيود، المبلغ الإجمالي

2) إنشاء قيد جديد:
   - النقر على "إضافة قيد"
   - فتح نموذج يحتوي على:
     أ) البيانات الأساسية:
        * التاريخ (مطلوب - افتراضي: اليوم)
        * الوصف/المرجع (مطلوب - وصف القيد)
        * المرجع الخارجي (اختياري - رقم فاتورة، عقد...)
     ب) أسطر القيد:
        * إضافة سطر مدين:
          - اختيار الحساب (مطلوب - من قائمة الحسابات النشطة)
          - إدخال المبلغ (مطلوب - يجب أن يكون > 0)
          - اختيار المركز (اختياري - فرع، محطة، قسم...)
          - إدخال وصف السطر (اختياري)
        * إضافة سطر دائن:
          - نفس الحقول
        * يمكن إضافة عدة أسطر مدين وعدة أسطر دائن
     ج) التحقق من التوازن:
        * مجموع المدين يجب يساوي مجموع الدائن
        * إذا لم يتوازن: عرض رسالة خطأ ومنع الحفظ
        * عرض الفرق (إن وُجد)
   - التحقق من:
     * أن جميع الحسابات نشطة
     * أن المبالغ > 0
     * أن التاريخ ليس في المستقبل (إلا بصلاحية خاصة)
   - حفظ القيد عبر tRPC: accounting.journalEntries.create
   - عند النجاح: إغلاق النموذج وتحديث القائمة

3) ترحيل القيد:
   - القيود تُنشأ بحالة "مسودة" أولاً
   - النقر على "ترحيل" لتفعيل القيد
   - عند الترحيل:
     * التحقق من التوازن مرة أخرى
     * تحديث أرصدة الحسابات
     * إنشاء حركات في دفتر الأستاذ
     * تحديث حالة القيد إلى "مرحّل"
   - لا يمكن تعديل قيد مرحّل (يحتاج إلغاء الترحيل أولاً)

4) تعديل قيد مسودة:
   - النقر على قيد بحالة "مسودة"
   - تعديل أي من الحقول
   - التحقق من التوازن بعد التعديل
   - حفظ التعديلات

5) إلغاء قيد:
   - يمكن إلغاء قيد مرحّل (مع صلاحية خاصة)
   - النقر على "إلغاء"
   - إدخال سبب الإلغاء (مطلوب)
   - عند الإلغاء:
     * عكس الحركات في دفتر الأستاذ
     * تحديث أرصدة الحسابات
     * تحديث حالة القيد إلى "ملغي"

6) نسخ قيد:
   - من قيد موجود: النقر على "نسخ"
   - فتح النموذج مع البيانات المنسوخة
   - تعديل التاريخ والمبالغ حسب الحاجة
   - حفظ كقيد جديد

7) عرض تفاصيل القيد:
   - النقر على رقم القيد
   - عرض:
     * البيانات الأساسية
     * جميع الأسطر (مدين/دائن)
     * الحالة والترحيل
     * سجل التعديلات (إن وُجد)`,
      mechanism: `- استعلام القيود:
  * tRPC: accounting.journalEntries.list.useQuery({ businessId, filters })
  * الإرجاع: { entries: JournalEntry[], total: number, summary: { totalAmount, postedCount } }
  * JournalEntry type: { id, number, date, description, reference, status, totalDebit, totalCredit, lines: EntryLine[], ... }
  * EntryLine type: { id, accountId, debit, credit, centerId, description }
  * التحديث التلقائي: refetch عند إضافة/ترحيل قيد

- نموذج القيد:
  * استخدام React Hook Form مع array fields للأسطر
  * إضافة/حذف أسطر ديناميكياً
  * التحقق من:
    - date: required, date format, not in future (إلا بصلاحية)
    - description: required, minLength(5), maxLength(500)
    - lines: array, minLength(2) (يجب أن يكون هناك سطر مدين وسطر دائن على الأقل)
    - لكل سطر:
      * accountId: required
      * debit أو credit: required, number > 0 (يجب أن يكون أحدهما فقط)
      * centerId: optional
  * التحقق من التوازن:
    - مجموع debit = مجموع credit
    - يتم التحقق في الوقت الفعلي أثناء الإدخال
    - عرض الفرق إذا لم يتوازن

- عمليات CRUD:
  * Create: accounting.journalEntries.create.mutate({ businessId, date, description, lines })
  * Update: accounting.journalEntries.update.mutate({ id, ...data }) - فقط للقيود المسودة
  * Delete: accounting.journalEntries.delete.mutate({ id }) - soft delete (إلغاء)
  * Post: accounting.journalEntries.post.mutate({ id }) - ترحيل القيد
  * Unpost: accounting.journalEntries.unpost.mutate({ id, reason }) - إلغاء الترحيل
  * معالجة الأخطاء: try-catch مع toast.error

- الترحيل:
  * عند الترحيل:
    1) التحقق من التوازن
    2) إنشاء حركات في جدول ledger_entries:
       - لكل سطر: إنشاء حركة مع accountId, debit, credit, centerId
    3) تحديث أرصدة الحسابات:
       - account.balance += debit - credit
    4) تحديث حالة القيد إلى "posted"
  * tRPC: accounting.journalEntries.post.mutate({ id })
  * معالجة الأخطاء: إذا فشل الترحيل، يتم rollback جميع التغييرات

- إلغاء الترحيل:
  * عكس جميع الحركات:
    - لكل حركة: إنشاء حركة معاكسة (debit ↔ credit)
  * تحديث أرصدة الحسابات
  * تحديث حالة القيد إلى "draft"

- رقم القيد:
  * يتم توليد رقم تلقائي: JE-YYYYMMDD-XXXXX
  * JE = Journal Entry
  * YYYYMMDD = التاريخ
  * XXXXX = رقم تسلسلي`,
      relatedScreens: [
        { name: "شجرة الحسابات", path: "/dashboard/accounting/chart-of-accounts", description: "اختيار الحسابات - يجب أن تكون الحسابات نشطة" },
        { name: "دفتر الأستاذ", path: "/dashboard/accounting/general-ledger", description: "عرض الحركات المرحّلة - يتم إنشاء حركات تلقائياً عند الترحيل" },
        { name: "ميزان المراجعة", path: "/dashboard/accounting/trial-balance", description: "التحقق من التوازن - يعتمد على القيود المرحّلة" },
        { name: "محرك القيود", path: "/dashboard/engines/auto-journal", description: "إنشاء قيود تلقائية - يتم إنشاء قيود من العمليات الأخرى" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) مبدأ القيد المزدوج:
   - كل قيد يجب أن يحتوي على سطر مدين وسطر دائن على الأقل
   - مجموع المدين = مجموع الدائن (إجباري)
   - لا يمكن حفظ قيد غير متوازن

2) دورة حياة القيد:
   - مسودة: تم إنشاء القيد ولكن لم يتم ترحيله
   - مرحّل: تم ترحيل القيد وتحديث الأرصدة
   - ملغي: تم إلغاء القيد (تم عكس الحركات)

3) الترحيل:
   - القيود تُنشأ كمسودة أولاً (للمراجعة)
   - بعد المراجعة: يتم ترحيل القيد
   - بعد الترحيل: لا يمكن تعديل القيد (يحتاج إلغاء الترحيل)
   - الترحيل يحدث:
     * تحديث أرصدة الحسابات
     * إنشاء حركات في دفتر الأستاذ
     * تحديث حالة القيد

4) المراكز:
   - كل سطر يمكن ربطه بمركز (فرع، محطة، قسم...)
   - المراكز تُستخدم في التقارير التفصيلية
   - يمكن إصدار تقرير لكل مركز منفصل

5) المراجع:
   - المرجع الخارجي يربط القيد بعملية أخرى (فاتورة، عقد...)
   - يُستخدم في التتبع والتدقيق
   - يمكن البحث عن القيود حسب المرجع

6) التواريخ:
   - تاريخ القيد يحدد الفترة المحاسبية
   - لا يمكن إنشاء قيد في فترة مغلقة
   - يمكن إنشاء قيد بتاريخ سابق (مع صلاحية)

7) الإلغاء:
   - يمكن إلغاء قيد مرحّل (مع صلاحية خاصة)
   - عند الإلغاء: يتم عكس جميع الحركات
   - يجب تسجيل سبب الإلغاء (للمراجعة)

8) النسخ:
   - يمكن نسخ قيد موجود لتسريع الإدخال
   - مفيد للقيود المتكررة (مثل: الرواتب الشهرية)

9) التقارير:
   - تقرير القيود: حسب التاريخ، الحساب، الحالة
   - تقرير المراجعة: جميع القيود في فترة معينة
   - تقرير الأخطاء: القيود غير المتوازنة (لا يجب أن تحدث)`,
    },
  },
  {
    match: (path) => path === "/dashboard/accounting/general-ledger",
    info: {
      title: "دفتر الأستاذ",
      description: "عرض الحركات لكل حساب مع الأرصدة.",
      process: `1) اختيار حساب أو فترة
2) عرض الحركات المرتبطة
3) تصدير أو تصفية حسب المراكز`,
      mechanism: `- استعلام مجمّع للحركات حسب الحساب
- فلاتر زمنية ومراكز
- عرض أرصدة مدين/دائن وترصيد تراكمي`,
      relatedScreens: [
        { name: "القيود اليومية", path: "/dashboard/accounting/journal-entries", description: "مصدر الحركات" },
        { name: "ميزان المراجعة", path: "/dashboard/accounting/trial-balance", description: "التحقق الإجمالي للأرصدة" },
      ],
      businessLogic: "يستخدم لتحليل الرصيد التفصيلي ومراجعة سلامة الترحيل قبل إعداد التقارير.",
    },
  },
  {
    match: (path) => path === "/dashboard/accounting/trial-balance",
    info: {
      title: "ميزان المراجعة",
      description: "تجميع أرصدة الحسابات للتحقق من التوازن.",
      process: `1) اختيار الفترة والمستوى
2) حساب المجاميع المدينة والدائنة
3) التحقق من التطابق
4) تصدير أو طباعة الميزان`,
      mechanism: `- استعلام تجميعي عبر tRPC
- خيارات مستوى الحساب (رئيسي/فرعي)
- عرض فروقات إن وجدت`,
      relatedScreens: [
        { name: "دفتر الأستاذ", path: "/dashboard/accounting/general-ledger", description: "مصدر أرصدة الحسابات" },
        { name: "التقارير المالية", path: "/dashboard/reports/financial", description: "تغذية التقارير الختامية" },
      ],
      businessLogic: "يضمن توازن الحسابات قبل إعداد القوائم المالية ويكشف الفروقات.",
    },
  },
  // Assets
  {
    match: (path) => path === "/dashboard/assets",
    info: {
      title: "قائمة الأصول",
      description: "عرض وإدارة جميع الأصول الثابتة.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: assets.list.useQuery() مع معاملات:
     * businessId (مطلوب)
     * categoryId (اختياري - للفلترة حسب الفئة)
     * branchId (اختياري - للفلترة حسب الفرع)
     * stationId (اختياري - للفلترة حسب المحطة)
     * status (اختياري - نشط/معطل/مستبعد/قيد الصيانة)
     * search (اختياري - البحث بالاسم أو الرقم التسلسلي)
     * page, limit (للترقيم)
   - عرض الأصول في جدول مع أعمدة: الاسم، الفئة، الموقع، القيمة الدفترية، القيمة المتبقية، الحالة
   - تطبيق فلاتر متعددة مع إمكانية الحفظ

2) إضافة أصل جديد:
   - النقر على "إضافة أصل"
   - فتح نموذج متعدد الخطوات:
     أ) الخطوة الأولى - البيانات الأساسية:
        * الاسم (مطلوب)
        * الفئة (اختيار من قائمة - مطلوب)
        * الرقم التسلسلي/الكود (فريد)
        * الوصف (اختياري)
     ب) الخطوة الثانية - بيانات الشراء:
        * تاريخ الشراء (مطلوب)
        * سعر الشراء (مطلوب، يجب أن يكون > 0)
        * المورد (اختياري)
        * رقم الفاتورة/العقد (اختياري)
     ج) الخطوة الثالثة - الموقع والربط:
        * الفرع (اختياري)
        * المحطة (اختياري - يعتمد على الفرع)
        * القسم/الإدارة (اختياري)
        * المسؤول (اختياري - من قائمة الموظفين)
     د) الخطوة الرابعة - بيانات الإهلاك:
        * طريقة الإهلاك (خطي/متناقص/صفر) - يتم جلبها من الفئة تلقائياً
        * معدل الإهلاك السنوي (%) - من الفئة
        * تاريخ بدء الإهلاك (افتراضي: تاريخ الشراء)
   - التحقق من:
     * عدم تكرار الرقم التسلسلي
     * صحة تاريخ الشراء (لا يمكن أن يكون في المستقبل)
     * أن سعر الشراء > 0
   - حفظ الأصل عبر tRPC: assets.create
   - عند النجاح: إغلاق النموذج وتحديث القائمة

3) عرض تفاصيل الأصل:
   - النقر على اسم الأصل أو زر "عرض"
   - الانتقال لصفحة تفاصيل الأصل (/dashboard/assets/view/:id)
   - عرض تبويبات:
     * المعلومات: البيانات الأساسية، الشراء، الموقع
     * الحركات: سجل جميع الحركات (نقل، تحسين، استبعاد)
     * الصيانة: أوامر العمل المرتبطة
     * الإهلاك: سجل الإهلاك الشهري
     * المرفقات: صور أو مستندات

4) تعديل الأصل:
   - يمكن تعديل:
     * البيانات الأساسية (الاسم، الوصف)
     * الموقع (الفرع، المحطة، القسم)
     * المسؤول
   - لا يمكن تعديل:
     * سعر الشراء (يجب استخدام حركة تحسين)
     * تاريخ الشراء
     * الفئة (بعد إنشاء حركات)
   - حفظ التعديلات عبر tRPC: assets.update

5) نقل الأصل:
   - من صفحة تفاصيل الأصل أو من قائمة الحركات
   - اختيار الموقع الجديد (فرع/محطة/قسم)
   - تحديد تاريخ النقل
   - إضافة ملاحظات (اختياري)
   - حفظ الحركة عبر tRPC: assets.movements.create
   - تحديث موقع الأصل تلقائياً

6) تحسين الأصل:
   - إضافة تحسينات أو إصلاحات تزيد من قيمة الأصل
   - إدخال: نوع التحسين، التكلفة، التاريخ
   - حفظ الحركة عبر tRPC: assets.movements.create (type: 'improvement')
   - تحديث القيمة الدفترية: القيمة القديمة + تكلفة التحسين

7) استبعاد الأصل:
   - إزالة الأصل من الخدمة (بيع، تلف، إلخ)
   - إدخال: نوع الاستبعاد، تاريخ الاستبعاد، قيمة البيع (إن وُجدت)
   - حفظ الحركة عبر tRPC: assets.movements.create (type: 'disposal')
   - تحديث حالة الأصل إلى "مستبعد"
   - حساب الربح/الخسارة: قيمة البيع - القيمة المتبقية`,
      mechanism: `- استعلام الأصول:
  * tRPC: assets.list.useQuery({ businessId, filters })
  * الإرجاع: { assets: Asset[], total: number, summary: { totalValue, totalDepreciation, netValue } }
  * Asset type: { id, name, code, categoryId, purchaseDate, purchasePrice, currentValue, residualValue, location, status, ... }
  * التحديث التلقائي: refetch عند تغيير الفلاتر

- نموذج الأصل:
  * استخدام React Hook Form مع التحقق:
    - name: required, minLength(3), maxLength(200)
    - code: required, unique, pattern(/^[A-Z0-9-]+$/)
    - categoryId: required
    - purchaseDate: required, date format, not in future
    - purchasePrice: required, number > 0
  * التحقق من تكرار الكود:
    - استدعاء tRPC: assets.checkCode قبل الحفظ
  * جلب بيانات الفئة:
    - عند اختيار الفئة: جلب طريقة الإهلاك ومعدله تلقائياً
    - tRPC: assets.categories.get({ id })

- عمليات CRUD:
  * Create: assets.create.mutate({ businessId, ...formData })
  * Update: assets.update.mutate({ id, ...formData })
  * Delete: assets.delete.mutate({ id }) - soft delete (استبعاد)
  * معالجة الأخطاء: try-catch مع toast.error

- حساب القيم:
  * القيمة الدفترية = سعر الشراء + تحسينات - إهلاك متراكم
  * القيمة المتبقية = القيمة الدفترية - إهلاك الشهر الحالي
  * الإهلاك المتراكم = مجموع جميع أقساط الإهلاك السابقة

- الحركات:
  * tRPC: assets.movements.create.mutate({ assetId, type, ...data })
  * أنواع الحركات:
    - 'transfer': نقل الموقع
    - 'improvement': تحسين/إصلاح
    - 'disposal': استبعاد
  * كل حركة تُسجل في جدول منفصل مع timestamp وuser

- الإهلاك:
  * يتم حساب الإهلاك شهرياً عبر job scheduler
  * tRPC: assets.depreciation.calculate({ assetId, month, year })
  * طريقة الخطي: (القيمة الدفترية - القيمة المتبقية) / العمر المتبقي
  * طريقة المتناقص: القيمة الدفترية × معدل الإهلاك`,
      relatedScreens: [
        { name: "تفاصيل الأصل", path: "/dashboard/assets/view/:id", description: "عرض بيانات الأصل الكاملة مع جميع الحركات والصيانة والإهلاك" },
        { name: "فئات الأصول", path: "/dashboard/assets/categories", description: "إدارة الفئات - يجب إنشاء الفئة قبل إضافة الأصل" },
        { name: "حركات الأصول", path: "/dashboard/assets/movements", description: "سجل جميع الحركات - نقل، تحسين، استبعاد" },
        { name: "الإهلاك", path: "/dashboard/assets/depreciation", description: "حساب وتتبع الإهلاك - يتم حساب الإهلاك شهرياً تلقائياً" },
        { name: "الصيانة", path: "/dashboard/maintenance/work-orders", description: "أوامر العمل - يمكن ربط أمر عمل بأصل محدد" },
        { name: "المحاسبة", path: "/dashboard/accounting/journal-entries", description: "القيود المحاسبية - يتم إنشاء قيود تلقائية عند الشراء والاستبعاد" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) دورة حياة الأصل:
   - جديد: تم تسجيل الأصل ولكن لم يتم تفعيله بعد
   - نشط: الأصل في الخدمة ويتم حساب الإهلاك له
   - قيد الصيانة: الأصل خارج الخدمة مؤقتاً (لا يتم حساب إهلاك)
   - معطل: الأصل معطل ولكن لم يتم استبعاده
   - مستبعد: تم إزالة الأصل من الخدمة نهائياً

2) القيمة الدفترية:
   - القيمة الدفترية = سعر الشراء + جميع التحسينات - الإهلاك المتراكم
   - لا يمكن أن تكون القيمة الدفترية سالبة
   - عند الوصول للقيمة المتبقية: يتوقف الإهلاك

3) الإهلاك:
   - يتم حساب الإهلاك شهرياً تلقائياً في نهاية كل شهر
   - طريقة الخطي: (سعر الشراء - القيمة المتبقية) / العمر الافتراضي (بالأشهر)
   - طريقة المتناقص: القيمة الدفترية × (معدل الإهلاك / 12)
   - لا يتم حساب إهلاك للأصول:
     * قيد الصيانة
     * مستبعدة
     * التي وصلت للقيمة المتبقية

4) التحسينات:
   - أي إنفاق يزيد من قيمة الأصل أو عمره يُعتبر تحسين
   - التحسينات تزيد القيمة الدفترية
   - بعد التحسين: يتم إعادة حساب الإهلاك بناءً على القيمة الجديدة

5) الاستبعاد:
   - عند استبعاد الأصل: يتم حساب الربح/الخسارة
   - الربح = قيمة البيع - القيمة المتبقية
   - الخسارة = القيمة المتبقية - قيمة البيع (إن كانت قيمة البيع أقل)
   - يتم إنشاء قيد محاسبي:
     * مدين: حساب النقد/البنك (قيمة البيع)
     * مدين: حساب الإهلاك المتراكم (الإهلاك المتراكم)
     * دائن: حساب الأصول (القيمة الدفترية)
     * دائن/مدين: حساب الربح/الخسارة (الفرق)

6) الربط بالصيانة:
   - يمكن ربط أمر عمل بأصل محدد
   - عند إنجاز أمر عمل: يتم تحديث حالة الأصل (إن لزم)
   - تكلفة الصيانة تُسجل كتحسين (إن زادت من قيمة الأصل)

7) التقارير:
   - تقرير الأصول: حسب الفئة، الموقع، الحالة
   - تقرير الإهلاك: الإهلاك الشهري/السنوي
   - تقرير القيمة: القيمة الدفترية، المتبقية، الإهلاك المتراكم
   - تقرير الحركات: جميع الحركات في فترة معينة`,
    },
  },
  {
    match: (path) => path === "/dashboard/assets/categories",
    info: {
      title: "فئات الأصول",
      description: "تعريف الفئات وربطها بالأصول.",
      process: `1) إنشاء فئة مع معدل الإهلاك وطريقة الإهلاك
2) ربط الأصول بالفئة
3) تعديل الخصائص أو إيقاف الفئة`,
      mechanism: `- جدول فئات مع معدل/طريقة الإهلاك
- CRUD عبر tRPC
- تطبيق الفئة على الأصول الجديدة تلقائياً`,
      relatedScreens: [
        { name: "قائمة الأصول", path: "/dashboard/assets", description: "تعيين الفئة لكل أصل" },
        { name: "الإهلاك", path: "/dashboard/assets/depreciation", description: "احتساب الإهلاك حسب الفئة" },
      ],
      businessLogic: "الفئة تحدد سياسة الإهلاك والتصنيف المحاسبي، ما يؤثر على الميزانية والربحية.",
    },
  },
  {
    match: (path) => path === "/dashboard/assets/movements",
    info: {
      title: "حركات الأصول",
      description: "تسجيل نقل أو تغيير حالة الأصول.",
      process: `1) اختيار الأصل
2) تحديد نوع الحركة (نقل، إضافة تحسين، استبعاد)
3) توثيق التاريخ والموقع والجهة
4) حفظ وتحديث سجل الأصل`,
      mechanism: `- نموذج حركة مرتبط بالأصل
- حفظ عبر API مع تحديث جدول الحركات
- إمكانية الفلترة حسب النوع أو التاريخ`,
      relatedScreens: [
        { name: "قائمة الأصول", path: "/dashboard/assets", description: "مصدر الأصل" },
        { name: "الإهلاك", path: "/dashboard/assets/depreciation", description: "تأثير الحركات على الإهلاك" },
      ],
      businessLogic: "توثيق الحركات يحافظ على تتبع دقيق للقيمة والموقع والمسؤولية.",
    },
  },
  {
    match: (path) => path === "/dashboard/assets/depreciation",
    info: {
      title: "الإهلاك",
      description: "حساب وتتبع إهلاك الأصول.",
      process: `1) اختيار الفترة والفئة/الأصل
2) حساب قسط الإهلاك
3) تسجيل قيد الإهلاك (يدوي أو آلي)
4) مراجعة الأرصدة بعد الإهلاك`,
      mechanism: `- استعلام الفئات والأصول بقيمها الدفترية
- حسابات بسيطة وفق معدل/طريقة الإهلاك
- إمكان الربط بمحرك القيود لإنشاء قيد تلقائي`,
      relatedScreens: [
        { name: "القيود اليومية", path: "/dashboard/accounting/journal-entries", description: "ترحيل قيد الإهلاك" },
        { name: "محرك القيود", path: "/dashboard/engines/auto-journal", description: "أتمتة قيد الإهلاك" },
      ],
      businessLogic: "الإهلاك يخفض قيمة الأصل تدريجياً ويؤثر على الربح والخسارة والقوائم المالية.",
    },
  },
  // Maintenance
  {
    match: (path) => path === "/dashboard/maintenance/work-orders",
    info: {
      title: "أوامر العمل",
      description: "إدارة وإنشاء أوامر العمل للصيانة.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: maintenance.workOrders.list.useQuery() مع معاملات:
     * businessId (مطلوب)
     * status (اختياري - جديد/قيد التنفيذ/مكتمل/ملغي)
     * priority (اختياري - عاجل/عادي/منخفض)
     * assetId (اختياري - للفلترة حسب الأصل)
     * technicianId (اختياري - للفلترة حسب الفني)
     * dateFrom, dateTo (للفلترة حسب التاريخ)
     * page, limit (للترقيم)
   - عرض الأوامر في جدول مع أعمدة: الرقم، الأصل/الموقع، النوع، الأولوية، الفني، الحالة، التاريخ
   - تطبيق فلاتر متعددة مع إمكانية الحفظ
   - عرض ملخص: إجمالي الأوامر، قيد التنفيذ، مكتملة، متأخرة

2) إنشاء أمر عمل جديد:
   - النقر على "إضافة أمر عمل"
   - فتح نموذج يحتوي على:
     أ) البيانات الأساسية:
        * نوع الصيانة (وقائية/تصحيحية/طارئة) - مطلوب
        * الأصل (اختيار من قائمة الأصول) - مطلوب
        * الموقع (يتم جلبها تلقائياً من الأصل أو اختيار يدوي)
        * الوصف (مطلوب - وصف المشكلة أو العمل المطلوب)
        * الأولوية (عاجل/عادي/منخفض) - افتراضي: عادي
     ب) الجدولة:
        * تاريخ البدء المخطط (مطلوب)
        * تاريخ الانتهاء المخطط (اختياري)
        * المدة المتوقعة (بالساعات) - افتراضي: 2 ساعة
     ج) الموارد:
        * الفني المسؤول (اختيار من قائمة الفنيين)
        * الفريق (اختياري - إذا كان العمل يتطلب فريق)
        * المعدات المطلوبة (اختياري - من قائمة المعدات)
     د) معلومات إضافية:
        * التكلفة المتوقعة (اختياري)
        * ملاحظات (اختياري)
   - التحقق من:
     * أن الأصل موجود ونشط
     * أن تاريخ البدء ليس في الماضي (إلا للصيانة التصحيحية)
     * أن الفني متاح في التاريخ المحدد (إن وُجدت هذه الميزة)
   - حفظ الأمر عبر tRPC: maintenance.workOrders.create
   - عند النجاح: إغلاق النموذج وتحديث القائمة

3) تعيين فني للأمر:
   - من قائمة الأوامر أو تفاصيل الأمر
   - اختيار فني من قائمة الفنيين المتاحين
   - يمكن تعيين عدة فنيين لأمر واحد (فريق)
   - حفظ التعيين عبر tRPC: maintenance.workOrders.assign
   - إرسال إشعار للفني (إن وُجدت هذه الميزة)

4) تحديث حالة الأمر:
   - الحالات المتاحة:
     * جديد: تم إنشاء الأمر ولكن لم يبدأ التنفيذ
     * قيد التنفيذ: بدأ الفني العمل
     * مكتمل: تم إنجاز العمل
     * ملغي: تم إلغاء الأمر
   - تحديث الحالة عبر tRPC: maintenance.workOrders.updateStatus
   - عند التحديث إلى "قيد التنفيذ":
     * تسجيل وقت البدء الفعلي
     * تحديث حالة الأصل إلى "قيد الصيانة" (إن لزم)
   - عند التحديث إلى "مكتمل":
     * تسجيل وقت الانتهاء الفعلي
     * حساب المدة الفعلية
     * تحديث حالة الأصل إلى "نشط"
     * طلب إدخال التكلفة الفعلية (إن كانت مختلفة عن المتوقعة)

5) إغلاق الأمر وتوثيق الأعمال:
   - من صفحة تفاصيل الأمر
   - إدخال:
     * الأعمال المنجزة (مطلوب - وصف تفصيلي)
     * الأجزاء المستبدلة (اختياري)
     * التكلفة الفعلية (مطلوب)
     * الصور/المستندات (اختياري)
     * تقييم جودة العمل (اختياري)
   - حفظ التوثيق عبر tRPC: maintenance.workOrders.close
   - تحديث حالة الأصل بناءً على نتيجة الصيانة

6) عرض تفاصيل الأمر:
   - النقر على رقم الأمر أو زر "عرض"
   - الانتقال لصفحة تفاصيل الأمر (/dashboard/maintenance/work-orders/:id)
   - عرض تبويبات:
     * المعلومات: البيانات الأساسية، الجدولة، الموارد
     * التنفيذ: سجل التحديثات، الأعمال المنجزة، التكلفة
     * المرفقات: صور أو مستندات
     * التاريخ: سجل جميع التغييرات`,
      mechanism: `- استعلام الأوامر:
  * tRPC: maintenance.workOrders.list.useQuery({ businessId, filters })
  * الإرجاع: { workOrders: WorkOrder[], total: number, summary: { new, inProgress, completed, cancelled } }
  * WorkOrder type: { id, number, type, assetId, description, priority, status, scheduledStart, scheduledEnd, actualStart, actualEnd, technicianId, cost, ... }
  * التحديث التلقائي: refetch عند تغيير الفلاتر أو إضافة أمر جديد

- نموذج الأمر:
  * استخدام React Hook Form مع التحقق:
    - type: required, enum(['preventive', 'corrective', 'emergency'])
    - assetId: required
    - description: required, minLength(10), maxLength(1000)
    - priority: required, enum(['urgent', 'normal', 'low'])
    - scheduledStart: required, date format
    - scheduledEnd: optional, must be after scheduledStart
  * جلب بيانات الأصل:
    - عند اختيار الأصل: جلب الموقع والمسؤول تلقائياً
    - tRPC: assets.get({ id })
  * التحقق من توفر الفني:
    - tRPC: maintenance.technicians.checkAvailability({ technicianId, date })
    - عرض تحذير إذا كان الفني غير متاح

- عمليات CRUD:
  * Create: maintenance.workOrders.create.mutate({ businessId, ...formData })
  * Update: maintenance.workOrders.update.mutate({ id, ...formData })
  * Delete: maintenance.workOrders.delete.mutate({ id }) - soft delete (إلغاء)
  * Assign: maintenance.workOrders.assign.mutate({ id, technicianIds })
  * Update Status: maintenance.workOrders.updateStatus.mutate({ id, status, notes })
  * Close: maintenance.workOrders.close.mutate({ id, completedWork, actualCost, attachments })
  * معالجة الأخطاء: try-catch مع toast.error

- حساب المدة والتكلفة:
  * المدة الفعلية = actualEnd - actualStart (بالساعات)
  * التكلفة الفعلية = تكلفة الأجزاء + تكلفة العمالة (ساعات × معدل الساعة)
  * الفرق = التكلفة الفعلية - التكلفة المتوقعة

- الربط بالأصول:
  * عند إنشاء أمر: ربط الأمر بالأصل
  * عند بدء التنفيذ: تحديث حالة الأصل إلى "قيد الصيانة"
  * عند الإكمال: تحديث حالة الأصل إلى "نشط" أو "معطل" (حسب نتيجة الصيانة)

- الإشعارات:
  * عند تعيين فني: إرسال إشعار للفني
  * عند تغيير الأولوية: إرسال إشعار إذا كانت عاجلة
  * عند التأخير: إرسال تنبيه إذا تجاوز تاريخ الانتهاء`,
      relatedScreens: [
        { name: "تفاصيل الأمر", path: "/dashboard/maintenance/work-orders/:id", description: "عرض بيانات الأمر الكاملة مع سجل التنفيذ والمرفقات" },
        { name: "الخطط", path: "/dashboard/maintenance/plans", description: "توليد أوامر مجدولة - يتم إنشاء أوامر تلقائياً من الخطط" },
        { name: "الفنيين", path: "/dashboard/maintenance/technicians", description: "تعيين الموارد البشرية - يجب أن يكون الفني مسجل في النظام" },
        { name: "الأصول", path: "/dashboard/assets", description: "مصدر الأصول - يجب أن يكون الأصل مسجل قبل إنشاء أمر عمل" },
        { name: "المهام الميدانية", path: "/dashboard/fieldops/operations", description: "توزيع المهام - يمكن ربط أمر عمل بمهمة ميدانية" },
        { name: "محرك الجدولة", path: "/dashboard/engines/scheduling", description: "تشغيل الخطط تلقائياً - يتم توليد أوامر من الخطط الوقائية" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) دورة حياة الأمر:
   - جديد: تم إنشاء الأمر وانتظار التعيين
   - معين: تم تعيين فني/فريق ولكن لم يبدأ التنفيذ
   - قيد التنفيذ: بدأ الفني العمل
   - مكتمل: تم إنجاز العمل بنجاح
   - ملغي: تم إلغاء الأمر (لن يتم تنفيذه)

2) الأولويات:
   - عاجل: يجب التنفيذ خلال 24 ساعة (للصيانة الطارئة)
   - عادي: التنفيذ خلال 3-7 أيام (للصيانة التصحيحية)
   - منخفض: التنفيذ خلال 7-30 يوم (للصيانة الوقائية)

3) أنواع الصيانة:
   - وقائية: صيانة مجدولة مسبقاً (من الخطط)
   - تصحيحية: إصلاح عطل موجود
   - طارئة: عطل حرج يتطلب تدخل فوري

4) الجدولة:
   - تاريخ البدء المخطط: متى يجب أن يبدأ العمل
   - تاريخ الانتهاء المخطط: متى يجب أن ينتهي العمل
   - المدة المتوقعة: تقدير الوقت المطلوب (بالساعات)
   - عند التأخير: يتم تسجيل السبب وتحديث الأولوية إذا لزم

5) التكلفة:
   - التكلفة المتوقعة: تقدير أولي عند إنشاء الأمر
   - التكلفة الفعلية: المبلغ الفعلي بعد الإنجاز
   - الفرق: يُستخدم لتقييم دقة التقديرات وتحسين الخطط

6) الربط بالأصول:
   - عند بدء الصيانة: يتم تحديث حالة الأصل إلى "قيد الصيانة"
   - أثناء الصيانة: لا يمكن استخدام الأصل
   - بعد الصيانة: يتم تحديث الحالة حسب النتيجة:
     * إذا نجحت: "نشط"
     * إذا فشلت: "معطل" (يحتاج استبدال أو إصلاح إضافي)

7) التوثيق:
   - يجب توثيق جميع الأعمال المنجزة
   - الصور/المستندات تساعد في:
     * إثبات جودة العمل
     * مراجعة الصيانة السابقة
     * تحليل أسباب الأعطال المتكررة

8) التقارير:
   - تقرير الأوامر: حسب النوع، الحالة، الفترة
   - تقرير الأداء: معدل الإنجاز، متوسط المدة، التكلفة
   - تقرير التأخير: الأوامر المتأخرة وأسباب التأخير
   - تقرير التكلفة: التكلفة الفعلية مقابل المتوقعة`,
    },
  },
  {
    match: (path) => path === "/dashboard/maintenance/plans",
    info: {
      title: "خطط الصيانة",
      description: "إعداد خطط الصيانة الوقائية.",
      process: `1) تحديد الأصول أو الفئات المستهدفة
2) وضع دورية الصيانة (زمن/قراءة)
3) توليد أوامر عمل تلقائية
4) متابعة الالتزام بالخطة`,
      mechanism: `- نماذج إنشاء خطة مع معايير تكرار
- حفظ عبر API وتوليد مهام في الخلفية
- عرض جداول الخطة مع حالة التنفيذ`,
      relatedScreens: [
        { name: "أوامر العمل", path: "/dashboard/maintenance/work-orders", description: "استقبال أوامر ناتجة عن الخطة" },
        { name: "محرك الجدولة", path: "/dashboard/engines/scheduling", description: "تشغيل الخطة تلقائياً" },
      ],
      businessLogic: "الصيانة الوقائية تقلل الأعطال غير المتوقعة وتطيل عمر الأصل.",
    },
  },
  {
    match: (path) => path === "/dashboard/maintenance/technicians",
    info: {
      title: "الفنيين",
      description: "إدارة الفنيين ومهاراتهم وتوفرهم.",
      process: `1) إدخال بيانات الفني ومهاراته
2) تعيينه لأوامر العمل
3) متابعة التوفر والحمل التشغيلي`,
      mechanism: `- جدول فنيين مع حقول مهارة/حالة
- ربط بالفِرق أو المهام
- عمليات CRUD عبر API`,
      relatedScreens: [
        { name: "أوامر العمل", path: "/dashboard/maintenance/work-orders", description: "تعيين الفنيين للأوامر" },
        { name: "المهام الميدانية", path: "/dashboard/fieldops/operations", description: "إسناد المهام حسب المهارة والموقع" },
      ],
      businessLogic: "اختيار الفني المناسب يحسن زمن الاستجابة وجودة الصيانة.",
    },
  },
  // Inventory
  {
    match: (path) => path === "/dashboard/inventory/warehouses",
    info: {
      title: "المستودعات",
      description: "إدارة تعريف المستودعات ومواقعها.",
      process: `1) إنشاء مستودع مع الموقع والسعة
2) ضبط مسؤول المستودع
3) استخدامه في حركات المخزون`,
      mechanism: `- جدول مستودعات
- نموذج إنشاء/تعديل عبر tRPC
- ربط بالحركات والمخزون`,
      relatedScreens: [
        { name: "أرصدة المخزون", path: "/dashboard/inventory/stock-balance", description: "عرض الأرصدة لكل مستودع" },
        { name: "الحركات", path: "/dashboard/inventory/movements", description: "تسجيل نقل أو استلام" },
      ],
      businessLogic: "تعريف المستودع أساس لتتبع الكميات وتحديد مكان التخزين والمسؤولية.",
    },
  },
  {
    match: (path) => path === "/dashboard/inventory/items",
    info: {
      title: "الأصناف",
      description: "إدارة الأصناف ووحدات القياس والتسعير.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: inventory.items.list.useQuery() مع معاملات:
     * businessId (مطلوب)
     * categoryId (اختياري - للفلترة حسب الفئة)
     * warehouseId (اختياري - للفلترة حسب المستودع)
     * status (اختياري - نشط/معطل/منقطع)
     * search (اختياري - البحث بالاسم أو الكود)
     * page, limit (للترقيم)
   - عرض الأصناف في جدول مع أعمدة: الاسم، الكود، الفئة، الوحدة، السعر، الرصيد، الحالة
   - تطبيق فلاتر متعددة
   - عرض ملخص: إجمالي الأصناف، الأصناف النشطة، إجمالي القيمة

2) إضافة صنف جديد:
   - النقر على "إضافة صنف"
   - فتح نموذج يحتوي على:
     أ) البيانات الأساسية:
        * الاسم (مطلوب)
        * الكود/الباركود (فريد - مطلوب)
        * الفئة (اختيار من قائمة - مطلوب)
        * الوصف (اختياري)
     ب) الوحدة والتسعير:
        * وحدة القياس الأساسية (مطلوب - قطعة، كيلو، لتر...)
        * وحدات فرعية (اختياري - علبة = 12 قطعة)
        * سعر الشراء (مطلوب - التكلفة)
        * سعر البيع (اختياري - للبيع)
        * طريقة حساب التكلفة (FIFO/LIFO/متوسط) - افتراضي: FIFO
     ج) المخزون:
        * الحد الأدنى (اختياري - للتنبيه عند النفاد)
        * الحد الأقصى (اختياري - للتنبيه عند التراكم)
        * نقطة إعادة الطلب (اختياري)
     د) الموردين:
        * ربط الموردين المفضلين (اختياري)
        * المورد الرئيسي (اختياري)
     هـ) معلومات إضافية:
        * الصورة (اختياري)
        * الملاحظات (اختياري)
   - التحقق من:
     * عدم تكرار الكود/الباركود
     * أن سعر الشراء > 0
     * أن الوحدة موجودة في النظام
   - حفظ الصنف عبر tRPC: inventory.items.create
   - عند النجاح: إغلاق النموذج وتحديث القائمة

3) تعديل الصنف:
   - النقر على صنف ثم "تعديل"
   - يمكن تعديل:
     * الاسم، الوصف
     * الأسعار (مع تسجيل تاريخ التغيير)
     * الحدود (الأدنى، الأقصى)
     * الموردين
   - لا يمكن تعديل:
     * الكود/الباركود (immutable)
     * طريقة حساب التكلفة (بعد وجود حركات)
   - حفظ التعديلات عبر tRPC: inventory.items.update

4) عرض تفاصيل الصنف:
   - النقر على اسم الصنف
   - عرض:
     * المعلومات الأساسية
     * الأرصدة في كل مستودع
     * آخر حركة
     * الموردين المرتبطين
     * سجل تغييرات الأسعار

5) تعطيل/تفعيل صنف:
   - تغيير حالة الصنف (نشط/معطل/منقطع)
   - عند التعطيل: لا يمكن استخدامه في حركات جديدة
   - عند "منقطع": لا يمكن طلبه في أوامر الشراء`,
      mechanism: `- استعلام الأصناف:
  * tRPC: inventory.items.list.useQuery({ businessId, filters })
  * الإرجاع: { items: Item[], total: number, summary: { totalItems, activeItems, totalValue } }
  * Item type: { id, name, code, barcode, categoryId, unit, purchasePrice, salePrice, costMethod, minStock, maxStock, reorderPoint, status, ... }
  * التحديث التلقائي: refetch عند تغيير الفلاتر

- نموذج الصنف:
  * استخدام React Hook Form مع التحقق:
    - name: required, minLength(3), maxLength(200)
    - code: required, unique, pattern(/^[A-Z0-9-]+$/)
    - barcode: optional, unique if provided
    - categoryId: required
    - unit: required, enum(['piece', 'kg', 'liter', 'meter', ...])
    - purchasePrice: required, number > 0
    - salePrice: optional, number > 0
    - costMethod: required, enum(['FIFO', 'LIFO', 'average'])
  * التحقق من تكرار الكود:
    - tRPC: inventory.items.checkCode({ code, businessId })
  * جلب الفئات:
    - tRPC: inventory.categories.list({ businessId })

- عمليات CRUD:
  * Create: inventory.items.create.mutate({ businessId, ...formData })
  * Update: inventory.items.update.mutate({ id, ...formData })
  * Delete: inventory.items.delete.mutate({ id }) - soft delete (تعطيل)
  * معالجة الأخطاء: try-catch مع toast.error

- حساب التكلفة:
  * FIFO: أول ما دخل أول ما خرج (First In First Out)
  * LIFO: آخر ما دخل أول ما خرج (Last In First Out)
  * Average: متوسط التكلفة = (إجمالي القيمة) / (إجمالي الكمية)

- الربط بالموردين:
  * tRPC: inventory.items.linkSupplier.mutate({ itemId, supplierId, isPrimary })
  * يمكن ربط عدة موردين لكل صنف
  * المورد الرئيسي يُستخدم افتراضياً في أوامر الشراء`,
      relatedScreens: [
        { name: "الحركات", path: "/dashboard/inventory/movements", description: "تحريك الأصناف - يتم استخدام الأصناف في جميع الحركات" },
        { name: "أرصدة المخزون", path: "/dashboard/inventory/stock-balance", description: "عرض الأرصدة - يتم عرض رصيد كل صنف في كل مستودع" },
        { name: "الموردين", path: "/dashboard/inventory/suppliers", description: "مصادر الشراء - يتم ربط الأصناف بالموردين" },
        { name: "أوامر الشراء", path: "/dashboard/inventory/purchase-orders", description: "إصدار طلبات - يتم اختيار الأصناف من القائمة" },
        { name: "المستودعات", path: "/dashboard/inventory/warehouses", description: "مواقع التخزين - يتم ربط الأرصدة بالمستودعات" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) فريدية الكود:
   - الكود/الباركود يجب أن يكون فريداً على مستوى النظام
   - يُستخدم في:
     * البحث السريع
     * مسح الباركود (إن وُجدت هذه الميزة)
     * التكامل مع أنظمة خارجية

2) وحدات القياس:
   - الوحدة الأساسية: الوحدة المستخدمة في التخزين والمحاسبة
   - الوحدات الفرعية: للتحويل (مثل: علبة = 12 قطعة)
   - عند إدخال حركة: يتم تحويل الوحدة الفرعية للوحدة الأساسية تلقائياً

3) طرق حساب التكلفة:
   - FIFO: مناسب للبضائع القابلة للتلف (أول ما دخل أول ما خرج)
   - LIFO: مناسب للبضائع غير القابلة للتلف (آخر ما دخل أول ما خرج)
   - Average: متوسط التكلفة (بسيط وسهل)
   - لا يمكن تغيير الطريقة بعد وجود حركات

4) الحدود والتنبيهات:
   - الحد الأدنى: عند الوصول له: تنبيه "نفاد المخزون"
   - الحد الأقصى: عند الوصول له: تنبيه "تراكم المخزون"
   - نقطة إعادة الطلب: عند الوصول لها: اقتراح إنشاء أمر شراء

5) الأسعار:
   - سعر الشراء: التكلفة الفعلية (يُستخدم في حساب الربح)
   - سعر البيع: السعر للعملاء (إن كان الصنف للبيع)
   - يمكن تحديث الأسعار مع تسجيل تاريخ التغيير
   - سجل تغييرات الأسعار يُستخدم في تحليل التكاليف

6) الربط بالموردين:
   - يمكن ربط عدة موردين لكل صنف
   - المورد الرئيسي يُستخدم افتراضياً في أوامر الشراء
   - يمكن تغيير المورد في أمر الشراء

7) الحالة:
   - نشط: يمكن استخدامه في جميع الحركات
   - معطل: لا يمكن استخدامه في حركات جديدة
   - منقطع: لا يمكن طلبه في أوامر الشراء

8) التقارير:
   - تقرير الأصناف: حسب الفئة، الحالة، المورد
   - تقرير الأرصدة: رصيد كل صنف في كل مستودع
   - تقرير التنبيهات: الأصناف التي وصلت للحد الأدنى/الأقصى
   - تقرير التكلفة: التكلفة الإجمالية للمخزون`,
    },
  },
  {
    match: (path) => path === "/dashboard/inventory/movements",
    info: {
      title: "حركات المخزون",
      description: "تسجيل التحويلات والاستلام والصرف.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: inventory.movements.list.useQuery() مع معاملات:
     * businessId (مطلوب)
     * type (اختياري - استلام/صرف/تحويل/تعديل)
     * warehouseId (اختياري - للفلترة حسب المستودع)
     * itemId (اختياري - للفلترة حسب الصنف)
     * dateFrom, dateTo (للفلترة حسب التاريخ)
     * page, limit (للترقيم)
   - عرض الحركات في جدول مع أعمدة: الرقم، التاريخ، النوع، المستودع، الصنف، الكمية، الحالة
   - تطبيق فلاتر متعددة

2) إنشاء حركة استلام:
   - النقر على "استلام"
   - فتح نموذج يحتوي على:
     * البيانات الأساسية:
       - التاريخ (مطلوب - افتراضي: اليوم)
       - المستودع (اختيار من قائمة - مطلوب)
       - المرجع (اختياري - رقم فاتورة، أمر شراء...)
       - المورد (اختياري - إذا كان الاستلام من مورد)
     * البنود:
       - إضافة صنف (اختيار من قائمة الأصناف)
       - الكمية (مطلوب - يجب أن تكون > 0)
       - السعر (مطلوب - سعر الشراء)
       - الوحدة (يتم جلبها من الصنف تلقائياً)
       - إجمالي السطر = الكمية × السعر
       - يمكن إضافة عدة بنود
     * الملخص:
       - إجمالي الكمية
       - إجمالي القيمة
   - التحقق من:
     * أن جميع الأصناف نشطة
     * أن الكميات > 0
     * أن الأسعار > 0
   - حفظ الحركة عبر tRPC: inventory.movements.create (type: 'receipt')
   - عند الحفظ:
     * تحديث أرصدة المخزون تلقائياً
     * تحديث التكلفة المتوسطة (إن كانت الطريقة: average)
     * إنشاء سجل في جدول stock_movements
     * تحديث lastMovementDate للصنف

3) إنشاء حركة صرف:
   - النقر على "صرف"
   - فتح نموذج مشابه ولكن:
     * المستودع: اختيار المستودع المصدر
     * الجهة المستلمة (مطلوب - قسم، مشروع، عميل...)
     * البنود: اختيار الأصناف الموجودة في المستودع
     * التحقق من الرصيد: يجب أن يكون الرصيد المتاح >= الكمية المطلوبة
   - عند الحفظ:
     * تحديث الأرصدة (نقصان)
     * حساب التكلفة حسب طريقة الحساب (FIFO/LIFO/Average)
     * إنشاء سجل الحركة

4) إنشاء حركة تحويل:
   - النقر على "تحويل"
   - فتح نموذج يحتوي على:
     * المستودع المصدر (مطلوب)
     * المستودع الوجهة (مطلوب - يجب أن يكون مختلف عن المصدر)
     * البنود: الأصناف والكميات
     * التحقق من الرصيد في المستودع المصدر
   - عند الحفظ:
     * نقصان من المستودع المصدر
     * زيادة في المستودع الوجهة
     * إنشاء حركتين منفصلتين (صرف + استلام) أو حركة واحدة من نوع "تحويل"

5) إنشاء حركة تعديل:
   - تعديل الرصيد (زيادة أو نقصان) بدون سبب واضح
   - يُستخدم في:
     * جرد المخزون
     * تصحيح الأخطاء
     * إهلاك/تلف
   - يتطلب صلاحية خاصة
   - يجب تسجيل سبب التعديل (مطلوب)

6) ربط الحركة بأمر شراء:
   - عند استلام أمر شراء:
     * اختيار أمر الشراء من القائمة
     * يتم جلب البنود تلقائياً
     * يمكن تعديل الكميات المستلمة (قد تكون أقل من المطلوب)
     * تحديث حالة أمر الشراء (مستلم جزئياً/كلياً)

7) عرض تفاصيل الحركة:
   - النقر على رقم الحركة
   - عرض:
     * البيانات الأساسية
     * جميع البنود
     * التأثير على الأرصدة
     * المرفقات (إن وُجدت)`,
      mechanism: `- استعلام الحركات:
  * tRPC: inventory.movements.list.useQuery({ businessId, filters })
  * الإرجاع: { movements: Movement[], total: number }
  * Movement type: { id, number, type, date, warehouseId, reference, items: MovementItem[], status, ... }
  * MovementItem type: { id, itemId, quantity, price, unit, total }
  * التحديث التلقائي: refetch عند إضافة حركة جديدة

- نموذج الحركة:
  * استخدام React Hook Form مع array fields للبنود
  * إضافة/حذف بنود ديناميكياً
  * التحقق من:
    - date: required, date format
    - warehouseId: required
    - items: array, minLength(1)
    - لكل بند:
      * itemId: required
      * quantity: required, number > 0
      * price: required, number > 0 (للصرف: يتم جلبها تلقائياً)
  * التحقق من الرصيد (للصرف والتحويل):
    - tRPC: inventory.stock.checkBalance({ itemId, warehouseId })
    - عرض تحذير إذا كان الرصيد غير كافٍ

- عمليات CRUD:
  * Create: inventory.movements.create.mutate({ businessId, type, ...data })
  * Update: inventory.movements.update.mutate({ id, ...data }) - فقط للحركات المسودة
  * Delete: inventory.movements.delete.mutate({ id }) - soft delete (إلغاء)
  * معالجة الأخطاء: try-catch مع toast.error

- تحديث الأرصدة:
  * عند الاستلام:
    - stock.quantity += quantity
    - stock.value += (quantity × price)
    - إذا كانت الطريقة average: stock.averageCost = stock.value / stock.quantity
  * عند الصرف:
    - حساب التكلفة حسب الطريقة:
      * FIFO: استخدام أول سعر دخل
      * LIFO: استخدام آخر سعر دخل
      * Average: استخدام التكلفة المتوسطة
    - stock.quantity -= quantity
    - stock.value -= (quantity × cost)
  * عند التحويل:
    - نقصان من المصدر + زيادة في الوجهة

- حساب التكلفة (للصرف):
  * FIFO:
    1) جلب حركات الاستلام مرتبة حسب التاريخ (الأقدم أولاً)
    2) استخدام الكمية من كل حركة حتى استيفاء الكمية المطلوبة
    3) حساب التكلفة = مجموع (كمية × سعر) لكل حركة مستخدمة
  * LIFO:
    1) نفس الطريقة ولكن من الأحدث للأقدم
  * Average:
    1) التكلفة = التكلفة المتوسطة × الكمية

- الربط بأوامر الشراء:
  * عند اختيار أمر الشراء:
    - جلب البنود تلقائياً
    - tRPC: inventory.purchaseOrders.get({ id })
  * بعد الاستلام:
    - تحديث حالة أمر الشراء
    - tRPC: inventory.purchaseOrders.updateStatus({ id, status: 'received' })`,
      relatedScreens: [
        { name: "أرصدة المخزون", path: "/dashboard/inventory/stock-balance", description: "عرض الأرصدة - يتم تحديث الأرصدة تلقائياً بعد كل حركة" },
        { name: "الأصناف", path: "/dashboard/inventory/items", description: "اختيار الأصناف - يجب أن تكون الأصناف نشطة" },
        { name: "المستودعات", path: "/dashboard/inventory/warehouses", description: "اختيار المستودع - يجب أن يكون المستودع نشط" },
        { name: "أوامر الشراء", path: "/dashboard/inventory/purchase-orders", description: "ربط الاستلام - يمكن ربط حركة الاستلام بأمر شراء" },
        { name: "الموردين", path: "/dashboard/inventory/suppliers", description: "مصدر الاستلام - يمكن تحديد المورد في حركة الاستلام" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) أنواع الحركات:
   - استلام: زيادة في المخزون (من مورد، إرجاع، تعديل...)
   - صرف: نقصان من المخزون (للمشاريع، الأقسام، البيع...)
   - تحويل: نقل بين مستودعين (نقصان من المصدر + زيادة في الوجهة)
   - تعديل: تصحيح الرصيد (جرد، تصحيح أخطاء...)

2) دورة حياة الحركة:
   - مسودة: تم إنشاء الحركة ولكن لم يتم تأكيدها
   - مؤكدة: تم تأكيد الحركة وتحديث الأرصدة
   - ملغاة: تم إلغاء الحركة (تم عكس الأرصدة)

3) التحقق من الرصيد:
   - للصرف والتحويل: يجب التحقق من وجود رصيد كافٍ
   - الرصيد المتاح = الرصيد الحالي - الرصيد المحجوز
   - إذا كان الرصيد غير كافٍ: منع الصرف أو عرض تحذير

4) حساب التكلفة:
   - طريقة FIFO: أول ما دخل أول ما خرج
     * مناسب للبضائع القابلة للتلف
     * يعطي تكلفة دقيقة
   - طريقة LIFO: آخر ما دخل أول ما خرج
     * مناسب للبضائع غير القابلة للتلف
     * قد يعطي تكلفة أعلى في التضخم
   - طريقة Average: متوسط التكلفة
     * بسيط وسهل
     * يعطي متوسط التكلفة

5) الربط بأوامر الشراء:
   - عند استلام أمر شراء:
     * يتم ربط الحركة بأمر الشراء
     * تحديث حالة أمر الشراء (مستلم جزئياً/كلياً)
     * إذا كانت الكمية المستلمة أقل من المطلوبة: يبقى الأمر مفتوحاً

6) التعديلات:
   - حركة التعديل تتطلب صلاحية خاصة
   - يجب تسجيل سبب التعديل
   - يُستخدم في:
     * جرد المخزون (الفرق بين الرصيد الفعلي والمسجل)
     * تصحيح الأخطاء
     * إهلاك/تلف البضائع

7) المراجع:
   - كل حركة يمكن ربطها بمرجع (فاتورة، أمر شراء، أمر صرف...)
   - يُستخدم في التتبع والتدقيق
   - يمكن البحث عن الحركات حسب المرجع

8) التقارير:
   - تقرير الحركات: حسب النوع، التاريخ، المستودع
   - تقرير الاستلام: جميع عمليات الاستلام في فترة معينة
   - تقرير الصرف: جميع عمليات الصرف مع التكلفة
   - تقرير التحويلات: نقل البضائع بين المستودعات`,
    },
  },
  {
    match: (path) => path === "/dashboard/inventory/stock-balance",
    info: {
      title: "أرصدة المخزون",
      description: "عرض الأرصدة لكل صنف ومستودع.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: inventory.stock.balance.useQuery() مع معاملات:
     * businessId (مطلوب)
     * warehouseId (اختياري - للفلترة حسب المستودع)
     * itemId (اختياري - للفلترة حسب الصنف)
     * categoryId (اختياري - للفلترة حسب الفئة)
     * showZero (اختياري - عرض الأصناف برصيد صفر)
     * page, limit (للترقيم)
   - عرض الأرصدة في جدول مع أعمدة: الصنف، المستودع، الرصيد الحالي، الرصيد المحجوز، الرصيد المتاح، القيمة، آخر حركة
   - تطبيق فلاتر متعددة
   - عرض ملخص: إجمالي الأصناف، إجمالي القيمة، الأصناف تحت الحد الأدنى

2) عرض الرصيد التفصيلي:
   - النقر على صف الرصيد
   - عرض:
     * معلومات الصنف: الاسم، الكود، الفئة، الوحدة
     * معلومات المستودع: الاسم، الموقع
     * الرصيد الحالي: الكمية الإجمالية
     * الرصيد المحجوز: الكمية المحجوزة (في أوامر صرف معلقة)
     * الرصيد المتاح: الرصيد الحالي - الرصيد المحجوز
     * القيمة: القيمة الإجمالية = الرصيد × التكلفة المتوسطة
     * آخر حركة: تاريخ وكمية آخر حركة

3) فلترة حسب الحدود:
   - عرض الأصناف تحت الحد الأدنى (تحتاج إعادة طلب)
   - عرض الأصناف فوق الحد الأقصى (تراكم)
   - عرض الأصناف عند نقطة إعادة الطلب
   - عرض الأصناف برصيد صفر

4) تصدير التقرير:
   - تصدير Excel: جميع الأرصدة مع التفاصيل
   - تصدير PDF: تقرير منسق
   - إمكانية تصدير حسب الفلاتر المطبقة

5) جرد المخزون:
   - من صفحة الأرصدة: النقر على "جرد"
   - اختيار المستودع والصنف
   - إدخال الرصيد الفعلي (العد الفعلي)
   - حساب الفرق: الرصيد الفعلي - الرصيد المسجل
   - إنشاء حركة تعديل تلقائياً لتصحيح الرصيد`,
      mechanism: `- استعلام الأرصدة:
  * tRPC: inventory.stock.balance.useQuery({ businessId, filters })
  * الإرجاع: { balances: StockBalance[], total: number, summary: { totalItems, totalValue, lowStockItems } }
  * StockBalance type: { id, itemId, warehouseId, quantity, reservedQuantity, availableQuantity, value, averageCost, lastMovementDate, ... }
  * التحديث التلقائي: refetch عند تغيير الفلاتر أو إضافة حركة

- حساب الرصيد:
  * الرصيد الحالي = مجموع حركات الاستلام - مجموع حركات الصرف
  * الرصيد المحجوز = مجموع الكميات في أوامر الصرف المعلقة
  * الرصيد المتاح = الرصيد الحالي - الرصيد المحجوز
  * القيمة = الرصيد الحالي × التكلفة المتوسطة

- التنبيهات:
  * عند الرصيد < الحد الأدنى: تنبيه "نفاد المخزون" (لون أحمر)
  * عند الرصيد > الحد الأقصى: تنبيه "تراكم المخزون" (لون أصفر)
  * عند الرصيد = 0: تنبيه "منقطع" (لون رمادي)

- الجرد:
  * tRPC: inventory.stock.count.mutate({ warehouseId, itemId, actualQuantity })
  * حساب الفرق: difference = actualQuantity - recordedQuantity
  * إنشاء حركة تعديل تلقائياً:
    - إذا كان الفرق > 0: حركة استلام
    - إذا كان الفرق < 0: حركة صرف
  * تسجيل سبب الجرد

- التصدير:
  * Excel: استخدام مكتبة مثل xlsx
  * PDF: استخدام مكتبة مثل react-pdf
  * التنسيق: جدول منسق مع الأعمدة والترتيب`,
      relatedScreens: [
        { name: "حركات المخزون", path: "/dashboard/inventory/movements", description: "مصدر التغييرات - كل حركة تحدث الرصيد" },
        { name: "الأصناف", path: "/dashboard/inventory/items", description: "مصدر بيانات الأصناف - يتم عرض الرصيد لكل صنف" },
        { name: "المستودعات", path: "/dashboard/inventory/warehouses", description: "مواقع التخزين - يتم عرض الرصيد لكل مستودع" },
        { name: "أوامر الشراء", path: "/dashboard/inventory/purchase-orders", description: "إعادة الطلب - يمكن إنشاء أمر شراء من الأصناف تحت الحد الأدنى" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) حساب الرصيد:
   - الرصيد الحالي = مجموع جميع حركات الاستلام - مجموع جميع حركات الصرف
   - يتم تحديث الرصيد تلقائياً عند كل حركة
   - الرصيد لا يمكن أن يكون سالباً (يتم منع الصرف إذا كان الرصيد غير كافٍ)

2) الرصيد المحجوز:
   - الكمية المحجوزة في أوامر الصرف المعلقة (لم يتم تنفيذها بعد)
   - الرصيد المتاح = الرصيد الحالي - الرصيد المحجوز
   - عند الصرف: يتم تحرير الكمية المحجوزة

3) التكلفة المتوسطة:
   - يتم حسابها تلقائياً عند كل حركة استلام
   - التكلفة المتوسطة = إجمالي القيمة / إجمالي الكمية
   - تُستخدم في حساب قيمة المخزون

4) التنبيهات:
   - عند الرصيد < الحد الأدنى: تنبيه "نفاد المخزون"
     * يمكن إنشاء أمر شراء تلقائياً
     * إرسال إشعار للمسؤول
   - عند الرصيد > الحد الأقصى: تنبيه "تراكم المخزون"
     * مراجعة سياسة الشراء
   - عند الرصيد = 0: تنبيه "منقطع"
     * لا يمكن الصرف
     * يجب إعادة الطلب فوراً

5) الجرد:
   - جرد دوري: مقارنة الرصيد المسجل بالرصيد الفعلي
   - الفرق يُسجل كحركة تعديل
   - يُستخدم في:
     * اكتشاف الفاقد/الزيادة
     * تصحيح الأخطاء
     * التحقق من دقة السجلات

6) التقارير:
   - تقرير الأرصدة: حسب المستودع، الصنف، الفئة
   - تقرير القيمة: القيمة الإجمالية للمخزون
   - تقرير التنبيهات: الأصناف التي تحتاج إعادة طلب
   - تقرير الجرد: الفروقات بين المسجل والفعلي`,
    },
  },
  {
    match: (path) => path === "/dashboard/inventory/suppliers",
    info: {
      title: "الموردين",
      description: "إدارة بيانات الموردين والتعاقدات.",
      process: `1) تسجيل المورد وبيانات الاتصال
2) تصنيف المورد وربطه بالأصناف
3) متابعة حالة التعاقد والنشاط`,
      mechanism: `- جدول موردين مع مرشحات
- CRUD عبر tRPC
- ربط بأوامر الشراء والفواتير لاحقاً`,
      relatedScreens: [
        { name: "أوامر الشراء", path: "/dashboard/inventory/purchase-orders", description: "إصدار طلبات من المورد" },
        { name: "المشتريات (مخصص)", path: "/dashboard/custom/purchases", description: "تجارب النظام المخصص" },
      ],
      businessLogic: "توثيق الموردين يدعم الشراء المنظم والتقييم الدوري للأداء.",
    },
  },
  {
    match: (path) => path === "/dashboard/inventory/purchase-orders",
    info: {
      title: "أوامر الشراء",
      description: "إنشاء ومتابعة أوامر الشراء.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: inventory.purchaseOrders.list.useQuery() مع معاملات:
     * businessId (مطلوب)
     * supplierId (اختياري - للفلترة حسب المورد)
     * status (اختياري - مسودة/معتمد/مستلم جزئياً/مستلم/ملغي)
     * dateFrom, dateTo (للفلترة حسب التاريخ)
     * page, limit (للترقيم)
   - عرض الأوامر في جدول مع أعمدة: الرقم، التاريخ، المورد، المستودع، المبلغ، الحالة
   - تطبيق فلاتر متعددة
   - عرض ملخص: إجمالي الأوامر، المعتمدة، المستلمة

2) إنشاء أمر شراء جديد:
   - النقر على "إضافة أمر شراء"
   - فتح نموذج يحتوي على:
     أ) البيانات الأساسية:
        * المورد (اختيار من قائمة الموردين) - مطلوب
        * المستودع (اختيار من قائمة المستودعات) - مطلوب
        * التاريخ (مطلوب - افتراضي: اليوم)
        * تاريخ التسليم المتوقع (اختياري)
        * المرجع (اختياري - رقم طلب داخلي...)
     ب) البنود:
        * إضافة صنف (اختيار من قائمة الأصناف)
        * الكمية المطلوبة (مطلوب - يجب أن تكون > 0)
        * السعر (مطلوب - يمكن جلب السعر الأخير من المورد تلقائياً)
        * الوحدة (يتم جلبها من الصنف تلقائياً)
        * إجمالي السطر = الكمية × السعر
        * يمكن إضافة عدة بنود
     ج) الملخص:
        * إجمالي الكمية
        * إجمالي المبلغ
        * الضريبة (إن وُجدت)
        * المبلغ الإجمالي
     د) معلومات إضافية:
        * شروط الدفع (اختياري)
        * شروط التسليم (اختياري)
        * الملاحظات (اختياري)
   - التحقق من:
     * أن المورد نشط
     * أن جميع الأصناف نشطة
     * أن الكميات والأسعار > 0
   - حفظ الأمر بحالة "مسودة" عبر tRPC: inventory.purchaseOrders.create
   - عند النجاح: إغلاق النموذج وتحديث القائمة

3) اعتماد أمر الشراء:
   - من قائمة الأوامر: النقر على "اعتماد"
   - التحقق من:
     * أن جميع البنود صحيحة
     * أن المورد نشط
   - اعتماد الأمر عبر tRPC: inventory.purchaseOrders.approve
   - تحديث الحالة إلى "معتمد"
   - إرسال إشعار للمورد (إن وُجدت هذه الميزة)

4) استلام أمر الشراء:
   - النقر على "استلام"
   - فتح نموذج استلام يحتوي على:
     * عرض بنود الأمر الأصلي
     * لكل بند:
       - الكمية المطلوبة (من الأمر)
       - الكمية المستلمة (إدخال - قد تكون أقل من المطلوبة)
       - السعر الفعلي (قد يختلف عن المطلوب)
       - ملاحظات (اختياري)
     * يمكن استلام جزء من البنود (استلام جزئي)
   - التحقق من:
     * أن الكمية المستلمة <= الكمية المطلوبة
     * أن السعر الفعلي > 0
   - حفظ الاستلام عبر tRPC: inventory.purchaseOrders.receive
   - عند الحفظ:
     * إنشاء حركة استلام تلقائياً
     * تحديث حالة الأمر:
       - إذا استُلمت جميع الكميات: "مستلم"
       - إذا استُلمت جزء: "مستلم جزئياً"
     * تحديث أرصدة المخزون
     * إنشاء فاتورة للمورد (إن وُجدت هذه الميزة)

5) تعديل أمر مسودة:
   - النقر على أمر بحالة "مسودة"
   - تعديل أي من الحقول
   - حفظ التعديلات

6) إلغاء أمر:
   - يمكن إلغاء أمر غير مستلم
   - النقر على "إلغاء"
   - إدخال سبب الإلغاء (مطلوب)
   - تحديث الحالة إلى "ملغي"

7) عرض تفاصيل الأمر:
   - النقر على رقم الأمر
   - عرض:
     * البيانات الأساسية
     * جميع البنود
     * حالة الاستلام لكل بند
     * الفواتير المرتبطة (إن وُجدت)
     * المدفوعات (إن وُجدت)`,
      mechanism: `- استعلام الأوامر:
  * tRPC: inventory.purchaseOrders.list.useQuery({ businessId, filters })
  * الإرجاع: { orders: PurchaseOrder[], total: number, summary: { draft, approved, received } }
  * PurchaseOrder type: { id, number, date, supplierId, warehouseId, status, totalAmount, items: PurchaseOrderItem[], ... }
  * PurchaseOrderItem type: { id, itemId, quantity, price, receivedQuantity, ... }
  * التحديث التلقائي: refetch عند إضافة/تعديل أمر

- نموذج الأمر:
  * استخدام React Hook Form مع array fields للبنود
  * إضافة/حذف بنود ديناميكياً
  * التحقق من:
    - supplierId: required
    - warehouseId: required
    - date: required, date format
    - items: array, minLength(1)
    - لكل بند:
      * itemId: required
      * quantity: required, number > 0
      * price: required, number > 0
  * جلب السعر الأخير:
    - عند اختيار صنف: جلب آخر سعر شراء من نفس المورد
    - tRPC: inventory.items.getLastPrice({ itemId, supplierId })

- عمليات CRUD:
  * Create: inventory.purchaseOrders.create.mutate({ businessId, ...formData })
  * Update: inventory.purchaseOrders.update.mutate({ id, ...formData }) - فقط للمسودة
  * Delete: inventory.purchaseOrders.delete.mutate({ id }) - soft delete (إلغاء)
  * Approve: inventory.purchaseOrders.approve.mutate({ id })
  * Receive: inventory.purchaseOrders.receive.mutate({ id, receivedItems })
  * معالجة الأخطاء: try-catch مع toast.error

- الاستلام:
  * عند الاستلام:
    1) التحقق من الكميات المستلمة
    2) إنشاء حركة استلام تلقائياً:
       - tRPC: inventory.movements.create({ type: 'receipt', purchaseOrderId, items })
    3) تحديث حالة الأمر:
       - إذا استُلمت جميع الكميات: status = 'received'
       - إذا استُلمت جزء: status = 'partially_received'
    4) تحديث أرصدة المخزون
    5) إنشاء فاتورة للمورد (إن وُجدت هذه الميزة):
       - tRPC: accounting.invoices.create({ type: 'purchase', supplierId, items })

- رقم الأمر:
  * يتم توليد رقم تلقائي: PO-YYYYMMDD-XXXXX
  * PO = Purchase Order
  * YYYYMMDD = التاريخ
  * XXXXX = رقم تسلسلي`,
      relatedScreens: [
        { name: "حركات المخزون", path: "/dashboard/inventory/movements", description: "تسجيل الاستلام - يتم إنشاء حركة استلام تلقائياً عند استلام الأمر" },
        { name: "الموردين", path: "/dashboard/inventory/suppliers", description: "اختيار المورد - يجب أن يكون المورد مسجل في النظام" },
        { name: "الأصناف", path: "/dashboard/inventory/items", description: "اختيار الأصناف - يتم اختيار الأصناف من القائمة" },
        { name: "المستودعات", path: "/dashboard/inventory/warehouses", description: "اختيار المستودع - يتم استلام البضائع في المستودع المحدد" },
        { name: "أرصدة المخزون", path: "/dashboard/inventory/stock-balance", description: "تأثير الاستلام - يتم تحديث الأرصدة تلقائياً عند الاستلام" },
        { name: "المحاسبة", path: "/dashboard/accounting/journal-entries", description: "القيود المحاسبية - يمكن إنشاء قيد تلقائي عند الاستلام" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) دورة حياة الأمر:
   - مسودة: تم إنشاء الأمر ولكن لم يتم اعتماده
   - معتمد: تم اعتماد الأمر ويمكن إرساله للمورد
   - مستلم جزئياً: تم استلام جزء من الكميات
   - مستلم: تم استلام جميع الكميات
   - ملغي: تم إلغاء الأمر

2) الاعتماد:
   - بعد الاعتماد: لا يمكن تعديل الأمر (يحتاج إلغاء الاعتماد)
   - يمكن إرسال الأمر للمورد بعد الاعتماد
   - الاعتماد يُسجل في سجل التغييرات

3) الاستلام:
   - يمكن استلام جزء من الكميات (استلام جزئي)
   - الكمية المستلمة يمكن أن تكون أقل من المطلوبة (نقص في التسليم)
   - السعر الفعلي يمكن أن يختلف عن المطلوب (تفاوض)
   - عند الاستلام الجزئي: يبقى الأمر مفتوحاً حتى استلام باقي الكميات

4) الربط بحركات المخزون:
   - عند الاستلام: يتم إنشاء حركة استلام تلقائياً
   - الحركة مرتبطة بأمر الشراء (reference)
   - يمكن تتبع مصدر كل حركة استلام

5) الفواتير:
   - يمكن إنشاء فاتورة للمورد تلقائياً عند الاستلام
   - الفاتورة تحتوي على:
     * البنود المستلمة
     * الأسعار الفعلية
     * المبلغ الإجمالي
   - الفاتورة تُستخدم في تسوية المدفوعات

6) المدفوعات:
   - بعد استلام الأمر: يمكن تسجيل دفع للمورد
   - المدفوعات تُربط بالفاتورة (إن وُجدت)
   - يمكن دفع جزء من المبلغ (دفع جزئي)

7) التتبع:
   - كل أمر يمكن تتبعه من الإنشاء حتى الاستلام
   - سجل التغييرات: جميع التعديلات والاعتمادات
   - سجل الاستلام: جميع عمليات الاستلام مع التواريخ

8) التقارير:
   - تقرير الأوامر: حسب المورد، الحالة، الفترة
   - تقرير الاستلام: جميع عمليات الاستلام
   - تقرير الموردين: أداء كل مورد (سرعة التسليم، جودة البضائع)
   - تقرير التكاليف: التكلفة الفعلية مقابل المتوقعة`,
    },
  },
  // Customers & Billing (core)
  {
    match: (path) => path === "/dashboard/customers/dashboard",
    info: {
      title: "لوحة تحكم العملاء",
      description: "مؤشرات العملاء والعدادات والفواتير.",
      process: `1) استعراض الملخصات (مشتركين، عدادات، فواتير)
2) التنقل السريع للعمليات (إضافة عميل، إدخال قراءة، إصدار فاتورة)`,
      mechanism: `- بطاقات ملخص وجداول مختصرة
- استعلامات مجمعة عبر tRPC`,
      relatedScreens: [
        { name: "العملاء", path: "/dashboard/customers", description: "إدارة بيانات العملاء" },
        { name: "القراءات", path: "/dashboard/customers/readings", description: "مصدر الفواتير" },
      ],
      businessLogic: "لوحة ملخص لدعم اتخاذ القرار السريع للفرق الخدمية والفوترة.",
    },
  },
  {
    match: (path) => path === "/dashboard/customers",
    info: {
      title: "العملاء",
      description: "إدارة بيانات المشتركين وربطهم بالعدادات.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: customers.list.useQuery() مع معاملات:
     * businessId (مطلوب - من السياق أو state)
     * search (اختياري - للبحث بالاسم أو الهاتف)
     * status (اختياري - نشط/غير نشط/معلق)
     * page, limit (للترقيم)
   - عرض العملاء في جدول مع أعمدة: الاسم، الهاتف، العنوان، عدد العدادات، حالة الاشتراك
   - تطبيق فلاتر البحث والترتيب

2) إنشاء عميل جديد:
   - النقر على "إضافة عميل"
   - فتح نموذج يحتوي على:
     * البيانات الأساسية: الاسم الكامل (مطلوب)، رقم الهوية/السجل (اختياري)
     * بيانات الاتصال: رقم الهاتف (مطلوب، فريد)، البريد الإلكتروني (اختياري)
     * العنوان: المدينة، الحي، الشارع، رقم المبنى (جميعها مطلوبة للفوترة)
     * بيانات الاشتراك: نوع الاستخدام (سكني/تجاري/صناعي)، تاريخ بدء الاشتراك
   - التحقق من:
     * عدم تكرار رقم الهاتف
     * صحة تنسيق الهاتف (10 أرقام، يبدأ بـ 05)
     * صحة البريد الإلكتروني (إن وُجد)
   - إرسال عبر tRPC: customers.create
   - عند النجاح: إغلاق النموذج وتحديث القائمة

3) تعديل بيانات العميل:
   - النقر على زر التعديل أو اسم العميل
   - تحميل البيانات الحالية
   - تعديل الحقول المسموح بها (الهاتف والبريد يمكن تعديلهما)
   - حفظ عبر tRPC: customers.update
   - ملاحظة: لا يمكن تعديل رقم الهوية بعد الإنشاء

4) ربط عداد بالعميل:
   - من صفحة العدادات أو من تفاصيل العميل
   - اختيار عداد غير مرتبط
   - تحديد تاريخ الربط ونوع الاشتراك
   - حفظ الربط عبر tRPC: customers.linkMeter
   - تحديث عدد العدادات في قائمة العملاء

5) عرض تفاصيل العميل:
   - النقر على اسم العميل أو زر "عرض"
   - الانتقال لصفحة تفاصيل العميل (/dashboard/customers/:id)
   - عرض تبويبات: المعلومات، العدادات، الفواتير، المدفوعات، الملاحظات

6) تعطيل/تفعيل العميل:
   - تغيير حالة العميل (نشط/معلق/ملغي)
   - عند التعطيل: يتم تعطيل جميع العدادات المرتبطة
   - عند الإلغاء: يتم إيقاف إصدار فواتير جديدة ولكن تبقى الفواتير القديمة قابلة للتحصيل`,
      mechanism: `- استعلام العملاء:
  * tRPC: customers.list.useQuery({ businessId, search?, status?, page?, limit? })
  * الإرجاع: { customers: Customer[], total: number, page: number, limit: number }
  * Customer type: { id, name, phone, email, address, idNumber, subscriptionType, status, metersCount, createdAt }
  * حالة التحميل: Skeleton loader للجدول
  * التحديث التلقائي: refetch عند تغيير الفلاتر

- نموذج العميل:
  * استخدام React Hook Form مع التحقق:
    - name: required, minLength(3), maxLength(100)
    - phone: required, pattern(/^05\d{8}$/)
    - email: optional, email format
    - address fields: required
  * التحقق من تكرار الهاتف:
    - استدعاء tRPC: customers.checkPhone قبل الحفظ
    - عرض رسالة خطأ فورية إذا كان الهاتف مستخدماً

- عمليات CRUD:
  * Create: customers.create.mutate({ businessId, ...formData })
  * Update: customers.update.mutate({ id, ...formData })
  * Delete: customers.delete.mutate({ id }) - soft delete (تعطيل)
  * معالجة الأخطاء: try-catch مع toast.error

- البحث والفلترة:
  * بحث فوري (debounced) عند الكتابة في حقل البحث
  * فلترة حسب الحالة: dropdown select
  * ترتيب: حسب الاسم أو تاريخ الإنشاء (قابل للتعديل)
  * تصدير: زر تصدير Excel (إن وُجد)`,
      relatedScreens: [
        { name: "تفاصيل العميل", path: "/dashboard/customers/:id", description: "عرض بيانات العميل الكاملة مع جميع العدادات والفواتير والمدفوعات" },
        { name: "العدادات", path: "/dashboard/customers/meters", description: "ربط العدادات بالعميل - يمكن ربط عدة عدادات لعميل واحد" },
        { name: "الفواتير", path: "/dashboard/customers/invoices", description: "إصدار ومراجعة فواتير العميل - يتم إنشاء فاتورة لكل عداد في كل فترة فوترة" },
        { name: "المدفوعات", path: "/dashboard/customers/payments", description: "تسجيل مدفوعات العميل - يتم ربط الدفع بالفاتورة المحددة" },
        { name: "القراءات", path: "/dashboard/customers/readings", description: "إدخال قراءات عدادات العميل - يتم حساب الاستهلاك بناءً على الفرق بين القراءات" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) فريدية الهاتف:
   - رقم الهاتف يجب أن يكون فريداً على مستوى النظام
   - يُستخدم كمعرّف بديل للعميل في بعض السيناريوهات
   - لا يمكن تغيير الهاتف إلا من قبل مدير النظام

2) علاقة العميل بالعداد:
   - يمكن لعميل واحد أن يملك عدة عدادات (في مواقع مختلفة)
   - كل عداد يُنشأ له اشتراك منفصل
   - عند إلغاء الاشتراك: يتم إيقاف العداد ولكن تبقى الفواتير القديمة قابلة للتحصيل

3) دورة حياة الاشتراك:
   - جديد: تم إنشاء العميل ولكن لم يتم ربط عداد بعد
   - نشط: العميل لديه عداد نشط وفواتير تُصدر له
   - معلق: تم تعطيل الاشتراك مؤقتاً (مثل: عدم السداد)
   - ملغي: تم إلغاء الاشتراك نهائياً

4) الفوترة:
   - يتم إصدار فاتورة لكل عداد في كل فترة فوترة
   - إذا كان للعميل عدة عدادات: يتم إصدار عدة فواتير منفصلة
   - يمكن دمج الفواتير في فاتورة واحدة (إن وُجدت هذه الميزة)

5) التحصيل:
   - يمكن تحصيل فواتير متعددة في دفعة واحدة
   - يتم تحديث حالة الفاتورة تلقائياً عند التسجيل
   - يمكن إصدار إيصال لكل عملية دفع

6) البيانات المطلوبة:
   - العنوان الكامل مطلوب لإصدار الفواتير
   - رقم الهاتف مطلوب للتواصل وإرسال التنبيهات
   - نوع الاستخدام يؤثر على التعريفات المطبقة

7) الأمان والخصوصية:
   - بيانات العملاء محمية ولا يمكن الوصول إليها إلا للمستخدمين المصرح لهم
   - يمكن تعيين صلاحيات محددة (مثل: قراءة فقط، أو قراءة/كتابة)`,
    },
  },
  {
    match: (path) => path === "/dashboard/customers/meters",
    info: {
      title: "العدادات",
      description: "إدارة العدادات وتعريف نوعها وربطها بالعملاء.",
      process: `1) تسجيل عداد مع رقم تسلسلي ونوع (تقليدي/STS/IoT)
2) ربطه بعميل وموقع
3) تفعيل/إيقاف العداد`,
      mechanism: `- جدول عدادات مع مرشحات النوع والحالة
- CRUD عبر API
- تكامل مع محرك التسعير لتحديد الرسوم`,
      relatedScreens: [
        { name: "القراءات", path: "/dashboard/customers/readings", description: "إدخال قراءات العداد" },
        { name: "محرك التسعير", path: "/dashboard/engines/pricing", description: "حساب الرسوم للعداد" },
      ],
      businessLogic: "العداد يحدد طريقة احتساب الفاتورة والقراءات؛ يجب ضبط النوع والربط الصحيح.",
    },
  },
  {
    match: (path) => path === "/dashboard/customers/readings",
    info: {
      title: "القراءات",
      description: "إدخال ومراجعة قراءات العدادات.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: customers.readings.list.useQuery() مع معاملات:
     * businessId (مطلوب)
     * meterId (اختياري - للفلترة حسب العداد)
     * customerId (اختياري - للفلترة حسب العميل)
     * periodId (اختياري - للفلترة حسب فترة الفوترة)
     * dateFrom, dateTo (للفلترة حسب التاريخ)
     * page, limit (للترقيم)
   - عرض القراءات في جدول مع أعمدة: التاريخ، العداد، القراءة السابقة، القراءة الحالية، الاستهلاك، الحالة
   - تطبيق فلاتر متعددة
   - عرض ملخص: إجمالي القراءات، القراءات المعلقة، القراءات المرتبطة بفواتير

2) إدخال قراءة جديدة:
   - النقر على "إضافة قراءة"
   - فتح نموذج يحتوي على:
     * اختيار العداد:
       - البحث بالرقم التسلسلي أو اسم العميل
       - اختيار من قائمة العدادات النشطة
       - عرض معلومات العداد: النوع، الموقع، آخر قراءة
     * بيانات القراءة:
       - التاريخ (مطلوب - افتراضي: اليوم)
       - القراءة الحالية (مطلوب - يجب أن تكون رقم موجب)
       - القراءة السابقة (يتم جلبها تلقائياً من آخر قراءة أو فاتورة)
       - حساب الاستهلاك تلقائياً = القراءة الحالية - القراءة السابقة
     * التحقق من القراءة:
       - إذا كانت القراءة الحالية < السابقة: عرض تحذير (مثل: استبدال عداد)
       - إذا كان الاستهلاك غير طبيعي (كبير جداً): عرض تحذير
       - إمكانية إضافة ملاحظات (مثل: عداد جديد، استبدال...)
     * ربط القراءة:
       - فترة الفوترة (اختياري - للربط بفترة محددة)
       - القارئ (اختياري - اسم الشخص الذي أخذ القراءة)
   - التحقق من:
     * أن العداد نشط
     * أن القراءة الحالية >= القراءة السابقة (إلا مع سبب)
     * أن الاستهلاك منطقي (لا يتجاوز حد معين)
   - حفظ القراءة عبر tRPC: customers.readings.create
   - عند النجاح: إغلاق النموذج وتحديث القائمة

3) الإدخال الجماعي (Batch):
   - النقر على "إدخال جماعي"
   - تحميل ملف Excel أو CSV يحتوي على:
     * رقم العداد/الرقم التسلسلي
     * القراءة الحالية
     * التاريخ (اختياري)
   - معالجة الملف:
     * قراءة كل صف
     * التحقق من صحة البيانات
     * جلب القراءة السابقة لكل عداد
     * حساب الاستهلاك
   - عرض معاينة: جميع القراءات مع التحقق
   - تأكيد الإدخال
   - معالجة الأخطاء: إذا فشل إدخال قراءة لعداد معين، يتم تخطيه وتسجيل الخطأ
   - عرض تقرير بالإدخالات الناجحة والفاشلة

4) تعديل قراءة:
   - يمكن تعديل قراءة فقط إذا كانت:
     * غير مرتبطة بفاتورة
     * الفترة مفتوحة
   - النقر على "تعديل"
   - تعديل القراءة الحالية أو التاريخ
   - إعادة حساب الاستهلاك تلقائياً
   - حفظ التعديلات

5) حذف قراءة:
   - يمكن حذف قراءة فقط إذا كانت غير مرتبطة بفاتورة
   - النقر على "حذف"
   - تأكيد الحذف
   - حذف القراءة عبر tRPC: customers.readings.delete

6) ربط القراءة بفاتورة:
   - عند إصدار فاتورة: يتم ربط القراءة بالفاتورة تلقائياً
   - لا يمكن تعديل قراءة مرتبطة بفاتورة
   - يمكن عرض جميع الفواتير المرتبطة بقراءة معينة

7) عرض تفاصيل القراءة:
   - النقر على قراءة في الجدول
   - عرض:
     * معلومات العداد: الرقم، النوع، الموقع
     * بيانات القراءة: التاريخ، القراءة السابقة، الحالية، الاستهلاك
     * الفواتير المرتبطة (إن وُجدت)
     * الملاحظات`,
      mechanism: `- استعلام القراءات:
  * tRPC: customers.readings.list.useQuery({ businessId, filters })
  * الإرجاع: { readings: Reading[], total: number, summary: { total, pending, linked } }
  * Reading type: { id, meterId, date, readingValue, previousReading, consumption, reader, periodId, invoiceId, notes, ... }
  * التحديث التلقائي: refetch عند إضافة/تعديل قراءة

- نموذج القراءة:
  * استخدام React Hook Form مع التحقق:
    - meterId: required
    - date: required, date format
    - readingValue: required, number >= 0
    - previousReading: optional (يتم جلبها تلقائياً)
  * جلب القراءة السابقة:
    - عند اختيار العداد: جلب آخر قراءة أو آخر فاتورة
    - tRPC: customers.readings.getLast({ meterId })
    - إذا لم تُوجد: عرض 0 كقراءة أولية
  * حساب الاستهلاك:
    - consumption = readingValue - previousReading
    - إذا كان consumption < 0: عرض تحذير
    - إذا كان consumption كبير جداً: عرض تحذير (قد يكون خطأ)

- عمليات CRUD:
  * Create: customers.readings.create.mutate({ businessId, meterId, date, readingValue, ... })
  * Update: customers.readings.update.mutate({ id, ...data }) - فقط للقراءات غير المرتبطة
  * Delete: customers.readings.delete.mutate({ id }) - فقط للقراءات غير المرتبطة
  * معالجة الأخطاء: try-catch مع toast.error

- الإدخال الجماعي:
  * تحميل ملف Excel/CSV
  * معالجة الملف:
    - قراءة كل صف
    - التحقق من صحة البيانات
    - جلب القراءة السابقة لكل عداد
    - حساب الاستهلاك
  * عرض معاينة قبل الحفظ
  * حفظ جميع القراءات دفعة واحدة
  * tRPC: customers.readings.batchCreate.mutate({ readings: [...] })

- الربط بالفاتورة:
  * عند إصدار فاتورة: يتم ربط القراءة بالفاتورة
  * tRPC: invoices.create يستدعي customers.readings.linkInvoice({ readingId, invoiceId })
  * بعد الربط: لا يمكن تعديل القراءة

- التحقق من الاستهلاك:
  * حساب متوسط الاستهلاك السابق للعداد
  * مقارنة الاستهلاك الحالي بالمتوسط
  * إذا كان الفرق كبير (> 50%): عرض تحذير
  * يمكن تجاوز التحذير مع تسجيل سبب`,
      relatedScreens: [
        { name: "الفواتير", path: "/dashboard/customers/invoices", description: "استخدام القراءة - يتم استخدام القراءة في حساب الفاتورة" },
        { name: "العدادات", path: "/dashboard/customers/meters", description: "مصدر العداد - يجب أن يكون العداد مسجل ونشط" },
        { name: "فترات الفوترة", path: "/dashboard/customers/billing-periods", description: "ربط القراءة بالفترة - يمكن ربط القراءة بفترة فوترة محددة" },
        { name: "العملاء", path: "/dashboard/customers", description: "مصدر العملاء - يتم عرض القراءات في تفاصيل العميل" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) دورة حياة القراءة:
   - جديدة: تم إدخال القراءة ولكن لم يتم ربطها بفاتورة
   - مرتبطة: تم ربط القراءة بفاتورة (لا يمكن تعديلها)
   - ملغاة: تم إلغاء القراءة (لا تُستخدم في الفواتير)

2) حساب الاستهلاك:
   - الاستهلاك = القراءة الحالية - القراءة السابقة
   - إذا كانت القراءة الحالية < السابقة:
     * قد يكون عداد جديد (يتم إعادة التعيين)
     * قد يكون خطأ في الإدخال
     * يجب تسجيل سبب
   - إذا كان الاستهلاك = 0:
     * قد يكون العداد معطل
     * قد يكون هناك مشكلة في القراءة

3) التحقق من القراءة:
   - يجب أن تكون القراءة الحالية >= السابقة (إلا مع سبب)
   - الاستهلاك يجب أن يكون منطقياً:
     * لا يتجاوز حد معين (مثل: 1000 وحدة في شهر)
     * لا يكون سالباً
   - إذا كان الاستهلاك غير طبيعي: عرض تحذير وطلب التأكيد

4) الربط بالفاتورة:
   - عند إصدار فاتورة: يتم استخدام القراءة في الحساب
   - بعد الربط: لا يمكن تعديل أو حذف القراءة
   - يمكن ربط قراءة واحدة بفاتورة واحدة فقط

5) القراءات المتعددة:
   - يمكن إدخال عدة قراءات لنفس العداد في نفس الفترة
   - عند إصدار الفاتورة: يتم استخدام آخر قراءة
   - القراءات السابقة تُستخدم كتاريخ

6) الإدخال الجماعي:
   - مفيد عند إدخال قراءات لعدة عدادات دفعة واحدة
   - يجب أن يكون الملف بتنسيق محدد:
     * عمود 1: رقم العداد/الرقم التسلسلي
     * عمود 2: القراءة الحالية
     * عمود 3: التاريخ (اختياري)
   - معالجة الأخطاء: إذا فشل إدخال قراءة، يتم تخطيها ومتابعة البقية

7) القارئ:
   - يمكن تسجيل اسم الشخص الذي أخذ القراءة
   - يُستخدم في:
     * التتبع والمسؤولية
     * تقارير الأداء
     * اكتشاف الأخطاء

8) التقارير:
   - تقرير القراءات: حسب العداد، الفترة، القارئ
   - تقرير الاستهلاك: متوسط الاستهلاك لكل عداد
   - تقرير الأخطاء: القراءات غير الطبيعية`,
    },
  },
  {
    match: (path) => path === "/dashboard/customers/tariffs",
    info: {
      title: "التعريفات",
      description: "إدارة تعريفات الأسعار حسب الفئة والاستهلاك.",
      process: `1) إنشاء تعريفه مع شرائح الاستهلاك أو الفئة
2) تعيين العملة والقيم
3) تفعيل/تعطيل التعريفه`,
      mechanism: `- جدول تعريفات
- نماذج شرائح/قيم
- ربط بمحرك التسعير عند الحساب`,
      relatedScreens: [
        { name: "محرك التسعير", path: "/dashboard/engines/pricing", description: "حساب السعر باستخدام التعريفات" },
        { name: "الفواتير", path: "/dashboard/customers/invoices", description: "تطبيق التعريفه على الفواتير" },
      ],
      businessLogic: "التعريفات تضبط سعر الاستهلاك؛ تفعيلها الصحيح ضروري لحساب الفواتير بدقة.",
    },
  },
  {
    match: (path) => path === "/dashboard/customers/billing-periods",
    info: {
      title: "فترات الفوترة",
      description: "إدارة الفترات الزمنية لإصدار الفواتير.",
      process: `1) تحديد بداية/نهاية الفترة
2) إغلاق الفترة بعد إصدار الفواتير
3) منع التعديلات بعد الإغلاق`,
      mechanism: `- جدول فترات مع حالة (مفتوحة/مغلقة)
- إنشاء/إغلاق عبر API
- ربط بإصدار الفواتير`,
      relatedScreens: [
        { name: "الفواتير", path: "/dashboard/customers/invoices", description: "إصدار الفواتير ضمن الفترة" },
        { name: "القراءات", path: "/dashboard/customers/readings", description: "إدخال القراءات داخل الفترة" },
      ],
      businessLogic: "إغلاق الفترة يحفظ نزاهة البيانات ويمنع التعديل على فواتير سابقة.",
    },
  },
  {
    match: (path) => path === "/dashboard/customers/invoices",
    info: {
      title: "الفواتير",
      description: "إصدار ومراجعة فواتير المشتركين.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: invoices.list.useQuery() مع معاملات:
     * businessId (مطلوب)
     * customerId (اختياري - للفلترة حسب العميل)
     * meterId (اختياري - للفلترة حسب العداد)
     * periodId (اختياري - للفلترة حسب فترة الفوترة)
     * status (اختياري - مسددة/غير مسددة/جزئية/ملغاة)
     * dateFrom, dateTo (للفلترة حسب التاريخ)
     * page, limit (للترقيم)
   - عرض الفواتير في جدول مع أعمدة: رقم الفاتورة، العميل، العداد، الفترة، المبلغ، الحالة، تاريخ الإصدار
   - تطبيق فلاتر متعددة مع إمكانية الحفظ

2) إصدار فاتورة جديدة:
   أ) الطريقة اليدوية:
      - النقر على "إصدار فاتورة"
      - اختيار العميل من قائمة منسدلة (مع بحث)
      - اختيار العداد المرتبط بالعميل
      - اختيار فترة الفوترة (يجب أن تكون مفتوحة)
      - النقر على "حساب الفاتورة"
      - يتم استدعاء tRPC: pricing.calculate مع:
        * businessId, meterId, periodId
      - يتم جلب:
        * القراءة السابقة (من آخر فاتورة أو قراءة أولية)
        * القراءة الحالية (من سجل القراءات للفترة)
        * حساب الاستهلاك = القراءة الحالية - القراءة السابقة
        * تطبيق التعريفات حسب نوع العداد ونوع الاستخدام
        * حساب الرسوم: رسوم الاشتراك + (الاستهلاك × سعر الوحدة) + رسوم إضافية
      - عرض ملخص الحساب: الاستهلاك، السعر، الرسوم، المجموع
      - إمكانية تعديل المبالغ يدوياً (مع تسجيل سبب التعديل)
      - حفظ الفاتورة عبر tRPC: invoices.create
      - عند النجاح: إغلاق النموذج وتحديث القائمة

   ب) الإصدار الجماعي (Batch):
      - اختيار فترة فوترة
      - النقر على "إصدار فواتير للفترة"
      - يتم جلب جميع العدادات النشطة التي لها قراءات في الفترة
      - لكل عداد: حساب الفاتورة تلقائياً
      - عرض ملخص: عدد الفواتير، إجمالي المبلغ
      - تأكيد الإصدار
      - معالجة الأخطاء: إذا فشل حساب فاتورة لعداد معين، يتم تخطيه وتسجيل الخطأ
      - عرض تقرير بالإصدارات الناجحة والفاشلة

3) مراجعة الفاتورة:
   - النقر على رقم الفاتورة أو زر "عرض"
   - فتح تفاصيل الفاتورة في modal أو صفحة منفصلة
   - عرض:
     * معلومات الفاتورة: الرقم، التاريخ، الفترة، الحالة
     * بيانات العميل: الاسم، العنوان، الهاتف
     * بيانات العداد: الرقم، النوع، الموقع
     * تفاصيل الحساب: القراءات، الاستهلاك، التعريفات المطبقة، المبالغ
     * المدفوعات: تاريخ الدفع، المبلغ، طريقة الدفع
     * الملاحظات: أي ملاحظات مضافة للفاتورة

4) تعديل الفاتورة:
   - يمكن تعديل الفاتورة فقط إذا كانت:
     * غير مسددة (أو مسددة جزئياً)
     * الفترة مفتوحة (لم يتم إغلاقها)
   - النقر على "تعديل"
   - تعديل المبالغ أو إضافة/حذف بنود
   - حفظ التعديلات مع تسجيل سبب التعديل في سجل التغييرات
   - تحديث المبلغ المستحق تلقائياً

5) إلغاء الفاتورة:
   - يمكن إلغاء الفاتورة فقط إذا كانت غير مسددة
   - النقر على "إلغاء"
   - إدخال سبب الإلغاء (مطلوب)
   - تأكيد الإلغاء
   - يتم تحديث حالة الفاتورة إلى "ملغاة"
   - إذا كانت الفاتورة مرتبطة بقيود محاسبية: يتم إلغاء القيود تلقائياً

6) طباعة/تصدير الفاتورة:
   - النقر على "طباعة" أو "تصدير PDF"
   - يتم توليد PDF بتنسيق الفاتورة الرسمي
   - إمكانية إرسال الفاتورة بالبريد الإلكتروني (إن وُجدت هذه الميزة)

7) تحديث حالة السداد:
   - يتم تحديث الحالة تلقائياً عند تسجيل دفع من صفحة المدفوعات
   - الحالات المتاحة:
     * غير مسددة: لم يتم دفع أي مبلغ
     * مسددة جزئياً: تم دفع جزء من المبلغ
     * مسددة: تم دفع المبلغ كاملاً
     * ملغاة: تم إلغاء الفاتورة`,
      mechanism: `- استعلام الفواتير:
  * tRPC: invoices.list.useQuery({ businessId, filters })
  * الإرجاع: { invoices: Invoice[], total: number, summary: { totalAmount, paidAmount, unpaidAmount } }
  * Invoice type: { id, number, customerId, meterId, periodId, readingFrom, readingTo, consumption, tariffId, amount, paidAmount, status, issueDate, dueDate, ... }
  * التحديث التلقائي: refetch عند تغيير الفلاتر أو إضافة فاتورة جديدة

- حساب الفاتورة:
  * tRPC: pricing.calculate.useQuery({ businessId, meterId, periodId })
  * الخطوات:
    1) جلب بيانات العداد: type, usageType, tariffId
    2) جلب القراءات: readingFrom (من آخر فاتورة أو قراءة أولية), readingTo (من سجل القراءات)
    3) حساب الاستهلاك: readingTo - readingFrom
    4) جلب التعريفات: tariff.rules.list({ meterType, usageType, active: true })
    5) تطبيق التعريفات:
       - إذا كان الاستهلاك ضمن شريحة: تطبيق السعر المحدد للشريحة
       - إذا كان الاستهلاك يتجاوز شريحة: تطبيق نظام الشرائح المتدرجة
    6) حساب الرسوم:
       - رسوم الاشتراك: من التعريفات أو من محرك التسعير
       - رسوم الاستهلاك: الاستهلاك × سعر الوحدة
       - رسوم إضافية: من feeTypes (إن وُجدت)
    7) إرجاع: { consumption, tariff, subscriptionFee, consumptionFee, additionalFees, total }

- إنشاء الفاتورة:
  * tRPC: invoices.create.mutate({ businessId, customerId, meterId, periodId, ...calculationResult })
  * التحقق من:
    - عدم وجود فاتورة سابقة لنفس العداد والفترة
    - الفترة مفتوحة
    - العداد نشط
  * إنشاء رقم فاتورة تلقائي: INV-YYYYMMDD-XXXXX (رقم تسلسلي)
  * حفظ الفاتورة مع جميع التفاصيل
  * ربط الفاتورة بالقراءات المستخدمة
  * إنشاء قيد محاسبي تلقائي (إن وُجد محرك القيود):
    - مدين: حساب العملاء (الذمم المدينة)
    - دائن: حساب الإيرادات

- تحديث حالة السداد:
  * يتم تحديث paidAmount تلقائياً عند تسجيل دفع
  * tRPC: invoices.updatePayment.mutate({ invoiceId, amount })
  * تحديث status بناءً على: paidAmount === amount ? 'paid' : paidAmount > 0 ? 'partial' : 'unpaid'
  * إذا أصبحت مسددة بالكامل: تحديث القيد المحاسبي (تحويل من ذمم مدينة إلى نقد/بنك)

- التصدير والطباعة:
  * توليد PDF باستخدام مكتبة مثل react-pdf أو jsPDF
  * تنسيق الفاتورة: رأس (شعار الشركة، معلومات الاتصال)، بيانات العميل، تفاصيل الفاتورة، تذييل
  * إمكانية إرسال بالبريد: tRPC: invoices.sendEmail.mutate({ invoiceId, email })`,
      relatedScreens: [
        { name: "المدفوعات", path: "/dashboard/customers/payments", description: "تسجيل التحصيل - عند تسجيل دفع، يتم تحديث حالة الفاتورة تلقائياً" },
        { name: "محرك التسعير", path: "/dashboard/engines/pricing", description: "حساب الرسوم - يتم استخدام قواعد التسعير المحددة في المحرك" },
        { name: "القراءات", path: "/dashboard/customers/readings", description: "مصدر القراءات - يجب إدخال القراءات قبل إصدار الفاتورة" },
        { name: "فترات الفوترة", path: "/dashboard/customers/billing-periods", description: "إدارة الفترات - يجب أن تكون الفترة مفتوحة لإصدار فواتير جديدة" },
        { name: "التعريفات", path: "/dashboard/customers/tariffs", description: "إدارة التعريفات - يتم تطبيق التعريفات النشطة على الفواتير" },
        { name: "محرك القيود", path: "/dashboard/engines/auto-journal", description: "إنشاء قيود محاسبية - يتم إنشاء قيد تلقائي لكل فاتورة" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) دورة حياة الفاتورة:
   - مسودة: تم إنشاء الفاتورة ولكن لم يتم اعتمادها بعد (يمكن التعديل)
   - معتمدة: تم اعتماد الفاتورة وتم إصدارها (يمكن الطباعة والتحصيل)
   - مسددة جزئياً: تم دفع جزء من المبلغ
   - مسددة: تم دفع المبلغ كاملاً
   - ملغاة: تم إلغاء الفاتورة (لا يمكن تحصيلها)

2) فريدية الفاتورة:
   - لا يمكن إصدار فاتورة لنفس العداد في نفس الفترة
   - إذا وُجدت فاتورة سابقة: يتم عرض تحذير مع إمكانية تعديل الفاتورة القديمة

3) حساب الاستهلاك:
   - الاستهلاك = القراءة الحالية - القراءة السابقة
   - إذا كانت القراءة الحالية أقل من السابقة (مثل: استبدال عداد): يتم اعتبار الاستهلاك = 0
   - إذا كانت القراءة السابقة غير موجودة (عداد جديد): يتم اعتبار الاستهلاك = القراءة الحالية

4) تطبيق التعريفات:
   - يتم البحث عن التعريفات النشطة التي تطابق:
     * نوع العداد (تقليدي/STS/IoT)
     * نوع الاستخدام (سكني/تجاري/صناعي)
   - إذا وُجدت عدة تعريفات: يتم استخدام الأحدث (حسب تاريخ الإنشاء)
   - إذا لم تُوجد تعريفات: يتم استخدام التعريفات الافتراضية أو عرض تحذير

5) نظام الشرائح:
   - إذا كانت التعريفات تستخدم نظام الشرائح:
     * الشريحة الأولى (0-50): سعر X
     * الشريحة الثانية (51-100): سعر Y
     * الشريحة الثالثة (أكثر من 100): سعر Z
   - يتم حساب المبلغ لكل شريحة ثم جمعها

6) الرسوم الإضافية:
   - رسوم الاشتراك: مبلغ ثابت يُضاف لكل فاتورة
   - رسوم إعادة التوصيل: تُضاف عند إعادة توصيل الخدمة
   - رسوم التأخير: تُضاف للفواتير المتأخرة (بعد تاريخ الاستحقاق)

7) التعديلات اليدوية:
   - يمكن تعديل المبالغ يدوياً ولكن يجب تسجيل سبب التعديل
   - يتم حفظ سجل التعديلات (audit trail) لكل فاتورة
   - التعديلات اليدوية تتطلب صلاحية خاصة

8) الربط المحاسبي:
   - عند إصدار الفاتورة: يتم إنشاء قيد محاسبي تلقائي:
     * مدين: حساب العملاء (الذمم المدينة) = مبلغ الفاتورة
     * دائن: حساب الإيرادات = مبلغ الفاتورة
   - عند تحصيل الفاتورة: يتم تحديث القيد:
     * مدين: حساب النقد/البنك = المبلغ المدفوع
     * دائن: حساب العملاء (الذمم المدينة) = المبلغ المدفوع

9) الفترات المغلقة:
   - لا يمكن إصدار فواتير جديدة لفترة مغلقة
   - لا يمكن تعديل فواتير فترة مغلقة
   - يمكن فقط مراجعة وطباعة فواتير الفترات المغلقة

10) التقارير:
    - تقرير الفواتير الصادرة: حسب الفترة، الحالة، العميل
    - تقرير الفواتير غير المسددة: للتحصيل
    - تقرير الإيرادات: حسب الفترة مع تفصيل حسب نوع الاستخدام`,
    },
  },
  {
    match: (path) => path === "/dashboard/customers/payments",
    info: {
      title: "المدفوعات",
      description: "تسجيل تحصيل فواتير العملاء.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: customers.payments.list.useQuery() مع معاملات:
     * businessId (مطلوب)
     * customerId (اختياري - للفلترة حسب العميل)
     * invoiceId (اختياري - للفلترة حسب الفاتورة)
     * paymentMethodId (اختياري - للفلترة حسب طريقة الدفع)
     * dateFrom, dateTo (للفلترة حسب التاريخ)
     * page, limit (للترقيم)
   - عرض المدفوعات في جدول مع أعمدة: التاريخ، العميل، الفاتورة، المبلغ، طريقة الدفع، الحالة
   - تطبيق فلاتر متعددة
   - عرض ملخص: إجمالي المدفوعات، حسب طريقة الدفع، حسب الفترة

2) تسجيل دفع جديد:
   - النقر على "تسجيل دفع"
   - فتح نموذج يحتوي على:
     أ) اختيار الفاتورة/العميل:
        * البحث بالرقم التسلسلي للفاتورة أو اسم العميل
        * اختيار من قائمة الفواتير غير المسددة
        * عرض معلومات الفاتورة: الرقم، المبلغ، المبلغ المدفوع، المبلغ المتبقي
     ب) بيانات الدفع:
        * المبلغ (مطلوب - يجب أن يكون > 0 و <= المبلغ المتبقي)
        * طريقة الدفع (اختيار من قائمة - نقد، بطاقة، تحويل بنكي...)
        * تاريخ الدفع (مطلوب - افتراضي: اليوم)
        * المرجع (اختياري - رقم إيصال، رقم شيك...)
     ج) معلومات إضافية:
        * الصندوق/البنك (اختياري - إذا كان الدفع نقداً أو تحويلاً)
        * الملاحظات (اختياري)
   - التحقق من:
     * أن المبلغ <= المبلغ المتبقي
     * أن الفاتورة غير مسددة بالكامل
     * أن طريقة الدفع نشطة
   - حفظ الدفع عبر tRPC: customers.payments.create
   - عند النجاح:
     * تحديث حالة الفاتورة تلقائياً
     * إنشاء إيصال (إن وُجدت هذه الميزة)
     * إنشاء قيد محاسبي (إن وُجد محرك القيود)
     * إغلاق النموذج وتحديث القائمة

3) الدفع الجماعي:
   - اختيار عدة فواتير لنفس العميل
   - إدخال المبلغ الإجمالي
   - توزيع المبلغ على الفواتير تلقائياً أو يدوياً
   - حفظ جميع المدفوعات دفعة واحدة

4) تعديل دفع:
   - يمكن تعديل دفع فقط إذا كان:
     * غير مرتبط بقيد محاسبي
     * في نفس اليوم (مع صلاحية خاصة)
   - النقر على "تعديل"
   - تعديل المبلغ أو طريقة الدفع
   - حفظ التعديلات مع تحديث الفاتورة

5) إلغاء دفع:
   - يمكن إلغاء دفع فقط إذا كان:
     * غير مرتبط بقيد محاسبي
     * الفترة مفتوحة
   - النقر على "إلغاء"
   - إدخال سبب الإلغاء (مطلوب)
   - تأكيد الإلغاء
   - تحديث حالة الفاتورة تلقائياً

6) طباعة إيصال:
   - النقر على "طباعة إيصال"
   - توليد PDF للإيصال
   - إمكانية إرسال الإيصال بالبريد الإلكتروني

7) عرض تفاصيل الدفع:
   - النقر على دفع في الجدول
   - عرض:
     * معلومات الدفع: التاريخ، المبلغ، طريقة الدفع
     * معلومات الفاتورة: الرقم، المبلغ، المتبقي
     * معلومات العميل: الاسم، الهاتف
     * القيد المحاسبي المرتبط (إن وُجد)`,
      mechanism: `- استعلام المدفوعات:
  * tRPC: customers.payments.list.useQuery({ businessId, filters })
  * الإرجاع: { payments: Payment[], total: number, summary: { totalAmount, byMethod, byPeriod } }
  * Payment type: { id, invoiceId, customerId, amount, paymentMethodId, date, reference, cashboxId, status, ... }
  * التحديث التلقائي: refetch عند إضافة/تعديل دفع

- نموذج الدفع:
  * استخدام React Hook Form مع التحقق:
    - invoiceId: required
    - amount: required, number > 0, max = invoice.remainingAmount
    - paymentMethodId: required
    - date: required, date format
    - reference: optional
  * جلب بيانات الفاتورة:
    - عند اختيار الفاتورة: جلب المبلغ والمبلغ المدفوع
    - tRPC: invoices.get({ id })
    - حساب المبلغ المتبقي: invoice.amount - invoice.paidAmount
  * التحقق من المبلغ:
    - المبلغ يجب أن يكون <= المبلغ المتبقي
    - إذا كان المبلغ > المتبقي: عرض تحذير

- عمليات CRUD:
  * Create: customers.payments.create.mutate({ businessId, invoiceId, amount, ... })
  * Update: customers.payments.update.mutate({ id, ...data }) - فقط للدفعات غير المرتبطة
  * Delete: customers.payments.delete.mutate({ id }) - soft delete (إلغاء)
  * معالجة الأخطاء: try-catch مع toast.error

- تحديث الفاتورة:
  * عند تسجيل دفع:
    1) تحديث paidAmount: invoice.paidAmount += payment.amount
    2) تحديث status:
       - إذا paidAmount === invoice.amount: status = 'paid'
       - إذا paidAmount > 0: status = 'partial'
       - إذا paidAmount === 0: status = 'unpaid'
    3) tRPC: invoices.updatePayment({ id, paidAmount, status })

- الربط المحاسبي:
  * عند تسجيل دفع: إنشاء قيد محاسبي تلقائياً (إن وُجد محرك القيود)
  * القيد:
    - مدين: حساب النقد/البنك (حسب طريقة الدفع)
    - دائن: حساب العملاء (الذمم المدينة)
  * tRPC: accounting.journalEntries.create({ type: 'payment', paymentId, ... })

- الإيصال:
  * توليد PDF للإيصال
  * يحتوي على: رقم الإيصال، تاريخ الدفع، المبلغ، طريقة الدفع، معلومات الفاتورة
  * إمكانية إرسال بالبريد: tRPC: payments.sendReceipt({ id, email })`,
      relatedScreens: [
        { name: "الفواتير", path: "/dashboard/customers/invoices", description: "مصدر الفواتير - يتم تحديث حالة الفاتورة تلقائياً عند تسجيل الدفع" },
        { name: "طرق الدفع", path: "/dashboard/billing/payment-methods", description: "إدارة طرق الدفع - يجب أن تكون طريقة الدفع نشطة" },
        { name: "الصناديق", path: "/dashboard/billing/cashboxes", description: "إدارة الصناديق - يمكن ربط الدفع بالصندوق" },
        { name: "محرك القيود", path: "/dashboard/engines/auto-journal", description: "إنشاء قيود محاسبية - يتم إنشاء قيد تلقائي لكل دفع" },
        { name: "محرك التسوية", path: "/dashboard/engines/reconciliation", description: "مطابقة الحسابات - يمكن ربط المدفوعات بالحسابات الوسيطة" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) دورة حياة الدفع:
   - مسجل: تم تسجيل الدفع ولكن لم يتم تأكيده
   - مؤكد: تم تأكيد الدفع وتحديث الفاتورة
   - ملغي: تم إلغاء الدفع (تم عكس التحديثات)

2) المبلغ:
   - المبلغ يجب أن يكون > 0
   - المبلغ يجب أن يكون <= المبلغ المتبقي للفاتورة
   - يمكن دفع جزء من الفاتورة (دفع جزئي)
   - يمكن دفع عدة فواتير في دفعة واحدة

3) تحديث الفاتورة:
   - عند تسجيل دفع: يتم تحديث paidAmount تلقائياً
   - حالة الفاتورة تتغير بناءً على المبلغ المدفوع:
     * غير مسددة: paidAmount = 0
     * مسددة جزئياً: 0 < paidAmount < amount
     * مسددة: paidAmount = amount

4) طرق الدفع:
   - نقد: يتم ربط الدفع بالصندوق
   - بطاقة: يتم ربط الدفع بجهاز الدفع
   - تحويل بنكي: يتم ربط الدفع بالحساب البنكي
   - شيك: يتم ربط الدفع برقم الشيك

5) الربط المحاسبي:
   - عند تسجيل دفع: يتم إنشاء قيد محاسبي تلقائياً
   - القيد:
     * مدين: حساب النقد/البنك (حسب طريقة الدفع)
     * دائن: حساب العملاء (الذمم المدينة)
   - إذا تم إلغاء الدفع: يتم عكس القيد

6) الإيصال:
   - يتم توليد إيصال لكل دفع
   - الإيصال يحتوي على:
     * رقم الإيصال (فريد)
     * تاريخ الدفع
     * المبلغ
     * طريقة الدفع
     * معلومات الفاتورة
   - يمكن طباعة الإيصال أو إرساله بالبريد

7) الدفع الجماعي:
   - يمكن دفع عدة فواتير في دفعة واحدة
   - توزيع المبلغ على الفواتير:
     * تلقائياً: حسب المبلغ المتبقي لكل فاتورة
     * يدوياً: المستخدم يحدد المبلغ لكل فاتورة
   - يتم إنشاء عدة مدفوعات منفصلة

8) التقارير:
   - تقرير المدفوعات: حسب الفترة، طريقة الدفع، العميل
   - تقرير التحصيل: معدل التحصيل، الفواتير المتأخرة
   - تقرير التدفقات النقدية: المدفوعات اليومية/الشهرية`,
    },
  },
  // STS System - نظام عدادات STS
  {
    match: (path) => path === "/dashboard/sts/meters",
    info: {
      title: "إدارة عدادات STS",
      description: "إدارة عدادات STS (Smart Token System) وربطها بالعملاء.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: sts.meters.list.useQuery() مع معاملات:
     * businessId (مطلوب)
     * customerId (اختياري - للفلترة حسب العميل)
     * status (اختياري - نشط/غير نشط/معطل/منقطع)
     * search (اختياري - البحث برقم العداد أو اسم العميل)
     * page, limit (للترقيم)
   - عرض العدادات في جدول مع معلومات: رقم العداد STS، العميل، الرقم التسلسلي، الرصيد، الحالة

2) إضافة عداد STS جديد:
   - النقر على "إضافة عداد STS"
   - فتح نموذج يحتوي على:
     * رقم العداد STS (مطلوب، فريد)
     * العميل (اختيار من قائمة - مطلوب)
     * العداد الأساسي (اختياري - ربط بعداد موجود)
     * معلومات العداد: الرقم التسلسلي، الصانع، الموديل
     * إعدادات API (اختياري - ربط بإعدادات API مقدم الخدمة)
     * تاريخ التركيب (اختياري)
     * ملاحظات (اختياري)
   - حفظ العداد عبر tRPC: sts.meters.create
   - عند النجاح: إغلاق النموذج وتحديث القائمة

3) ربط عداد STS بعميل:
   - النقر على "ربط" في صف العداد
   - اختيار العميل والعداد الأساسي
   - حفظ الربط عبر tRPC: sts.meters.linkToCustomer

4) تحديث حالة العداد:
   - تغيير الحالة (نشط/غير نشط/معطل/منقطع)
   - تحديث تلقائي للقائمة بعد الحفظ`,
      mechanism: `- استعلام tRPC: sts.meters.list.useQuery({ businessId, filters })
- نموذج CRUD مع التحقق من البيانات
- ربط بالعملاء والعدادات الأساسية
- تحديث فوري للقائمة بعد الحفظ
- البحث والفلترة في الوقت الفعلي`,
      relatedScreens: [
        { name: "شحن الرصيد", path: "/dashboard/sts/charging", description: "شحن رصيد عداد STS - يجب أن يكون العداد مسجل قبل الشحن" },
        { name: "التوكنات", path: "/dashboard/sts/tokens", description: "عرض وإدارة التوكنات المُنشأة" },
        { name: "إعدادات API", path: "/dashboard/sts/integration", description: "إعدادات التكامل مع API مقدم الخدمة" },
        { name: "العملاء", path: "/dashboard/customers", description: "مصدر العملاء - يجب أن يكون العميل مسجل قبل ربط العداد" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) عدادات STS:
   - كل عداد STS يجب أن يكون مرتبطاً بعميل
   - يمكن ربط عداد STS بعداد أساسي موجود
   - رقم العداد STS يجب أن يكون فريداً

2) الحالة:
   - نشط: العداد يعمل بشكل طبيعي ويمكن شحن الرصيد
   - غير نشط: العداد متوقف مؤقتاً
   - معطل: العداد به عطل ويحتاج صيانة
   - منقطع: العداد منقطع عن الخدمة

3) الرصيد:
   - الرصيد الحالي يُحدث تلقائياً عند شحن الرصيد
   - يمكن عرض الرصيد من API مقدم الخدمة

4) الربط بالعملاء:
   - يجب ربط كل عداد STS بعميل واحد على الأقل
   - يمكن تغيير الربط لاحقاً`,
    },
  },
  {
    match: (path) => path === "/dashboard/sts/charging",
    info: {
      title: "شحن رصيد عدادات STS",
      description: "شحن رصيد عدادات STS وإنشاء التوكنات.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: sts.charging.list.useQuery() لجلب طلبات الشحن
   - عرض الطلبات في جدول مع الحالة

2) إنشاء طلب شحن جديد:
   - اختيار العداد STS من القائمة
   - إدخال المبلغ المطلوب شحنه (مطلوب، > 0)
   - اختيار طريقة الدفع (اختياري)
   - حفظ الطلب عبر tRPC: sts.charging.createCharge
   - عند النجاح:
     * يتم إنشاء طلب شحن مع رقم طلب فريد
     * يتم استدعاء API مقدم الخدمة لإنشاء التوكن
     * يتم حفظ التوكن في قاعدة البيانات
     * عرض التوكن للعميل

3) الحصول على التوكن:
   - بعد إنشاء الطلب، يتم إنشاء التوكن تلقائياً
   - عرض التوكن في واجهة مناسبة
   - إمكانية إرسال التوكن عبر SMS/Email/WhatsApp

4) التحقق من حالة الشحن:
   - النقر على "التحقق" للتحقق من حالة الطلب
   - تحديث الحالة بناءً على استجابة API
   - tRPC: sts.charging.verifyCharge`,
      mechanism: `- استعلام tRPC: sts.charging.createCharge.useMutation()
- توليد رقم طلب فريد: STS-{timestamp}-{random}
- استدعاء API مقدم الخدمة لإنشاء التوكن
- حفظ التوكن في قاعدة البيانات (sts_tokens)
- إرسال التوكن للعميل عبر قنوات متعددة
- تحديث حالة الطلب بناءً على استجابة API`,
      relatedScreens: [
        { name: "إدارة عدادات STS", path: "/dashboard/sts/meters", description: "إدارة العدادات - يجب أن يكون العداد مسجل قبل الشحن" },
        { name: "التوكنات", path: "/dashboard/sts/tokens", description: "عرض جميع التوكنات المُنشأة" },
        { name: "إعدادات API", path: "/dashboard/sts/integration", description: "إعدادات التكامل مع API مقدم الخدمة" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) شحن الرصيد:
   - شحن رصيد عداد STS يتم عن طريق إنشاء توكن يحتوي على المبلغ المشحون
   - العميل يستخدم التوكن لشحن العداد

2) طلبات الشحن:
   - كل طلب شحن له رقم فريد
   - الحالة: قيد الانتظار/قيد المعالجة/مكتمل/فشل/ملغى
   - يمكن التحقق من حالة الطلب في أي وقت

3) التوكنات:
   - كل طلب شحن ناجح ينتج توكن واحد على الأقل
   - التوكن يحتوي على: رقم التوكن، كود التوكن، المبلغ، الوحدات
   - حالة التوكن: مُنشأ/مُرسل/مُستخدم/منتهي/ملغى

4) إرسال التوكن:
   - يمكن إرسال التوكن عبر: SMS، Email، WhatsApp، طباعة، يدوي
   - يتم تسجيل وقت الإرسال والقناة المستخدمة`,
    },
  },
  // Government Support - الدعم الحكومي
  {
    match: (path) => path === "/dashboard/government-support" || path === "/dashboard/government-support/dashboard",
    info: {
      title: "لوحة تحكم الدعم الحكومي",
      description: "ملخص شامل لنظام الدعم الحكومي.",
      process: `1) عرض المؤشرات الرئيسية:
   - إجمالي العملاء المدعومين
   - العملاء النشطين
   - إجمالي الاستهلاك المدعوم
   - إجمالي مبلغ الدعم
   - نسبة استغلال الميزانية

2) عرض الإحصائيات الشهرية:
   - الاستهلاك المدعوم للشهر الحالي
   - مبلغ الدعم للشهر الحالي
   - الحصص المتبقية

3) التنقل السريع:
   - إدارة بيانات الدعم
   - إدارة الحصص
   - تتبع الاستهلاك
   - التقارير`,
      mechanism: `- استعلامات tRPC مجمعة
- عرض البيانات في بطاقات
- تحديث تلقائي للبيانات`,
      relatedScreens: [
        { name: "بيانات الدعم", path: "/dashboard/government-support/customers", description: "إدارة بيانات الدعم للمشتركين" },
        { name: "الحصص", path: "/dashboard/government-support/quotas", description: "إدارة الحصص الشهرية" },
        { name: "تتبع الاستهلاك", path: "/dashboard/government-support/consumption", description: "تتبع استهلاك الدعم" },
        { name: "التقارير", path: "/dashboard/government-support/reports", description: "تقارير صندوق الدعم" },
      ],
      businessLogic: "لوحة التحكم تعرض ملخص شامل لنظام الدعم الحكومي مع إمكانية التنقل السريع للوحدات المختلفة.",
    },
  },
  // Transition Support - دعم المرحلة الانتقالية
  {
    match: (path) => path === "/dashboard/transition-support" || path === "/dashboard/transition-support/dashboard",
    info: {
      title: "لوحة مراقبة استهلاك الدعم",
      description: "مراقبة استهلاك الدعم خلال المرحلة الانتقالية.",
      process: `1) عرض المؤشرات الرئيسية:
   - إجمالي العملاء في المرحلة الانتقالية
   - العملاء المعرضين للخطر
   - إجمالي الاستهلاك المدعوم
   - إجمالي مبلغ الدعم

2) عرض اتجاهات الاستهلاك:
   - اتجاه الاستهلاك (زيادة/ثابت/انخفاض)
   - نسبة استغلال الدعم
   - الاتجاهات الشهرية

3) عرض التنبيهات:
   - التنبيهات النشطة
   - التنبيهات الحرجة
   - التنبيهات المعترف بها`,
      mechanism: `- استعلامات tRPC مجمعة
- عرض البيانات في بطاقات ورسوم بيانية
- تحديث تلقائي للبيانات`,
      relatedScreens: [
        { name: "الإشعارات", path: "/dashboard/transition-support/notifications", description: "إدارة الإشعارات الاستباقية" },
        { name: "تعديلات الفوترة", path: "/dashboard/transition-support/billing", description: "تعديلات الفوترة للمرحلة الانتقالية" },
        { name: "التنبيهات", path: "/dashboard/transition-support/alerts", description: "إدارة التنبيهات" },
      ],
      businessLogic: "لوحة التحكم تعرض ملخص شامل لاستهلاك الدعم خلال المرحلة الانتقالية مع إمكانية التنقل السريع للوحدات المختلفة.",
    },
  },
  // Billing (main-data, invoicing, payments)
  {
    match: (path) => path === "/dashboard/billing",
    info: {
      title: "لوحة تحكم الفوترة",
      description: "ملخص وحدات الفوترة الرئيسية.",
      process: `1) استعراض المؤشرات
2) التنقل السريع للإعدادات والقراءات والفواتير`,
      mechanism: `- بطاقات ملخص وجداول مختصرة
- استعلامات مجمعة`,
      relatedScreens: [
        { name: "المناطق", path: "/dashboard/billing/areas", description: "تهيئة مناطق الفوترة" },
        { name: "الفواتير", path: "/dashboard/billing/invoices", description: "إصدار ومراجعة الفواتير" },
      ],
      businessLogic: "تجميع سريع لوضع الفوترة والجاهزية للإصدار والتحصيل.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/areas",
    info: {
      title: "المناطق",
      description: "تهيئة المناطق الإدارية للفوترة.",
      process: `1) إنشاء منطقة
2) ربطها بالمربعات/الكبائن لاحقاً
3) استخدام المنطقة في تعريفات العدادات`,
      mechanism: `- جدول مناطق
- CRUD عبر API`,
      relatedScreens: [
        { name: "المربعات", path: "/dashboard/billing/squares", description: "تقسيم أدق داخل المنطقة" },
        { name: "العدادات (فوترة)", path: "/dashboard/billing/meters", description: "ربط العدادات بالمناطق" },
      ],
      businessLogic: "المناطق تضبط التسعير أو إدارة الفرق وتساعد في التقسيم الجغرافي للفوترة.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/squares",
    info: {
      title: "المربعات",
      description: "تقسيم المنطقة إلى مربعات أصغر.",
      process: `1) اختيار المنطقة
2) إنشاء مربع وربطه بالمحطات/الكبائن
3) استخدامه في العدادات والقراءات`,
      mechanism: `- جدول مربعات مفلتر بالمنطقة
- CRUD عبر tRPC`,
      relatedScreens: [
        { name: "المناطق", path: "/dashboard/billing/areas", description: "المستوى الأعلى" },
        { name: "الكبائن", path: "/dashboard/billing/cabinets", description: "تخصيص البنية التحتية" },
      ],
      businessLogic: "يساعد على إدارة القراءة والتحصيل وتحديد نطاق العمل الميداني.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/cabinets",
    info: {
      title: "الكبائن",
      description: "تعريف الكبائن وربطها بالمربعات والمناطق.",
      process: `1) إدخال بيانات الكابينة وموقعها
2) ربطها بالمربع/المنطقة
3) ربط العدادات بالكابينة`,
      mechanism: `- CRUD عبر API
- ربط بالتدرج الجغرافي`,
      relatedScreens: [
        { name: "المربعات", path: "/dashboard/billing/squares", description: "السياق الجغرافي" },
        { name: "العدادات (فوترة)", path: "/dashboard/billing/meters", description: "وضع العدادات ضمن البنية" },
      ],
      businessLogic: "تعكس البنية التحتية للقراءة والفوترة وتساعد على تنظيم فرق الميدان.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/tariffs",
    info: {
      title: "تعريفات الفوترة",
      description: "تهيئة التعريفات داخل نظام الفوترة.",
      process: `1) إنشاء تعريفه مع شرائح أو فئات
2) ربطها بالمناطق أو أنواع العدادات
3) تفعيل التعريفه للاستخدام في الفواتير`,
      mechanism: `- نماذج شرائح/فئات
- حفظ عبر tRPC
- تكامل مع إصدار الفاتورة`,
      relatedScreens: [
        { name: "القراءات (فوترة)", path: "/dashboard/billing/readings", description: "يتم الحساب بناءً على التعريفات" },
        { name: "الفواتير (فوترة)", path: "/dashboard/billing/invoices", description: "تطبيق التعريفه عند الإصدار" },
      ],
      businessLogic: "التعريفه تضبط سعر الاستهلاك ضمن نظام الفوترة الخاص.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/fee-types",
    info: {
      title: "أنواع الرسوم",
      description: "تعريف الرسوم الإضافية للفواتير.",
      process: `1) إنشاء نوع رسم (ثابت/نسبي)
2) تحديد حالات التطبيق
3) ربطه بالخطط أو الفواتير`,
      mechanism: `- جدول أنواع رسوم
- CRUD عبر API
- استخدامه في حساب الفاتورة`,
      relatedScreens: [
        { name: "الفواتير (فوترة)", path: "/dashboard/billing/invoices", description: "تطبيق الرسوم" },
      ],
      businessLogic: "يحدد الرسوم المساندة (اشتراك، إعادة توصيل،…)، مما يؤثر على إجمالي الفاتورة.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/payment-methods",
    info: {
      title: "طرق الدفع",
      description: "إدارة قنوات الدفع المتاحة.",
      process: `1) تعريف طريقة دفع (نقد، بطاقة، تحويل)
2) تفعيل/تعطيل الطريقة
3) ربطها بالتحصيل والفواتير`,
      mechanism: `- جدول طرق الدفع
- CRUD عبر API`,
      relatedScreens: [
        { name: "التحصيل (فوترة)", path: "/dashboard/billing/payments", description: "استخدام الطرق عند تسجيل الدفع" },
      ],
      businessLogic: "تنويع قنوات الدفع يسهل التحصيل ويقلل التعثر.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/cashboxes",
    info: {
      title: "الصناديق",
      description: "إدارة صناديق التحصيل والنقدية.",
      process: `1) إنشاء صندوق وتحديد العملة والمسؤول
2) ربط التحصيل بالصندوق
3) إغلاق/مراجعة الرصيد`,
      mechanism: `- جدول صناديق
- CRUD عبر API
- ربط بحركات التحصيل`,
      relatedScreens: [
        { name: "التحصيل (فوترة)", path: "/dashboard/billing/payments", description: "توجيه المدفوعات للصندوق" },
      ],
      businessLogic: "تتبع الصناديق يمنع الفاقد ويوثق حركة النقد.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/meters",
    info: {
      title: "عدادات الفوترة",
      description: "إدارة عدادات نظام الفوترة المخصص.",
      process: `1) تسجيل العداد وربطه بالموقع/المربع
2) تحديد نوعه وحالته
3) استخدامه في القراءات والفواتير`,
      mechanism: `- جدول عدادات مع مرشحات
- CRUD عبر API`,
      relatedScreens: [
        { name: "قراءات الفوترة", path: "/dashboard/billing/readings", description: "إدخال القراءات" },
        { name: "الفواتير (فوترة)", path: "/dashboard/billing/invoices", description: "إصدار الفاتورة" },
      ],
      businessLogic: "مماثل لعدادات العملاء لكن داخل نطاق نظام الفوترة الفرعي.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/customers",
    info: {
      title: "المشتركين (فوترة)",
      description: "إدارة مشتركي نظام الفوترة الفرعي.",
      process: `1) إضافة مشترك
2) ربطه بعداد أو منطقة
3) إصدار فواتيره ضمن النظام الفرعي`,
      mechanism: `- جدول مشتركين
- CRUD عبر API
- روابط للعدادات والفواتير`,
      relatedScreens: [
        { name: "الفواتير (فوترة)", path: "/dashboard/billing/invoices", description: "إصدار الفواتير" },
      ],
      businessLogic: "هيكل مشابه للوحدة الرئيسية لكن مخصص لهذا النظام الفرعي.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/periods",
    info: {
      title: "فترات فوترة (فرعي)",
      description: "إدارة الفترات ضمن النظام الفرعي.",
      process: `1) إنشاء/إغلاق فترة
2) إصدار فواتير داخل الفترة
3) منع التعديل بعد الإغلاق`,
      mechanism: `- جدول فترات
- CRUD عبر API`,
      relatedScreens: [
        { name: "الفواتير (فوترة)", path: "/dashboard/billing/invoices", description: "إصدار ضمن الفترة" },
      ],
      businessLogic: "نفس منطق الفترات في النظام الرئيسي للحفاظ على النزاهة.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/readings",
    info: {
      title: "القراءات (فوترة)",
      description: "إدخال القراءات في النظام الفرعي.",
      process: `1) اختيار عداد
2) إدخال القراءة
3) حساب الفاتورة بناءً على التعريفات الفرعية`,
      mechanism: `- نموذج قراءة
- حفظ عبر API
- ربط بالتسعير الفرعي`,
      relatedScreens: [
        { name: "الفواتير (فوترة)", path: "/dashboard/billing/invoices", description: "إصدار بعد القراءة" },
      ],
      businessLogic: "يمثل مسار قراءة → تسعير → فاتورة ضمن النظام الفرعي.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/invoices",
    info: {
      title: "الفواتير (فوترة)",
      description: "إصدار ومراجعة فواتير النظام الفرعي.",
      process: `1) تحديد المشترك/العداد
2) حساب الرسوم
3) إصدار الفاتورة وتحديث الحالة`,
      mechanism: `- استعلام الفواتير
- حساب عبر تسعير فرعي
- تحديث الحالة`,
      relatedScreens: [
        { name: "التحصيل (فوترة)", path: "/dashboard/billing/payments", description: "تسجيل الدفع" },
      ],
      businessLogic: "يماثل الفواتير الأساسية لكن ضمن نطاق فرعي قد يختلف في السياسات.",
    },
  },
  {
    match: (path) => path === "/dashboard/billing/payments",
    info: {
      title: "التحصيل (فوترة)",
      description: "تسجيل مدفوعات فواتير النظام الفرعي.",
      process: `1) اختيار فاتورة
2) إدخال الدفع وطريقة الدفع
3) تحديث حالة الفاتورة`,
      mechanism: `- نموذج دفع
- تحديث الحالة عبر API`,
      relatedScreens: [
        { name: "الفواتير (فوترة)", path: "/dashboard/billing/invoices", description: "مصدر المبالغ" },
      ],
      businessLogic: "إغلاق الذمم ضمن النظام الفرعي وتحريك الصناديق/طرق الدفع.",
    },
  },
  // SCADA
  {
    match: (path) => path === "/dashboard/scada/monitoring",
    info: {
      title: "لوحة المراقبة",
      description: "مراقبة المستشعرات والتنبيهات لحظياً.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: scada.monitoring.getStatus.useQuery() لجلب حالة جميع الأجهزة
   - الاتصال بـ WebSocket (إن وُجد) للحصول على تحديثات لحظية
   - عرض لوحة تحكم تحتوي على:
     * بطاقات ملخص: إجمالي الحساسات، الحساسات النشطة، التنبيهات الحرجة
     * خريطة تفاعلية: مواقع المحطات والحساسات مع حالاتها
     * جداول: القراءات الحية، التنبيهات الأخيرة
   - تحديث تلقائي كل 5-10 ثواني (polling) أو لحظي (WebSocket)

2) عرض القراءات الحية:
   - عرض قراءات جميع الحساسات النشطة
   - تصفية حسب:
     * المحطة/الموقع
     * نوع الحساس
     * الحالة (طبيعي/تحذير/حرج)
   - عرض القيم الحالية مع:
     * الوحدة (مثل: درجة مئوية، بار، لتر/دقيقة)
     * الاتجاه (زيادة/نقصان/ثابت)
     * آخر تحديث

3) مراقبة التنبيهات:
   - عرض التنبيهات الحرجة في أعلى الصفحة
   - تصنيف حسب الشدة:
     * حرج (أحمر): يتطلب تدخل فوري
     * تحذير (أصفر): يحتاج مراقبة
     * معلوماتي (أزرق): للمعلومات فقط
   - النقر على تنبيه لعرض التفاصيل
   - إمكانية إغلاق التنبيه أو إسناده لمهمة ميدانية

4) اتخاذ إجراءات:
   - من لوحة المراقبة: النقر على "إسناد مهمة"
   - اختيار نوع المهمة (صيانة، فحص، إصلاح)
   - تعيين فريق أو فني
   - إرسال المهمة للمهام الميدانية

5) عرض الخريطة:
   - خريطة تفاعلية تعرض:
     * مواقع المحطات
     * مواقع الحساسات مع حالاتها (ألوان)
     * مسارات الخطوط
   - النقر على موقع لعرض التفاصيل
   - تكبير/تصغير للتنقل

6) تصدير البيانات:
   - تصدير القراءات لفترة معينة
   - تصدير التنبيهات
   - إنشاء تقرير حالة`,
      mechanism: `- استعلام الحالة:
  * tRPC: scada.monitoring.getStatus.useQuery({ businessId })
  * الإرجاع: { sensors: SensorStatus[], alerts: Alert[], summary: {...} }
  * SensorStatus type: { id, name, location, value, unit, status, lastUpdate, ... }
  * التحديث التلقائي: refetch كل 5-10 ثواني أو WebSocket

- WebSocket (إن وُجد):
  * الاتصال بـ ws://server/scada
  * استقبال تحديثات لحظية:
    - sensor_update: تحديث قراءة حساس
    - alert_triggered: تنبيه جديد
    - alert_resolved: حل تنبيه
  * تحديث الواجهة تلقائياً

- عرض الخريطة:
  * استخدام مكتبة مثل Leaflet أو Google Maps
  * رسم المواقع كعلامات ملونة حسب الحالة
  * تفاعل: النقر لعرض التفاصيل

- التنبيهات:
  * tRPC: scada.alerts.list.useQuery({ businessId, severity?, status? })
  * تصفية حسب الشدة والحالة
  * تحديث تلقائي للتنبيهات الحرجة

- الإجراءات:
  * tRPC: fieldops.tasks.create.mutate({ type, sensorId, description, ... })
  * ربط المهمة بالحساس/التنبيه`,
      relatedScreens: [
        { name: "التنبيهات", path: "/dashboard/scada/alerts", description: "إدارة التنبيهات - عرض جميع التنبيهات مع التفاصيل" },
        { name: "الحساسات", path: "/dashboard/scada/sensors", description: "إدارة الحساسات - تعريف وتعديل الحساسات" },
        { name: "المهام الميدانية", path: "/dashboard/fieldops/operations", description: "توجيه فرق الميدان - إسناد مهام من التنبيهات" },
        { name: "أوامر العمل", path: "/dashboard/maintenance/work-orders", description: "إنشاء أوامر صيانة - من التنبيهات الحرجة" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) التحديث اللحظي:
   - القراءات تُحدث كل 5-10 ثواني (polling) أو لحظياً (WebSocket)
   - التنبيهات الحرجة تُعرض فوراً
   - الحالات تتغير بناءً على القيم الحالية

2) التنبيهات:
   - يتم إنشاء تنبيه تلقائياً عند:
     * تجاوز حد معين (مثل: درجة حرارة > 80)
     * انقطاع الاتصال بالحساس
     * قراءة غير طبيعية
   - الشدة تُحدد حسب:
     * الفرق عن القيمة الطبيعية
     * التأثير على التشغيل
     * الأولوية

3) الاستجابة:
   - التنبيهات الحرجة تتطلب تدخل فوري
   - يمكن إسناد مهمة ميدانية مباشرة من اللوحة
   - يتم تسجيل جميع الإجراءات المتخذة

4) المراقبة المستمرة:
   - اللوحة تعمل 24/7
   - تسجيل جميع القراءات للتحليل لاحقاً
   - إنشاء تقارير دورية

5) الأمان:
   - الوصول للوحة يتطلب صلاحيات خاصة
   - تسجيل جميع الإجراءات (audit trail)
   - إشعارات للمسؤولين عند التنبيهات الحرجة`,
    },
  },
  {
    match: (path) => path === "/dashboard/scada/alerts",
    info: {
      title: "التنبيهات",
      description: "إدارة التنبيهات الفنية.",
      process: `1) عرض التنبيهات المصنفة
2) تصفية حسب الحالة والشدة
3) إغلاق/إعادة تعيين التنبيه`,
      mechanism: `- جدول تنبيهات مع حالات
- تحديث الحالة عبر API`,
      relatedScreens: [
        { name: "لوحة المراقبة", path: "/dashboard/scada/monitoring", description: "مصدر التنبيه" },
      ],
      businessLogic: "متابعة التنبيهات تقلل زمن الانقطاع وتحسن الاستجابة.",
    },
  },
  {
    match: (path) => path === "/dashboard/scada/sensors",
    info: {
      title: "الحساسات",
      description: "إدارة الحساسات وتعريفها.",
      process: `1) تسجيل حساس وربطه بمحطة/موقع
2) تحديد نوع الإشارة والوحدات
3) مراقبة حالته`,
      mechanism: `- جدول حساسات
- CRUD عبر API`,
      relatedScreens: [
        { name: "لوحة المراقبة", path: "/dashboard/scada/monitoring", description: "عرض قراءات الحساس" },
      ],
      businessLogic: "الحساس هو مصدر البيانات اللحظية التي يعتمد عليها التشغيل والتنبيهات.",
    },
  },
  {
    match: (path) => path === "/dashboard/scada/cameras",
    info: {
      title: "الكاميرات",
      description: "إدارة كاميرات المراقبة.",
      process: `1) تعريف كاميرا وربطها بالموقع
2) إدارة حالة التشغيل
3) ربطها بمركز المراقبة`,
      mechanism: `- جدول كاميرات
- CRUD عبر API`,
      relatedScreens: [
        { name: "لوحة المراقبة", path: "/dashboard/scada/monitoring", description: "عرض البث/الحالة" },
      ],
      businessLogic: "توثيق المراقبة البصرية وتعزيز الأمان والتشغيل.",
    },
  },
  // Projects
  {
    match: (path) => path === "/dashboard/projects",
    info: {
      title: "المشاريع",
      description: "إدارة قائمة المشاريع.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: projects.list.useQuery() مع معاملات:
     * businessId (مطلوب)
     * status (اختياري - مخطط/قيد التنفيذ/مكتمل/ملغي)
     * managerId (اختياري - للفلترة حسب المدير)
     * dateFrom, dateTo (للفلترة حسب التاريخ)
     * page, limit (للترقيم)
   - عرض المشاريع في جدول مع أعمدة: الاسم، المدير، تاريخ البدء، تاريخ الانتهاء، التكلفة، التقدم، الحالة
   - تطبيق فلاتر متعددة
   - عرض ملخص: إجمالي المشاريع، قيد التنفيذ، مكتملة، المتأخرة

2) إنشاء مشروع جديد:
   - النقر على "إضافة مشروع"
   - فتح نموذج يحتوي على:
     * البيانات الأساسية:
       - الاسم (مطلوب)
       - الوصف (اختياري)
       - المدير (اختيار من قائمة الموظفين) - مطلوب
       - العميل (اختياري - إذا كان المشروع لعميل خارجي)
     * الجدولة:
       - تاريخ البدء (مطلوب)
       - تاريخ الانتهاء المتوقع (مطلوب)
       - المدة المتوقعة (بالأيام) - يتم حسابها تلقائياً
     * الميزانية:
       - الميزانية المخططة (مطلوب)
       - العملة (افتراضي: العملة الأساسية)
     * التصنيف:
       - نوع المشروع (بناء، صيانة، تطوير...)
       - الأولوية (عالي/متوسط/منخفض)
   - التحقق من:
     * أن تاريخ الانتهاء > تاريخ البدء
     * أن الميزانية > 0
   - حفظ المشروع عبر tRPC: projects.create
   - عند النجاح: إغلاق النموذج وتحديث القائمة

3) تحديث حالة المشروع:
   - الحالات المتاحة:
     * مخطط: تم إنشاء المشروع ولكن لم يبدأ التنفيذ
     * قيد التنفيذ: بدأ العمل في المشروع
     * مكتمل: تم إنجاز المشروع
     * ملغي: تم إلغاء المشروع
   - تحديث الحالة عبر tRPC: projects.updateStatus
   - عند التحديث إلى "قيد التنفيذ":
     * تسجيل تاريخ البدء الفعلي
     * تفعيل المهام المرتبطة

4) تحديث التقدم:
   - من صفحة تفاصيل المشروع
   - إدخال نسبة الإنجاز (0-100%)
   - تحديث التكلفة الفعلية (إن كانت مختلفة عن المخططة)
   - حفظ التحديثات
   - يتم تحديث التقدم تلقائياً بناءً على المهام المكتملة (إن وُجدت هذه الميزة)

5) عرض تفاصيل المشروع:
   - النقر على اسم المشروع
   - الانتقال لصفحة تفاصيل المشروع (/dashboard/projects/:id)
   - عرض تبويبات:
     * المعلومات: البيانات الأساسية، الجدولة، الميزانية
     * المهام: جميع مهام المشروع مع حالاتها
     * الموارد: الموارد المخصصة (موظفين، معدات...)
     * المخرجات: الملفات والمستندات
     * التقارير: تقارير التقدم والتكلفة

6) ربط المهام:
   - من صفحة تفاصيل المشروع
   - إضافة مهام جديدة أو ربط مهام موجودة
   - تحديد تبعيات المهام (مهمة تعتمد على أخرى)
   - حفظ الربط

7) ربط الموارد:
   - تعيين موظفين للمشروع
   - تخصيص معدات أو أصول
   - تحديد ساعات العمل المتوقعة
   - حفظ التخصيص`,
      mechanism: `- استعلام المشاريع:
  * tRPC: projects.list.useQuery({ businessId, filters })
  * الإرجاع: { projects: Project[], total: number, summary: { total, inProgress, completed, delayed } }
  * Project type: { id, name, description, managerId, startDate, endDate, budget, actualCost, progress, status, ... }
  * التحديث التلقائي: refetch عند إضافة/تعديل مشروع

- نموذج المشروع:
  * استخدام React Hook Form مع التحقق:
    - name: required, minLength(3), maxLength(200)
    - managerId: required
    - startDate: required, date format
    - endDate: required, must be after startDate
    - budget: required, number > 0
  * حساب المدة:
    - duration = endDate - startDate (بالأيام)
    - عرض تحذير إذا كانت المدة طويلة جداً

- عمليات CRUD:
  * Create: projects.create.mutate({ businessId, ...formData })
  * Update: projects.update.mutate({ id, ...formData })
  * Delete: projects.delete.mutate({ id }) - soft delete (إلغاء)
  * Update Status: projects.updateStatus.mutate({ id, status })
  * Update Progress: projects.updateProgress.mutate({ id, progress, actualCost })
  * معالجة الأخطاء: try-catch مع toast.error

- حساب التقدم:
  * التقدم اليدوي: المستخدم يحدد النسبة
  * التقدم التلقائي: بناءً على المهام المكتملة
    - progress = (completedTasks / totalTasks) × 100
  * تحديث التقدم تلقائياً عند إكمال مهمة

- الربط بالمهام:
  * tRPC: projects.tasks.link.mutate({ projectId, taskIds })
  * يمكن ربط عدة مهام بمشروع واحد
  * المهام يمكن أن تكون تابعة لمشروع أو مستقلة

- الربط بالموارد:
  * tRPC: projects.resources.assign.mutate({ projectId, resourceType, resourceId, hours })
  * أنواع الموارد:
    - employees: الموظفين
    - assets: الأصول
    - materials: المواد`,
      relatedScreens: [
        { name: "تفاصيل المشروع", path: "/dashboard/projects/:id", description: "عرض بيانات المشروع الكاملة مع المهام والموارد" },
        { name: "مخطط جانت", path: "/dashboard/projects/gantt", description: "عرض الجدول الزمني - مخطط تفاعلي للمهام والمراحل" },
        { name: "المهام", path: "/dashboard/projects/tasks", description: "إدارة المهام - إنشاء وتعديل مهام المشروع" },
        { name: "الموارد البشرية", path: "/dashboard/hr/employees", description: "تعيين الموظفين - اختيار الموظفين للمشروع" },
        { name: "الأصول", path: "/dashboard/assets", description: "تخصيص الأصول - ربط الأصول بالمشروع" },
        { name: "المشتريات", path: "/dashboard/inventory/purchase-orders", description: "توريد المواد - إنشاء أوامر شراء للمشروع" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) دورة حياة المشروع:
   - مخطط: تم إنشاء المشروع ووضع الخطة
   - قيد التنفيذ: بدأ العمل الفعلي
   - مكتمل: تم إنجاز جميع المهام
   - ملغي: تم إلغاء المشروع (لن يتم إنجازه)

2) الجدولة:
   - تاريخ البدء: متى يجب أن يبدأ المشروع
   - تاريخ الانتهاء: متى يجب أن ينتهي
   - المدة: الفترة بين البدء والانتهاء
   - عند التأخير: يتم تسجيل السبب وتحديث التاريخ

3) الميزانية:
   - الميزانية المخططة: التكلفة المتوقعة
   - التكلفة الفعلية: المبلغ الفعلي المنفق
   - الفرق: يُستخدم لتقييم دقة التقديرات
   - عند تجاوز الميزانية: عرض تحذير

4) التقدم:
   - يتم تحديث التقدم يدوياً أو تلقائياً
   - التقدم التلقائي: بناءً على المهام المكتملة
   - التقدم اليدوي: المستخدم يحدد النسبة
   - عند الوصول لـ 100%: تحديث الحالة إلى "مكتمل"

5) المهام:
   - يمكن ربط عدة مهام بمشروع واحد
   - المهام يمكن أن تكون تابعة (تعتمد على أخرى)
   - إكمال المهام يحدث التقدم تلقائياً

6) الموارد:
   - الموظفين: تخصيص ساعات عمل لكل موظف
   - الأصول: ربط الأصول بالمشروع (مثل: معدات)
   - المواد: توريد المواد اللازمة

7) التقارير:
   - تقرير التقدم: نسبة الإنجاز، المهام المكتملة
   - تقرير التكلفة: التكلفة الفعلية مقابل المخططة
   - تقرير الموارد: استخدام الموارد البشرية والمادية`,
    },
  },
  {
    match: (path) => path === "/dashboard/projects/gantt",
    info: {
      title: "مخطط جانت",
      description: "عرض الجدول الزمني للمشاريع.",
      process: `1) تحميل هيكل المهام
2) استعراض المدد والعلاقات
3) تعديل التواريخ أو الاعتماد`,
      mechanism: `- مكون مخطط زمني
- تحميل بيانات المهام من المشروع`,
      relatedScreens: [
        { name: "المشاريع", path: "/dashboard/projects", description: "مصدر المهام والتواريخ" },
      ],
      businessLogic: "يُستخدم لمراقبة مسار المشروع وتحديد التأخير وتحديث خطة التنفيذ.",
    },
  },
  // Field Operations
  {
    match: (path) => path === "/dashboard/fieldops/dashboard",
    info: {
      title: "لوحة الميدان",
      description: "ملخص الفرق والمهام الميدانية.",
      process: `1) عرض مؤشرات الفرق والمهام
2) التنقل السريع للعمليات والمعدات`,
      mechanism: `- بطاقات ملخص وجداول مختصرة`,
      relatedScreens: [
        { name: "العمليات الميدانية", path: "/dashboard/fieldops/operations", description: "إدارة المهام" },
        { name: "الفرق", path: "/dashboard/fieldops/teams", description: "تكوين الفرق" },
      ],
      businessLogic: "يدعم اتخاذ القرار السريع لتوزيع المهام والموارد الميدانية.",
    },
  },
  {
    match: (path) => path === "/dashboard/fieldops/operations",
    info: {
      title: "العمليات الميدانية",
      description: "إدارة المهام والعمليات في الميدان.",
      process: `1) إنشاء مهمة ميدانية
2) تعيين فريق/عامل
3) تحديث الحالة والموقع
4) إغلاق المهمة`,
      mechanism: `- جدول مهام
- CRUD عبر API
- إمكانية ربط بالجغرافيا لاحقاً`,
      relatedScreens: [
        { name: "الفرق", path: "/dashboard/fieldops/teams", description: "تعيين الفرق" },
        { name: "العمال", path: "/dashboard/fieldops/workers", description: "تعيين الأفراد" },
      ],
      businessLogic: "توجيه العمل الميداني حسب الأولويات والموقع لتحسين زمن الاستجابة.",
    },
  },
  {
    match: (path) => path === "/dashboard/fieldops/teams",
    info: {
      title: "الفرق",
      description: "إدارة فرق الميدان.",
      process: `1) إنشاء فريق وتحديد القائد
2) إضافة أعضاء ومهارات
3) تعيين الفريق للمهام`,
      mechanism: `- جدول فرق
- CRUD عبر API`,
      relatedScreens: [
        { name: "العمليات الميدانية", path: "/dashboard/fieldops/operations", description: "إسناد الفريق للمهام" },
      ],
      businessLogic: "إدارة الفرق تضمن توزيع الحمل ومطابقة المهارات مع المهام.",
    },
  },
  {
    match: (path) => path === "/dashboard/fieldops/workers",
    info: {
      title: "العمال",
      description: "إدارة العاملين الميدانيين.",
      process: `1) إدخال بيانات العامل ومهاراته
2) ربطه بفريق أو مهام
3) متابعة الحالة والتوفر`,
      mechanism: `- جدول عمال
- CRUD عبر API`,
      relatedScreens: [
        { name: "العمليات الميدانية", path: "/dashboard/fieldops/operations", description: "تعيين العمال للمهمات" },
      ],
      businessLogic: "ضمان توفر المهارات المناسبة لكل مهمة وتحسين الجاهزية.",
    },
  },
  {
    match: (path) => path === "/dashboard/fieldops/equipment",
    info: {
      title: "المعدات الميدانية",
      description: "إدارة معدات الفرق.",
      process: `1) تسجيل المعدات وتسليمها
2) تتبع الحالة والإرجاع
3) ربطها بالمهام عند الحاجة`,
      mechanism: `- جدول معدات
- CRUD عبر API
- ربط بالفرق/المهام`,
      relatedScreens: [
        { name: "العمليات الميدانية", path: "/dashboard/fieldops/operations", description: "تخصيص المعدات للمهام" },
      ],
      businessLogic: "تتبع المعدات يقلل الفاقد ويضمن توفر الأدوات المناسبة في الميدان.",
    },
  },
  // HR
  {
    match: (path) => path === "/dashboard/hr/dashboard",
    info: {
      title: "لوحة الموارد البشرية",
      description: "ملخص الموظفين والحضور والرواتب.",
      process: `1) عرض المؤشرات
2) الانتقال السريع للإدارة التفصيلية`,
      mechanism: `- بطاقات ملخص
- استعلامات مجمعة`,
      relatedScreens: [
        { name: "الموظفين", path: "/dashboard/hr/employees", description: "إدارة بيانات الموظفين" },
        { name: "الرواتب", path: "/dashboard/hr/payroll", description: "إعداد الرواتب" },
      ],
      businessLogic: "رؤية شاملة لوضع الموارد البشرية لتخطيط سريع.",
    },
  },
  {
    match: (path) => path === "/dashboard/hr/employees",
    info: {
      title: "الموظفين",
      description: "إدارة بيانات الموظفين والوظائف.",
      process: `1) عند تحميل الصفحة:
   - استدعاء tRPC: hr.employees.list.useQuery() مع معاملات:
     * businessId (مطلوب)
     * departmentId (اختياري - للفلترة حسب القسم)
     * positionId (اختياري - للفلترة حسب الوظيفة)
     * status (اختياري - نشط/غير نشط/إجازة)
     * search (اختياري - البحث بالاسم أو الرقم الوظيفي)
     * page, limit (للترقيم)
   - عرض الموظفين في جدول مع أعمدة: الاسم، الرقم الوظيفي، القسم، الوظيفة، الحالة
   - تطبيق فلاتر متعددة
   - عرض ملخص: إجمالي الموظفين، حسب القسم، حسب الحالة

2) إضافة موظف جديد:
   - النقر على "إضافة موظف"
   - فتح نموذج يحتوي على:
     * البيانات الشخصية:
       - الاسم الكامل (مطلوب)
       - رقم الهوية (مطلوب، فريد)
       - تاريخ الميلاد (مطلوب)
       - الجنس (مطلوب)
       - رقم الهاتف (مطلوب)
       - البريد الإلكتروني (اختياري)
       - العنوان (مطلوب)
     * البيانات الوظيفية:
       - الرقم الوظيفي (يتم توليده تلقائياً أو يدوياً)
       - القسم (اختيار من قائمة - مطلوب)
       - الوظيفة (اختيار من قائمة - مطلوب)
       - تاريخ التعيين (مطلوب)
       - الراتب الأساسي (مطلوب)
       - نوع العقد (دائم/مؤقت/تدريب)
     * بيانات إضافية:
       - الحساب البنكي (اختياري)
       - حالة التأمين (اختياري)
       - الملاحظات (اختياري)
   - التحقق من:
     * عدم تكرار رقم الهوية
     * عدم تكرار الرقم الوظيفي
     * أن تاريخ التعيين ليس في المستقبل
   - حفظ الموظف عبر tRPC: hr.employees.create
   - عند النجاح: إغلاق النموذج وتحديث القائمة

3) تعديل بيانات الموظف:
   - النقر على موظف ثم "تعديل"
   - يمكن تعديل:
     * البيانات الشخصية (الاسم، الهاتف، العنوان...)
     * البيانات الوظيفية (القسم، الوظيفة، الراتب...)
   - لا يمكن تعديل:
     * رقم الهوية (immutable)
     * الرقم الوظيفي (immutable)
   - حفظ التعديلات عبر tRPC: hr.employees.update

4) تحديث حالة الموظف:
   - تغيير الحالة (نشط/غير نشط/إجازة/استقال)
   - عند التغيير إلى "غير نشط":
     * تسجيل تاريخ إنهاء الخدمة
     * تعطيل الحساب (إن وُجد)
   - عند التغيير إلى "إجازة":
     * تحديد نوع الإجازة
     * تحديد تاريخ البدء والانتهاء

5) عرض تفاصيل الموظف:
   - النقر على اسم الموظف
   - عرض:
     * المعلومات الشخصية والوظيفية
     * سجل الحضور
     * الإجازات
     * الرواتب
     * المهام المخصصة

6) ربط الموظف بالمشاريع:
   - من صفحة تفاصيل الموظف
   - عرض المشاريع المرتبطة
   - إضافة مشروع جديد
   - تحديد ساعات العمل المتوقعة`,
      mechanism: `- استعلام الموظفين:
  * tRPC: hr.employees.list.useQuery({ businessId, filters })
  * الإرجاع: { employees: Employee[], total: number, summary: { total, byDepartment, byStatus } }
  * Employee type: { id, name, employeeNumber, idNumber, departmentId, positionId, salary, status, hireDate, ... }
  * التحديث التلقائي: refetch عند إضافة/تعديل موظف

- نموذج الموظف:
  * استخدام React Hook Form مع التحقق:
    - name: required, minLength(3), maxLength(200)
    - idNumber: required, unique, pattern(/^[0-9]{10}$/)
    - employeeNumber: required, unique
    - departmentId: required
    - positionId: required
    - hireDate: required, date format
    - salary: required, number > 0
  * التحقق من التكرار:
    - tRPC: hr.employees.checkIdNumber({ idNumber, businessId })
    - tRPC: hr.employees.checkEmployeeNumber({ employeeNumber, businessId })

- عمليات CRUD:
  * Create: hr.employees.create.mutate({ businessId, ...formData })
  * Update: hr.employees.update.mutate({ id, ...formData })
  * Delete: hr.employees.delete.mutate({ id }) - soft delete (تعطيل)
  * Update Status: hr.employees.updateStatus.mutate({ id, status, endDate? })
  * معالجة الأخطاء: try-catch مع toast.error

- توليد الرقم الوظيفي:
  * تلقائياً: EMP-YYYY-XXXXX (سنة + رقم تسلسلي)
  * يدوياً: المستخدم يحدد الرقم
  * التحقق من التكرار قبل الحفظ

- الربط بالمشاريع:
  * tRPC: hr.employees.assignToProject.mutate({ employeeId, projectId, hours })
  * يمكن ربط موظف بعدة مشاريع
  * تتبع ساعات العمل لكل مشروع`,
      relatedScreens: [
        { name: "الأقسام", path: "/dashboard/hr/departments", description: "تبعيات الموظف - يجب أن يكون القسم مسجل قبل إضافة الموظف" },
        { name: "الحضور", path: "/dashboard/hr/attendance", description: "سجل الحضور - يتم ربط الحضور بالموظف" },
        { name: "الإجازات", path: "/dashboard/hr/leaves", description: "إدارة الإجازات - طلب وموافقة الإجازات" },
        { name: "الرواتب", path: "/dashboard/hr/payroll", description: "إعداد الرواتب - يتم استخدام بيانات الموظف في حساب الراتب" },
        { name: "المشاريع", path: "/dashboard/projects", description: "تعيين الموظفين - يمكن ربط الموظف بمشروع" },
      ],
      businessLogic: `قواعد الأعمال الأساسية:
1) فريدية البيانات:
   - رقم الهوية يجب أن يكون فريداً على مستوى النظام
   - الرقم الوظيفي يجب أن يكون فريداً
   - يُستخدم كمعرّف في جميع العمليات

2) دورة حياة الموظف:
   - نشط: الموظف يعمل حالياً
   - إجازة: الموظف في إجازة مؤقتة
   - غير نشط: تم إنهاء الخدمة
   - استقال: الموظف استقال

3) البيانات الوظيفية:
   - القسم: يحدد التبعية التنظيمية
   - الوظيفة: يحدد المهام والمسؤوليات
   - الراتب: يُستخدم في حساب الرواتب
   - نوع العقد: يحدد الشروط والحقوق

4) الروابط:
   - الحضور: يتم ربط الحضور بالموظف
   - الإجازات: يتم ربط الإجازات بالموظف
   - الرواتب: يتم استخدام بيانات الموظف في حساب الراتب
   - المشاريع: يمكن ربط الموظف بعدة مشاريع

5) الصلاحيات:
   - يمكن ربط الموظف بحساب مستخدم
   - الصلاحيات تُحدد حسب الوظيفة
   - الوصول للنظام يعتمد على الصلاحيات

6) التقارير:
   - تقرير الموظفين: حسب القسم، الوظيفة، الحالة
   - تقرير الحضور: معدل الحضور لكل موظف
   - تقرير الإجازات: الإجازات المستخدمة والمتبقية`,
    },
  },
  {
    match: (path) => path === "/dashboard/hr/departments",
    info: {
      title: "الأقسام",
      description: "إدارة هيكل الأقسام.",
      process: `1) إنشاء قسم
2) تحديد المدير/الوصف
3) ربط الموظفين بالأقسام`,
      mechanism: `- جدول أقسام
- CRUD عبر API`,
      relatedScreens: [
        { name: "الموظفين", path: "/dashboard/hr/employees", description: "تعيين القسم" },
      ],
      businessLogic: "يحدد البنية التنظيمية للموارد البشرية وتوزيع المسؤوليات.",
    },
  },
  {
    match: (path) => path === "/dashboard/hr/attendance",
    info: {
      title: "الحضور والانصراف",
      description: "متابعة حضور الموظفين.",
      process: `1) استيراد/تسجيل الحضور
2) مراجعة التأخير والغياب
3) اعتماد السجلات للرواتب`,
      mechanism: `- جدول حضور
- فلاتر التاريخ/الموظف
- تحديث عبر API`,
      relatedScreens: [
        { name: "الرواتب", path: "/dashboard/hr/payroll", description: "حساب الاستحقاقات والخصومات" },
      ],
      businessLogic: "الحضور يؤثر على الرواتب والالتزام التشغيلي.",
    },
  },
  {
    match: (path) => path === "/dashboard/hr/leaves",
    info: {
      title: "الإجازات",
      description: "إدارة طلبات الإجازة.",
      process: `1) تقديم طلب إجازة
2) مراجعة واعتماد
3) تحديث رصيد الإجازات`,
      mechanism: `- جدول طلبات
- حالات اعتماد
- تحديث الرصيد عبر API`,
      relatedScreens: [
        { name: "الموظفين", path: "/dashboard/hr/employees", description: "ربط الرصيد بالموظف" },
      ],
      businessLogic: "ضبط الإجازات يحفظ حقوق الموظفين ويضمن استمرارية التشغيل.",
    },
  },
  {
    match: (path) => path === "/dashboard/hr/payroll",
    info: {
      title: "الرواتب",
      description: "إعداد كشوف الرواتب.",
      process: `1) تحديد الفترة
2) جمع بيانات الحضور والبدلات والخصومات
3) حساب صافي الراتب
4) اعتماد وتوليد قيد محاسبي`,
      mechanism: `- استعلام بيانات الحضور/البدلات
- حساب الرواتب
- ربط بالقيد المحاسبي (يدوي/آلي)`,
      relatedScreens: [
        { name: "دفتر الأستاذ", path: "/dashboard/accounting/general-ledger", description: "ترحيل قيد الرواتب" },
      ],
      businessLogic: "يجب التحقق من الحضور والبدلات قبل الحساب وترحيل القيد لضمان الدقة المالية.",
    },
  },
  // Diesel
  {
    match: (path) => path === "/dashboard/diesel/configuration",
    info: {
      title: "تهيئة الديزل",
      description: "إعداد مخطط الديزل والمكوّنات.",
      process: `1) تعريف الخزانات والمضخات
2) ضبط السعات والمواقع
3) ربطها بالمحطات/المستودعات`,
      mechanism: `- جداول تكوين
- CRUD عبر API`,
      relatedScreens: [
        { name: "استلام الديزل", path: "/dashboard/diesel/receiving", description: "تسجيل الاستلام" },
        { name: "أصول الديزل", path: "/dashboard/assets/diesel/tanks", description: "تعريف الأصول المادية" },
      ],
      businessLogic: "التكوين الصحيح يضمن تتبع الوقود وتوزيعه بدقة ويقلل الفاقد.",
    },
  },
  {
    match: (path) => path === "/dashboard/diesel/receiving",
    info: {
      title: "استلام الديزل",
      description: "تسجيل عمليات استلام الوقود.",
      process: `1) تسجيل ناقلة/مورد وكميات الاستلام
2) تحديد الخزان أو الموقع
3) حفظ وتحديث المخزون`,
      mechanism: `- نموذج استلام
- تحديث الأرصدة عبر API`,
      relatedScreens: [
        { name: "النقل - وايتات", path: "/dashboard/inventory/transport/diesel/tankers", description: "تحريك الوقود بين المواقع" },
      ],
      businessLogic: "توثيق الاستلام يمنع الفاقد ويحدث مخزون الوقود بدقة.",
    },
  },
  {
    match: (path) => path === "/dashboard/diesel/dashboard",
    info: {
      title: "لوحة الديزل",
      description: "ملخص حالة الوقود والاستلام.",
      process: `1) عرض الكميات والحركات
2) مراقبة التنبيهات المتعلقة بالوقود`,
      mechanism: `- بطاقات وجداول ملخصة`,
      relatedScreens: [
        { name: "استلام الديزل", path: "/dashboard/diesel/receiving", description: "مصدر الحركات" },
      ],
      businessLogic: "لوحة متابعة سريعة لاتخاذ قرارات التوريد والتوزيع.",
    },
  },
  // Developer
  {
    match: (path) => path === "/dashboard/developer",
    info: {
      title: "لوحة المطور",
      description: "ملخص وحدات المطور والتكاملات.",
      process: `1) عرض المفاتيح والتنبيهات
2) الانتقال لتفاصيل التكامل أو النماذج`,
      mechanism: `- بطاقات ملخص وجداول`,
      relatedScreens: [
        { name: "التكاملات", path: "/dashboard/developer/integrations", description: "إدارة الربط الخارجي" },
      ],
      businessLogic: "تسهيل إدارة جوانب المطور من موقع واحد.",
    },
  },
  {
    match: (path) => path === "/dashboard/developer/integrations",
    info: {
      title: "التكاملات",
      description: "إدارة تكامل الأنظمة الخارجية.",
      process: `1) إضافة تكامل جديد
2) ضبط مفاتيح/روابط
3) مراقبة الحالة والتنبيهات`,
      mechanism: `- جداول تكامل
- CRUD عبر API`,
      relatedScreens: [
        { name: "التنبيهات الفنية", path: "/dashboard/developer/technical-alerts", description: "متابعة الأخطاء" },
      ],
      businessLogic: "التكامل الصحيح يضمن تدفق البيانات بين الأنظمة دون انقطاع.",
    },
  },
  {
    match: (path) => path === "/dashboard/developer/api-keys",
    info: {
      title: "مفاتيح API",
      description: "إصدار وإدارة مفاتيح الوصول.",
      process: `1) إنشاء مفتاح
2) تحديد الصلاحيات
3) إيقاف أو تدوير المفتاح`,
      mechanism: `- CRUD مفاتيح
- ربط بالأذونات`,
      relatedScreens: [
        { name: "التكاملات", path: "/dashboard/developer/integrations", description: "استخدام المفاتيح" },
      ],
      businessLogic: "حوكمة الوصول البرمجي وحماية البيانات.",
    },
  },
  {
    match: (path) => path === "/dashboard/developer/events",
    info: {
      title: "الأحداث",
      description: "مراقبة أحداث النظام/التكامل.",
      process: `1) عرض الأحداث المسجلة
2) تصفية حسب المصدر والشدة
3) تتبع الأخطاء`,
      mechanism: `- جدول أحداث
- فلاتر متعددة`,
      relatedScreens: [
        { name: "التنبيهات الفنية", path: "/dashboard/developer/technical-alerts", description: "تحويل الأحداث لتنبيهات" },
      ],
      businessLogic: "متابعة الأحداث يساعد على استكشاف الأخطاء وإصلاحها وتحسين الموثوقية.",
    },
  },
  {
    match: (path) => path === "/dashboard/developer/ai-models",
    info: {
      title: "نماذج الذكاء",
      description: "إدارة النماذج والإصدارات.",
      process: `1) تسجيل نموذج أو تحديث إصدار
2) ضبط الاستخدام
3) مراقبة الأداء`,
      mechanism: `- جداول نماذج
- CRUD عبر API`,
      relatedScreens: [
        { name: "التكاملات", path: "/dashboard/developer/integrations", description: "استخدام النماذج في التكامل" },
      ],
      businessLogic: "حوكمة النماذج وضمان جودة المخرجات في السيناريوهات المستخدمة.",
    },
  },
  {
    match: (path) => path === "/dashboard/developer/technical-alerts",
    info: {
      title: "التنبيهات الفنية",
      description: "متابعة أخطاء وخطاطيف التكامل.",
      process: `1) عرض التنبيهات
2) تصنيف/إغلاق
3) إرسالها للفرق المعنية`,
      mechanism: `- جدول تنبيهات
- حالات ومعالجات`,
      relatedScreens: [
        { name: "الأحداث", path: "/dashboard/developer/events", description: "مصدر بعض التنبيهات" },
      ],
      businessLogic: "معالجة التنبيهات الفنية يحافظ على استقرار التكاملات.",
    },
  },
  // Reports
  {
    match: (path) => path === "/dashboard/reports/financial",
    info: {
      title: "التقارير المالية",
      description: "تقارير مالية مثل الأرباح والميزانية.",
      process: `1) اختيار التقرير والفترة
2) تطبيق الفلاتر
3) عرض/تصدير النتائج`,
      mechanism: `- استعلامات مجمعة
- تصدير PDF/Excel (عند الدعم)`,
      relatedScreens: [
        { name: "ميزان المراجعة", path: "/dashboard/accounting/trial-balance", description: "مصدر الأرصدة" },
      ],
      businessLogic: "تعتمد على دقة الترحيل والحسابات لعرض نتائج مالية صحيحة.",
    },
  },
  {
    match: (path) => path === "/dashboard/reports/operational",
    info: {
      title: "التقارير التشغيلية",
      description: "تقارير عن التشغيل والصيانة والأعطال.",
      process: `1) اختيار نوع التقرير
2) تحديد النطاق الزمني/الموقع
3) عرض المؤشرات والتصدير`,
      mechanism: `- استعلامات تشغيلية
- فلاتر متعددة`,
      relatedScreens: [
        { name: "الصيانة", path: "/dashboard/maintenance/work-orders", description: "مصدر بيانات الأعطال" },
      ],
      businessLogic: "تساعد في تحسين الكفاءة وتقليل التوقف عبر تحليل البيانات التشغيلية.",
    },
  },
  {
    match: (path) => path === "/dashboard/reports/analytics",
    info: {
      title: "التحليلات",
      description: "تحليلات متقدمة عبر الوحدات.",
      process: `1) اختيار لوحة/مؤشر
2) تطبيق الفلاتر
3) قراءة الرسوم البيانية`,
      mechanism: `- رسوم ولوحات
- استعلامات متقاطعة`,
      relatedScreens: [
        { name: "لوحة التحكم", path: "/dashboard", description: "ملخصات عامة" },
      ],
      businessLogic: "يوفر رؤى شمولية لاتخاذ قرارات استراتيجية.",
    },
  },
  {
    match: (path) => path === "/dashboard",
    info: {
      title: "لوحة التحكم",
      description: "نظرة عامة على أهم المؤشرات والتنقل السريع لباقي الأنظمة.",
      process: "تعرض البطاقات والروابط السريعة للوصول لأكثر الوحدات استخداماً.",
      mechanism: "البيانات تعرض عبر مكونات بسيطة ويمكن ربطها بمصادر بيانات لاحقاً.",
      relatedScreens: [
        { name: "الهيكل التنظيمي", path: "/dashboard/organization/businesses", description: "إدارة الشركات والفروع" },
        { name: "الصيانة", path: "/dashboard/maintenance/work-orders", description: "متابعة أوامر العمل" },
      ],
      businessLogic: "الشاشة مخصصة للتجميع البصري والتنقل ولا تحتوي على منطق أعمال معقّد.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/organization"),
    info: {
      title: "الهيكل التنظيمي",
      description: "إدارة الشركات، الفروع، والمحطات.",
      process: "عرض القوائم، إنشاء الكيانات، وتحرير بياناتها الأساسية.",
      mechanism: "يتم جلب البيانات من API المنظمة وتخزينها في جداول مع عمليات بحث وترتيب.",
      relatedScreens: [
        { name: "الأصول", path: "/dashboard/assets", description: "ربط الأصول بالكيانات" },
        { name: "المستخدمين", path: "/dashboard/users", description: "تعيين الصلاحيات لكل فرع أو محطة" },
      ],
      businessLogic: "ضمان وجود بيانات مرجعية صحيحة قبل تفعيل الوحدات التشغيلية الأخرى.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/operations"),
    info: {
      title: "المخطط التشغيلي",
      description: "إدارة الشبكة التشغيلية والهياكل التشغيلية.",
      process: "عرض المخطط، تحديث بيانات الشبكة، تتبع الأصول المتنوعة.",
      mechanism: "يعتمد على جداول وبطاقات لعرض العقد والروابط التشغيلية.",
      relatedScreens: [
        { name: "الأصول", path: "/dashboard/assets", description: "مصادر البيانات للأصول التشغيلية" },
        { name: "الصيانة", path: "/dashboard/maintenance/work-orders", description: "إنشاء أوامر عمل حسب مواقع الشبكة" },
      ],
      businessLogic: "توحيد خريطة الشبكة لضمان دقة التوزيع والتقارير التشغيلية.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/users"),
    info: {
      title: "المستخدمين والصلاحيات",
      description: "إدارة حسابات المستخدمين والأدوار.",
      process: "إنشاء مستخدم، ربطه بدور وصلاحيات، وتفعيل أو إيقاف الحساب.",
      mechanism: "نموذج إدخال مع جداول قائمة وقابليات بحث وترتيب.",
      relatedScreens: [
        { name: "الإعدادات", path: "/dashboard/settings", description: "تحديد سياسات الوصول" },
        { name: "التقارير", path: "/dashboard/reports/analytics", description: "مراجعة نشاط المستخدمين" },
      ],
      businessLogic: "ضبط الوصول المصرّح لضمان الأمان وتوافق الامتثال.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/accounting"),
    info: {
      title: "النظام المحاسبي",
      description: "شجرة الحسابات والقيود ودفتر الأستاذ وميزان المراجعة.",
      process: "تهيئة الحسابات، تسجيل القيود، مراجعة الحركات، توليد التقارير.",
      mechanism: "يعتمد على استعلامات الترحيل وعرض جداول قابلة للتصفية.",
      relatedScreens: [
        { name: "محرك القيود", path: "/dashboard/engines/auto-journal", description: "إنشاء قيود تلقائية" },
        { name: "التقارير المالية", path: "/dashboard/reports/financial", description: "عرض النتائج المحاسبية" },
      ],
      businessLogic: "يضمن اتساق القيود وترحيلها مع سياسات الحسابات الرئيسية والفرعية.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/assets"),
    info: {
      title: "إدارة الأصول",
      description: "إدارة الأصول، فئاتها، حركاتها، والإهلاك.",
      process: "إضافة الأصول، تصنيفها، تسجيل الحركات، احتساب الإهلاك.",
      mechanism: "جداول وبطاقات مع مرشحات حسب التصنيف والموقع والحالة.",
      relatedScreens: [
        { name: "الصيانة", path: "/dashboard/maintenance/work-orders", description: "إنشاء أوامر صيانة للأصول" },
        { name: "التشغيل", path: "/dashboard/operations/structure", description: "ربط الأصول بالهيكل التشغيلي" },
      ],
      businessLogic: "متابعة دورة حياة الأصل من الإنشاء للحركة للإهلاك لضمان الدقة المالية.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/maintenance"),
    info: {
      title: "الصيانة",
      description: "إدارة أوامر العمل، الخطط، والفنيين.",
      process: "إنشاء أوامر، جدولة المهام، تحديث الحالات، وإغلاق الأعمال.",
      mechanism: "استخدام جداول وتبويبات للحالات مع تكامل محتمل مع الجغرافيا.",
      relatedScreens: [
        { name: "الأصول", path: "/dashboard/assets", description: "مصدر الأصول المطلوب صيانتها" },
        { name: "المهام الميدانية", path: "/dashboard/fieldops/operations", description: "توزيع المهام على الفرق" },
      ],
      businessLogic: "تخطيط الصيانة الوقائية وتقليل التوقف عبر جدولة دقيقة ومتابعة التنفيذ.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/inventory"),
    info: {
      title: "المخزون والمشتريات",
      description: "إدارة المستودعات، الأصناف، الحركات، وأوامر الشراء.",
      process: "إدخال الأصناف، التحويل بين المخازن، إنشاء أوامر شراء، تسجيل الاستلام.",
      mechanism: "جداول مع فلاتر حسب المستودع، النوع، والحركة مع أزرار إجراءات سريعة.",
      relatedScreens: [
        { name: "الموردين", path: "/dashboard/inventory/suppliers", description: "مصادر التوريد" },
        { name: "العمليات الميدانية", path: "/dashboard/fieldops/equipment", description: "صرف المعدات للفرق" },
      ],
      businessLogic: "ضبط الكميات والتكلفة المتوسطة وضمان التتبع الكامل للحركات.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/customers"),
    info: {
      title: "العملاء والفوترة",
      description: "إدارة المشتركين، العدادات، القراءات، والفواتير.",
      process: "تسجيل العميل، ربط عداد، إدخال قراءات، إصدار فاتورة، متابعة التحصيل.",
      mechanism: "يستخدم جداول وحقول اختيار مرتبطة بمحرك التسعير لحساب الرسوم.",
      relatedScreens: [
        { name: "محرك التسعير", path: "/dashboard/engines/pricing", description: "حساب الرسوم تلقائياً" },
        { name: "المدفوعات", path: "/dashboard/customers/payments", description: "تسجيل التحصيل" },
      ],
      businessLogic: "سلسلة الفوترة من القراءة حتى التحصيل مع التحقق من التعريفات النشطة.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/scada"),
    info: {
      title: "المراقبة والتحكم SCADA",
      description: "لوحات مراقبة التنبيهات والحساسات والكاميرات.",
      process: "عرض البيانات الحية، مراقبة التنبيهات، متابعة أجهزة الاستشعار.",
      mechanism: "يعتمد على مكونات عرض لحظي قابلة للتوسعة لربط WebSockets أو MQTT.",
      relatedScreens: [
        { name: "التنبيهات", path: "/dashboard/scada/alerts", description: "إدارة التنبيهات الحرجة" },
        { name: "المهام الميدانية", path: "/dashboard/fieldops/operations", description: "توجيه فرق الميدان" },
      ],
      businessLogic: "تجميع الإشارات الميدانية ورفع تنبيهات للتحكم والاستجابة السريعة.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/projects"),
    info: {
      title: "إدارة المشاريع",
      description: "قوائم المشاريع وتفاصيلها ومخطط جانت.",
      process: "إنشاء مشروع، تحديث المراحل، عرض الجدول الزمني والمهام.",
      mechanism: "يعتمد على جداول وبطاقات ويمكن ربطه بمحرك المهام لاحقاً.",
      relatedScreens: [
        { name: "المشتريات", path: "/dashboard/inventory/purchase-orders", description: "توريد مواد المشاريع" },
        { name: "الموارد البشرية", path: "/dashboard/hr/employees", description: "تخصيص الموارد البشرية" },
      ],
      businessLogic: "متابعة التقدم والالتزامات الزمنية مع ربط التكاليف والموارد.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/fieldops"),
    info: {
      title: "العمليات الميدانية",
      description: "إدارة الفرق والمهام الميدانية والمعدات.",
      process: "تكوين الفرق، تعيين المهام، تتبع التقدم، وتحديث الحالة من الميدان.",
      mechanism: "جداول وتبويبات مع إمكانية توسيعها لتتبع جغرافي.",
      relatedScreens: [
        { name: "الصيانة", path: "/dashboard/maintenance/work-orders", description: "تسليم أوامر العمل للفرق" },
        { name: "المخزون", path: "/dashboard/inventory/items", description: "تخصيص الأدوات والمواد" },
      ],
      businessLogic: "توزيع المهام بناءً على المهارات والموقع لتقليل وقت الاستجابة.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/diesel"),
    info: {
      title: "إدارة الديزل",
      description: "تهيئة مخطط الديزل ومراقبة الاستلام واللوحات.",
      process: "إدارة الاستلام، تسجيل الكميات، متابعة المخزون في المحطات.",
      mechanism: "يعتمد على جداول واستمارات إدخال مع إمكانية التكامل مع أجهزة القياس.",
      relatedScreens: [
        { name: "النقل - الديزل", path: "/dashboard/inventory/transport/diesel/tankers", description: "تحريك الوقود بين المحطات" },
        { name: "الأصول - خزانات الديزل", path: "/dashboard/assets/diesel/tanks", description: "تعريف الخزانات والمضخات" },
      ],
      businessLogic: "ضبط حركة الوقود، التحقق من الفاقد، وربط العمليات بالحسابات المالية.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/hr"),
    info: {
      title: "الموارد البشرية",
      description: "إدارة الموظفين، الحضور، الإجازات، والرواتب.",
      process: "تسجيل الموظف، ضبط الأقسام، متابعة الحضور والإجازات، إعداد الرواتب.",
      mechanism: "استمارات إدخال وجداول متابعة مع مرشحات حسب القسم والوظيفة.",
      relatedScreens: [
        { name: "المحاسبة - الرواتب", path: "/dashboard/accounting/general-ledger", description: "ترحيل الرواتب" },
        { name: "المشاريع", path: "/dashboard/projects", description: "تخصيص الموارد للمشاريع" },
      ],
      businessLogic: "الامتثال لسياسات الإجازات وحساب المستحقات والخصومات بدقة.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/billing"),
    info: {
      title: "نظام الفوترة",
      description: "تهيئة بيانات الفوترة والمناطق والتعريفات والتحصيل.",
      process: "ضبط المناطق، العدادات، التعريفات، إصدار الفواتير، تسجيل المدفوعات.",
      mechanism: "جداول متعددة مع مرشحات حسب المنطقة أو الحالة مع أزرار عمليات سريعة.",
      relatedScreens: [
        { name: "محرك التسعير", path: "/dashboard/engines/pricing", description: "توليد قيم الرسوم" },
        { name: "العملاء", path: "/dashboard/customers", description: "مصدر بيانات المشتركين" },
      ],
      businessLogic: "سلسلة فوترة متكاملة لضمان صحة التعريفات والتحصيل المالي.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/developer"),
    info: {
      title: "نظام المطور",
      description: "إدارة التكاملات وواجهات API والنماذج الذكية والتنبيهات الفنية.",
      process: "توليد مفاتيح API، مراقبة الأحداث، إعداد النماذج، ومراجعة التنبيهات.",
      mechanism: "لوحات وجداول تعرض مفاتيح وعمليات بواجهة موحدة للمطورين.",
      relatedScreens: [
        { name: "التنبيهات الفنية", path: "/dashboard/developer/technical-alerts", description: "متابعة أخطاء التكامل" },
        { name: "التكاملات", path: "/dashboard/developer/integrations", description: "ربط الأنظمة الخارجية" },
      ],
      businessLogic: "حوكمة الوصول البرمجي وتتبع التغييرات لضمان الاستقرار.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/reports"),
    info: {
      title: "التقارير والتحليلات",
      description: "تقارير مالية وتشغيلية وتحليلات أداء.",
      process: "اختيار التقرير، تحديد الفلاتر، عرض النتائج وتصديرها.",
      mechanism: "يعتمد على استعلامات مجمعة يمكن توسيعها للتصدير والرسوم البيانية.",
      relatedScreens: [
        { name: "المحاسبة", path: "/dashboard/accounting/general-ledger", description: "مصدر بيانات التقارير المالية" },
        { name: "المشاريع", path: "/dashboard/projects", description: "تقارير التقدم الزمني" },
      ],
      businessLogic: "يوفر رؤى لاتخاذ القرار ويعتمد على صحة البيانات من الوحدات الأخرى.",
    },
  },
  {
    match: (path) => path.startsWith("/dashboard/engines"),
    info: {
      title: "المحركات الأساسية",
      description: "محركات القيود والتسعير والتسوية والجدولة والإسناد وفحص الصحة.",
      process: "تشغيل المحرك، مراجعة النتائج، وضبط الإعدادات حسب الحاجة.",
      mechanism: "واجهات مستقلة لكل محرك تعتمد على استدعاءات tRPC وإجراءات متخصصة.",
      relatedScreens: [
        { name: "المحاسبة", path: "/dashboard/accounting/journal-entries", description: "تحقق من القيود الناتجة" },
        { name: "الفوترة", path: "/dashboard/billing", description: "مخرجات محرك التسعير" },
      ],
      businessLogic: "أتمتة العمليات المتكررة لتقليل الأخطاء وزيادة الكفاءة التشغيلية.",
    },
  },
  {
    match: (path) => path.startsWith("/custom"),
    info: {
      title: "النظام المخصص",
      description: "نسخة مخصصة من الواجهات قابلة للتمديد.",
      process: "يتم تحميل الصفحات المخصصة حسب المسار وإتاحة توسيعها.",
      mechanism: "نفس مكونات النظام الرئيسي مع إمكانية تعديل تخطيط البيانات.",
      relatedScreens: [
        { name: "لوحة التحكم الرئيسية", path: "/dashboard", description: "العودة للنظام الأساسي" },
      ],
      businessLogic: "مصمم لتجارب مخصصة حسب كل عميل أو سيناريو.",
    },
  },
  // Diesel Assets
  {
    match: (path) => path === "/dashboard/assets/diesel/tanks",
    info: {
      title: "خزانات الديزل",
      description: "إدارة خزانات الوقود كمكونات أصول.",
      process: `1) تسجيل خزان مع السعة والموقع
2) ربطه بمحطة أو مستودع
3) تتبع الحالة والصيانة`,
      mechanism: `- جدول خزانات مع مرشحات
- CRUD عبر API
- ربط بأصول الديزل`,
      relatedScreens: [
        { name: "تهيئة الديزل", path: "/dashboard/diesel/configuration", description: "ضبط مخطط الخزانات" },
        { name: "استلام الديزل", path: "/dashboard/diesel/receiving", description: "تحديث المخزون" },
      ],
      businessLogic: "تتبع الخزانات كأصول يضمن دقة القيمة والمحاسبة والصيانة.",
    },
  },
  {
    match: (path) => path === "/dashboard/assets/diesel/pumps",
    info: {
      title: "مضخات الديزل",
      description: "إدارة مضخات الوقود كأصول.",
      process: `1) تسجيل مضخة مع النوع والموقع
2) ربطها بالخزان أو المحطة
3) متابعة الصيانة والأعطال`,
      mechanism: `- جدول مضخات
- CRUD عبر API
- ربط بأوامر الصيانة`,
      relatedScreens: [
        { name: "الصيانة", path: "/dashboard/maintenance/work-orders", description: "إنشاء أوامر صيانة للمضخات" },
        { name: "تهيئة الديزل", path: "/dashboard/diesel/configuration", description: "ربط المضخة بالهيكل" },
      ],
      businessLogic: "المضخات أصول حرجة؛ تتبعها يضمن استمرارية التوزيع.",
    },
  },
  {
    match: (path) => path === "/dashboard/assets/diesel/pipes",
    info: {
      title: "مواسير الديزل",
      description: "إدارة خطوط المواسير كأصول.",
      process: `1) تسجيل خط مواسير مع الطول والقطر
2) ربطه بالخزانات والمضخات
3) تتبع الصيانة والاستبدال`,
      mechanism: `- جدول مواسير
- CRUD عبر API`,
      relatedScreens: [
        { name: "خزانات الديزل", path: "/dashboard/assets/diesel/tanks", description: "ربط المواسير بالخزانات" },
        { name: "الصيانة", path: "/dashboard/maintenance/work-orders", description: "صيانة خطوط المواسير" },
      ],
      businessLogic: "المواسير جزء من البنية التحتية؛ تتبعها ضروري للصيانة الوقائية.",
    },
  },
  // Transport
  {
    match: (path) => path === "/dashboard/inventory/transport/diesel/tankers",
    info: {
      title: "وايتات الديزل",
      description: "إدارة ناقلات الوقود.",
      process: `1) تسجيل وايت مع السعة والرقم
2) تتبع الرحلات والكميات المنقولة
3) ربطها بالسائقين والرحلات`,
      mechanism: `- جدول وايتات
- CRUD عبر API
- ربط بحركات النقل`,
      relatedScreens: [
        { name: "نقل من محطة لمحطة", path: "/dashboard/inventory/transport/diesel/station-transfer", description: "تسجيل نقل بين المحطات" },
        { name: "استلام الديزل", path: "/dashboard/diesel/receiving", description: "استلام من المورد" },
      ],
      businessLogic: "تتبع الناقلات يضمن توثيق كل حركة وقود ويقلل الفاقد.",
    },
  },
  {
    match: (path) => path === "/dashboard/inventory/transport/diesel/barrels",
    info: {
      title: "نقل بالبراميل",
      description: "تسجيل نقل الوقود بالبراميل.",
      process: `1) تسجيل عدد البراميل والكمية
2) تحديد المصدر والوجهة
3) تحديث المخزون`,
      mechanism: `- نموذج نقل براميل
- تحديث الأرصدة عبر API`,
      relatedScreens: [
        { name: "استلام الديزل", path: "/dashboard/diesel/receiving", description: "استلام البراميل" },
        { name: "أرصدة المخزون", path: "/dashboard/inventory/stock-balance", description: "تأثير النقل على المخزون" },
      ],
      businessLogic: "توثيق النقل بالبراميل ضروري للمحاسبة والتحقق من الكميات.",
    },
  },
  {
    match: (path) => path === "/dashboard/inventory/transport/diesel/station-transfer",
    info: {
      title: "نقل من محطة لمحطة",
      description: "تسجيل تحويل الوقود بين المحطات.",
      process: `1) اختيار المحطة المصدر والوجهة
2) تحديد الكمية والوايت
3) تسجيل النقل وتحديث المخزون`,
      mechanism: `- نموذج نقل
- تحديث أرصدة كلا المحطتين عبر API`,
      relatedScreens: [
        { name: "وايتات الديزل", path: "/dashboard/inventory/transport/diesel/tankers", description: "اختيار الناقلة" },
        { name: "لوحة الديزل", path: "/dashboard/diesel/dashboard", description: "متابعة الحركات" },
      ],
      businessLogic: "ضبط التوزيع بين المحطات يمنع النقص ويحسن التخطيط.",
    },
  },
  // Field Tasks
  {
    match: (path) => path === "/dashboard/fieldops/tasks/generator-tech/diesel-receiving",
    info: {
      title: "مهام استلام الديزل",
      description: "مهام فني المولدات لاستلام الوقود.",
      process: `1) عرض المهام المخصصة لفني المولدات
2) تسجيل استلام الديزل
3) تحديث حالة المهمة`,
      mechanism: `- جدول مهام مخصصة
- نماذج استلام
- تحديث الحالة عبر API`,
      relatedScreens: [
        { name: "استلام الديزل", path: "/dashboard/diesel/receiving", description: "تسجيل الاستلام" },
        { name: "العمليات الميدانية", path: "/dashboard/fieldops/operations", description: "متابعة المهام" },
      ],
      businessLogic: "تخصيص المهام للفنيين يضمن المسؤولية ويحسن المتابعة.",
    },
  },
  {
    match: (path) => path === "/dashboard/fieldops/tasks/collectors",
    info: {
      title: "مهام المتحصلين",
      description: "إدارة مهام جمع الفواتير.",
      process: `1) عرض الفواتير المخصصة للمتحصل
2) تسجيل التحصيل
3) تحديث حالة الفاتورة`,
      mechanism: `- جدول فواتير مخصصة
- نموذج تحصيل
- تحديث الحالة عبر API`,
      relatedScreens: [
        { name: "المدفوعات", path: "/dashboard/customers/payments", description: "تسجيل المدفوعات" },
        { name: "الفواتير", path: "/dashboard/customers/invoices", description: "مصدر الفواتير" },
      ],
      businessLogic: "توزيع الفواتير على المتحصلين يحسن معدل التحصيل.",
    },
  },
  {
    match: (path) => path === "/dashboard/fieldops/tasks/electricians",
    info: {
      title: "مهام الكهربائيين",
      description: "إدارة مهام الفنيين الكهربائيين.",
      process: `1) عرض المهام المخصصة
2) تحديث الحالة والتقدم
3) إغلاق المهمة بعد الإنجاز`,
      mechanism: `- جدول مهام
- تحديث الحالة عبر API`,
      relatedScreens: [
        { name: "أوامر العمل", path: "/dashboard/maintenance/work-orders", description: "مصدر المهام" },
        { name: "العمليات الميدانية", path: "/dashboard/fieldops/operations", description: "متابعة التنفيذ" },
      ],
      businessLogic: "تخصيص المهام حسب المهارة يضمن جودة التنفيذ.",
    },
  },
  {
    match: (path) => path === "/dashboard/fieldops/tasks/station-manager",
    info: {
      title: "مهام مدير المحطة",
      description: "إدارة مهام مديري المحطات.",
      process: `1) عرض المهام الإدارية والتشغيلية
2) مراجعة التقارير والتنبيهات
3) اتخاذ القرارات والموافقات`,
      mechanism: `- لوحة مهام إدارية
- جداول تقارير
- نماذج موافقات`,
      relatedScreens: [
        { name: "المحطات", path: "/dashboard/organization/stations", description: "معلومات المحطة" },
        { name: "التقارير التشغيلية", path: "/dashboard/reports/operational", description: "مراجعة الأداء" },
      ],
      businessLogic: "تمكين مدير المحطة من متابعة كل الجوانب التشغيلية والإدارية.",
    },
  },
  // Custom System Pages
  {
    match: (path) => path === "/custom/sub-systems",
    info: {
      title: "الأنظمة الفرعية",
      description: "إدارة الأنظمة الفرعية المخصصة.",
      process: `1) إنشاء نظام فرعي جديد
2) ضبط الكود والاسم والوصف
3) ربطه بالحسابات والعمليات`,
      mechanism: `- جدول أنظمة فرعية
- CRUD عبر API
- ربط بالحسابات الوسيطة`,
      relatedScreens: [
        { name: "تفاصيل النظام", path: "/custom/sub-systems/:id", description: "إدارة مكونات النظام" },
        { name: "نظام الوسيط", path: "/custom/intermediary", description: "ربط الأنظمة بالحسابات الوسيطة" },
      ],
      businessLogic: "الأنظمة الفرعية تسمح بعزل العمليات المالية لكل وحدة عمل.",
    },
  },
  {
    match: (path) => path.startsWith("/custom/sub-systems/") && path.split("/").length === 4,
    info: {
      title: "تفاصيل النظام الفرعي",
      description: "إدارة مكونات نظام فرعي محدد.",
      process: `1) استعراض التبويبات (نظرة عامة، مالي، خزائن، تسويات، حسابات، ملاحظات، مذكرات)
2) إدارة كل مكون حسب التبويب
3) ربط النظام بالحسابات الوسيطة`,
      mechanism: `- تبويبات متعددة
- مكونات مخصصة لكل تبويب
- حفظ عبر API`,
      relatedScreens: [
        { name: "الأنظمة الفرعية", path: "/custom/sub-systems", description: "العودة للقائمة" },
        { name: "نظام الوسيط", path: "/custom/intermediary", description: "ربط الحسابات" },
      ],
      businessLogic: "كل نظام فرعي مستقل مالياً ويمكن ربطه بالأنظمة الأخرى عبر الحسابات الوسيطة.",
    },
  },
  {
    match: (path) => path === "/custom/treasuries",
    info: {
      title: "الخزائن",
      description: "إدارة الصناديق والبنوك.",
      process: `1) إضافة خزينة أو بنك
2) تحديد العملة والرصيد الافتتاحي
3) متابعة الحركات والأرصدة`,
      mechanism: `- جدول خزائن
- CRUD عبر API
- ربط بالحركات المالية`,
      relatedScreens: [
        { name: "الحسابات", path: "/custom/accounts", description: "ربط الخزينة بالحساب" },
        { name: "التسويات", path: "/custom/reconciliation", description: "مطابقة أرصدة الخزائن" },
      ],
      businessLogic: "تتبع الخزائن يضمن دقة التدفقات النقدية والمطابقة البنكية.",
    },
  },
  {
    match: (path) => path === "/custom/reconciliation",
    info: {
      title: "التسويات",
      description: "مطابقة الحسابات والحركات المالية.",
      process: `1) اختيار الحساب أو الخزينة
2) مقارنة الحركات مع السجلات الخارجية
3) تسجيل الفروقات والتصحيحات`,
      mechanism: `- نماذج مطابقة
- جداول حركات
- تسجيل الفروقات عبر API`,
      relatedScreens: [
        { name: "الحسابات", path: "/custom/accounts", description: "مصدر بيانات الحسابات" },
        { name: "الخزائن", path: "/custom/treasuries", description: "مطابقة أرصدة الخزائن" },
      ],
      businessLogic: "المطابقة الدورية تضمن دقة السجلات وتكشف الأخطاء مبكراً.",
    },
  },
  {
    match: (path) => path === "/custom/accounts",
    info: {
      title: "الحسابات المخصصة",
      description: "إدارة الحسابات في النظام المخصص.",
      process: `1) إضافة حساب
2) تحديد النوع والتصنيف
3) متابعة الحركات والأرصدة`,
      mechanism: `- جدول حسابات
- CRUD عبر API
- ربط بالقيود والحركات`,
      relatedScreens: [
        { name: "القيود اليومية v2", path: "/custom/v2/journal-entries", description: "استخدام الحسابات في القيود" },
        { name: "الحسابات v2", path: "/custom/v2/accounts", description: "إدارة الحسابات المحاسبية" },
      ],
      businessLogic: "الحسابات أساس الترحيل المالي في النظام المخصص.",
    },
  },
  {
    match: (path) => path === "/custom/notes",
    info: {
      title: "الملاحظات",
      description: "تدوين الملاحظات والتنبيهات.",
      process: `1) إنشاء ملاحظة
2) تحديد الأولوية والحالة
3) ربطها بعملية أو مستند`,
      mechanism: `- جدول ملاحظات
- CRUD عبر API
- فلاتر حسب الحالة`,
      relatedScreens: [
        { name: "المذكرات", path: "/custom/memos", description: "مذكرات رسمية" },
      ],
      businessLogic: "الملاحظات تساعد في تتبع التفاصيل والمهام المعلقة.",
    },
  },
  {
    match: (path) => path === "/custom/memos",
    info: {
      title: "المذكرات",
      description: "إدارة المذكرات الرسمية والتنبيهات.",
      process: `1) إنشاء مذكرة
2) تحديد المستلمين والأولوية
3) متابعة القراءة والرد`,
      mechanism: `- جدول مذكرات
- CRUD عبر API
- نظام إشعارات`,
      relatedScreens: [
        { name: "الملاحظات", path: "/custom/notes", description: "ملاحظات غير رسمية" },
      ],
      businessLogic: "المذكرات تضمن التواصل الرسمي وتوثيق القرارات.",
    },
  },
  {
    match: (path) => path === "/custom/v2/journal-entries",
    info: {
      title: "القيود اليومية v2",
      description: "نسخة محسّنة من القيود اليومية.",
      process: `1) إدخال قيد مزدوج
2) اختيار الحسابات والمراكز
3) حفظ وترحيل القيد`,
      mechanism: `- نموذج قيد محسّن
- حفظ عبر API
- تحقق التوازن`,
      relatedScreens: [
        { name: "الحسابات v2", path: "/custom/v2/accounts", description: "اختيار الحسابات" },
        { name: "نظام الوسيط", path: "/custom/intermediary", description: "ربط القيود بالحسابات الوسيطة" },
      ],
      businessLogic: "نسخة محسّنة توفر ميزات إضافية للقيود المعقدة.",
    },
  },
  {
    match: (path) => path === "/custom/v2/accounts",
    info: {
      title: "الحسابات v2",
      description: "إدارة الحسابات المحاسبية المحسّنة.",
      process: `1) إضافة حساب مع التصنيف
2) ضبط الأكواد والهيكل
3) متابعة الحركات`,
      mechanism: `- جدول حسابات محسّن
- CRUD عبر API
- هيكل شجري`,
      relatedScreens: [
        { name: "القيود اليومية v2", path: "/custom/v2/journal-entries", description: "استخدام الحسابات" },
        { name: "أنواع الحسابات", path: "/custom/v2/account-types", description: "تصنيف الحسابات" },
      ],
      businessLogic: "نسخة محسّنة تدعم هياكل حسابات أكثر تعقيداً.",
    },
  },
  {
    match: (path) => path === "/custom/v2/currencies",
    info: {
      title: "العملات وأسعار الصرف",
      description: "إدارة العملات وأسعار التحويل.",
      process: `1) إضافة عملة
2) تحديث سعر الصرف
3) استخدامها في المعاملات`,
      mechanism: `- جدول عملات
- CRUD عبر API
- ربط بالمعاملات`,
      relatedScreens: [
        { name: "القيود اليومية v2", path: "/custom/v2/journal-entries", description: "استخدام العملات في القيود" },
        { name: "الخزائن", path: "/custom/treasuries", description: "ربط الخزائن بالعملات" },
      ],
      businessLogic: "إدارة العملات ضرورية للمعاملات متعددة العملات.",
    },
  },
  {
    match: (path) => path === "/custom/v2/account-types",
    info: {
      title: "أنواع الحسابات",
      description: "تعريف أنواع الحسابات المخصصة.",
      process: `1) إنشاء نوع حساب
2) تحديد الخصائص والقواعد
3) تطبيقه على الحسابات`,
      mechanism: `- جدول أنواع
- CRUD عبر API
- ربط بالحسابات`,
      relatedScreens: [
        { name: "الحسابات v2", path: "/custom/v2/accounts", description: "تطبيق النوع على الحسابات" },
      ],
      businessLogic: "أنواع الحسابات تحدد القواعد والسلوك لكل حساب.",
    },
  },
  {
    match: (path) => path === "/custom/intermediary",
    info: {
      title: "نظام الوسيط",
      description: "إدارة الحسابات الوسيطة بين الأنظمة.",
      process: `1) تعريف حساب وسيط
2) ربطه بنظامين فرعيين
3) متابعة الحركات بين الأنظمة`,
      mechanism: `- جدول حسابات وسيطة
- CRUD عبر API
- ربط بالأنظمة الفرعية`,
      relatedScreens: [
        { name: "الأنظمة الفرعية", path: "/custom/sub-systems", description: "ربط الأنظمة" },
        { name: "التسويات", path: "/custom/reconciliation", description: "مطابقة الحركات الوسيطة" },
      ],
      businessLogic: "الحسابات الوسيطة تسمح بتبادل القيم المالية بين الأنظمة المستقلة.",
    },
  },
  {
    match: (path) => path === "/custom/inventory",
    info: {
      title: "نظام المخزون المخصص",
      description: "إدارة المخزون في النظام المخصص.",
      process: `1) إضافة أصناف
2) تسجيل الحركات
3) متابعة الأرصدة`,
      mechanism: `- جداول مخزون
- CRUD عبر API`,
      relatedScreens: [
        { name: "المشتريات المخصصة", path: "/custom/purchases", description: "استلام من المشتريات" },
        { name: "الموردين المخصصين", path: "/custom/suppliers", description: "مصادر التوريد" },
      ],
      businessLogic: "نظام مخزون مخصص يمكن تخصيصه حسب احتياجات العمل.",
    },
  },
  {
    match: (path) => path === "/custom/suppliers",
    info: {
      title: "الموردين المخصصين",
      description: "إدارة الموردين في النظام المخصص.",
      process: `1) إضافة مورد
2) ربطه بالأصناف
3) متابعة التعاملات`,
      mechanism: `- جدول موردين
- CRUD عبر API`,
      relatedScreens: [
        { name: "المشتريات المخصصة", path: "/custom/purchases", description: "إصدار طلبات للمورد" },
        { name: "المخزون المخصص", path: "/custom/inventory", description: "ربط الأصناف بالمورد" },
      ],
      businessLogic: "إدارة الموردين في النظام المخصص تسمح بتخصيص العملية.",
    },
  },
  {
    match: (path) => path === "/custom/purchases",
    info: {
      title: "المشتريات المخصصة",
      description: "إدارة المشتريات في النظام المخصص.",
      process: `1) إنشاء أمر شراء
2) إضافة البنود
3) متابعة الاستلام والدفع`,
      mechanism: `- نماذج أوامر شراء
- CRUD عبر API`,
      relatedScreens: [
        { name: "الموردين المخصصين", path: "/custom/suppliers", description: "اختيار المورد" },
        { name: "المخزون المخصص", path: "/custom/inventory", description: "تحديث المخزون بعد الاستلام" },
      ],
      businessLogic: "نظام مشتريات مخصص يمكن تخصيصه حسب سياسات الشراء.",
    },
  },
  // Detail Pages
  {
    match: (path) => /^\/dashboard\/projects\/\d+$/.test(path),
    info: {
      title: "تفاصيل المشروع",
      description: "عرض تفاصيل مشروع محدد.",
      process: `1) استعراض معلومات المشروع
2) مراجعة المهام والمراحل
3) تحديث التقدم والميزانية`,
      mechanism: `- تحميل بيانات المشروع عبر API
- عرض تفاصيل ومهام
- نماذج تحديث`,
      relatedScreens: [
        { name: "المشاريع", path: "/dashboard/projects", description: "العودة للقائمة" },
        { name: "مخطط جانت", path: "/dashboard/projects/gantt", description: "عرض الجدول الزمني" },
      ],
      businessLogic: "تفاصيل المشروع توفر رؤية شاملة للتقدم والتكاليف.",
    },
  },
  {
    match: (path) => /^\/dashboard\/customers\/\d+$/.test(path),
    info: {
      title: "تفاصيل العميل",
      description: "عرض بيانات العميل الكاملة.",
      process: `1) استعراض بيانات العميل
2) مراجعة العدادات والفواتير
3) تحديث البيانات أو إضافة ملاحظات`,
      mechanism: `- تحميل بيانات العميل عبر API
- عرض تبويبات (معلومات، عدادات، فواتير، مدفوعات)
- نماذج تحديث`,
      relatedScreens: [
        { name: "العملاء", path: "/dashboard/customers", description: "العودة للقائمة" },
        { name: "الفواتير", path: "/dashboard/customers/invoices", description: "عرض فواتير العميل" },
      ],
      businessLogic: "تفاصيل العميل توفر رؤية شاملة للعلاقة التجارية.",
    },
  },
  {
    match: (path) => /^\/dashboard\/assets\/view\/\d+$/.test(path),
    info: {
      title: "تفاصيل الأصل",
      description: "عرض بيانات الأصل الكاملة.",
      process: `1) استعراض معلومات الأصل
2) مراجعة الحركات والصيانة
3) تحديث الحالة أو إضافة ملاحظات`,
      mechanism: `- تحميل بيانات الأصل عبر API
- عرض تفاصيل وحركات
- نماذج تحديث`,
      relatedScreens: [
        { name: "قائمة الأصول", path: "/dashboard/assets", description: "العودة للقائمة" },
        { name: "حركات الأصول", path: "/dashboard/assets/movements", description: "تسجيل حركة جديدة" },
      ],
      businessLogic: "تفاصيل الأصل توفر سجل كامل لدورة حياته.",
    },
  },
  {
    match: (path) => /^\/dashboard\/assets\/edit\/\d+$/.test(path),
    info: {
      title: "تعديل الأصل",
      description: "تحديث بيانات الأصل.",
      process: `1) تحميل بيانات الأصل الحالية
2) تعديل الحقول المطلوبة
3) حفظ التغييرات`,
      mechanism: `- نموذج تحرير
- تحديث عبر API
- التحقق من الصحة`,
      relatedScreens: [
        { name: "قائمة الأصول", path: "/dashboard/assets", description: "العودة للقائمة" },
        { name: "تفاصيل الأصل", path: "/dashboard/assets/view/:id", description: "عرض البيانات المحدثة" },
      ],
      businessLogic: "تحديث بيانات الأصل يضمن دقة السجلات المالية والتشغيلية.",
    },
  },
  {
    match: (path) => /^\/dashboard\/maintenance\/work-orders\/\d+$/.test(path),
    info: {
      title: "تفاصيل أمر العمل",
      description: "عرض وتحديث أمر عمل محدد.",
      process: `1) استعراض تفاصيل الأمر
2) تحديث الحالة والتقدم
3) إضافة ملاحظات أو إغلاق الأمر`,
      mechanism: `- تحميل بيانات الأمر عبر API
- نماذج تحديث
- ربط بالفنيين والمهام`,
      relatedScreens: [
        { name: "أوامر العمل", path: "/dashboard/maintenance/work-orders", description: "العودة للقائمة" },
        { name: "الفنيين", path: "/dashboard/maintenance/technicians", description: "تعيين الفنيين" },
      ],
      businessLogic: "تفاصيل الأمر توفر متابعة دقيقة للصيانة وتوثيق الأعمال.",
    },
  },
];

export function resolvePageInfo(path: string): EngineInfo {
  const entry = PAGE_INFO.find((item) => item.match(path));
  if (entry) return entry.info;
  return DEFAULT_INFO;
}

