# โ Task 020: ูุญุต ุดุงูู ูุจุงูู ุงูุฃูุธูุฉ - ุงูููุชูู

**ุงูุชุงุฑูุฎ:** 2026-01-08  
**ุงูุญุงูุฉ:** โ **ููุชูู - ุงููุฑุญูุฉ 1**

---

## ๐ ุงูููุฎุต:

```
โ TODOs ุงูููุชููุฉ ูู ุงููุฑุญูุฉ 1: 6 TODO
โ๏ธ TODOs ุงููุชุจููุฉ: ~44 TODO (ุฃููููุฉ ูุชูุณุทุฉ/ููุฎูุถุฉ)
```

---

## โ ุงูููุงู ุงูููุชููุฉ:

### 1. **Payment Webhooks** (2 TODOs) โ
**ุงูููู:** `server/webhooks/payment-webhooks.ts`
- โ ุงูุณุทุฑ 151: ุงุณุชุฏุนุงุก SMS/Email Service ูุฅุฑุณุงู ุชุฃููุฏ ุงูุฏูุน
- โ ุงูุณุทุฑ 193: ุฅุฑุณุงู ุฅุดุนุงุฑ ููุนููู ุจูุดู ุงูุฏูุน
- **ุงูุชุบููุฑุงุช:**
  - ุงุณุชุฎุฏุงู `notificationService` ูุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุชุฃููุฏ ุงูุฏูุน
  - ุงุณุชุฎุฏุงู `notificationService` ูุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูุดู ุงูุฏูุน

---

### 2. **STS Router - ุงูุชุญูู ูู ุงูุฏูุน** (1 TODO) โ
**ุงูููู:** `server/stsRouter.ts`
- โ ุงูุณุทุฑ 373: ุงูุชุญูู ูู ุงูุฏูุน ูู ุจูุงุจุฉ ุงูุฏูุน
- **ุงูุชุบููุฑุงุช:**
  - ุงูุจุญุซ ุนู ุงููุนุงููุฉ ูู `payment_transactions`
  - ุงูุชุญูู ุงูุฅุถุงูู ูู ุงูุจูุงุจุฉ (Moyasar/Sadad) ุฅุฐุง ูุฒู ุงูุฃูุฑ
  - ุงุณุชุฎุฏุงู `MoyasarGateway.verifyPayment` ุฃู `SadadGateway.verifyPayment`

---

### 3. **Billing Router - ุญุณุงุจ ุงูุงุณุชููุงู ุญุณุจ ุงูููุช** (1 TODO) โ
**ุงูููู:** `server/billingRouter.ts`
- โ ุงูุณุทุฑ 1355: ุญุณุงุจ ุงูุงุณุชููุงู ุญุณุจ ุงูููุช ุงููุนูู ูููุฑุงุกุงุช
- **ุงูุชุบููุฑุงุช:**
  - ุชุญุณูู ุญุณุงุจ ุงูุชุนุฑูุงุช ุงููุชุนุฏุฏุฉ (8 ุชุนุฑูุงุช)
  - ุญุณุงุจ ุงูุณุนุฑ ุงููุชูุณุท ุงููุฑุฌุญ ุญุณุจ ุงููุชุฑุงุช ุงูุฒูููุฉ
  - ุฏุนู ุงูุชุนุฑูุงุช ุงูุชู ุชูุชุฏ ุนูู ููููู (ูุซู 22:00 - 06:00)
  - Fallback ุฅูู ูุชูุณุท ุงูุณุนุฑ ูู ุญุงูุฉ ุงูุฎุทุฃ

---

### 4. **Auto-Billing Service** (1 TODO) โ
**ุงูููู:** `server/services/auto-billing-service.ts`
- โ ุงูุณุทุฑ 145: ุฌูุจ ุงูุชุนุฑูุฉ ูู ุฌุฏูู ุงูุชุนุฑูุงุช
- **ุงูุชุบููุฑุงุช:**
  - ุงุณุชุฎุฏุงู `tariffs` table ูู `billing-enhanced` schema
  - ุงุณุชุฎุฏุงู `calculateConsumption` ููุญุตูู ุนูู ุงูุณุนุฑ ุงูุตุญูุญ
  - ุญุณุงุจ `fixedCharge` ู `vatRate` ูู ุงูุชุนุฑูุฉ

---

### 5. **Messaging Router** (2 TODOs) โ
**ุงูููู:** `server/messagingRouter.ts`
- โ ุงูุณุทุฑ 566: ุฅุฑุณุงู ุงูุฑุณุงูุฉ ุนุจุฑ ุงููุฒูุฏ (custom message)
- โ ุงูุณุทุฑ 684: ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุฑุณุงูุฉ ุนุจุฑ ุงููุฒูุฏ
- **ุงูุชุบููุฑุงุช:**
  - ุงุณุชุฎุฏุงู `notificationService` ูุฅุฑุณุงู ุงูุฑุณุงุฆู ุงููุฎุตุตุฉ
  - ุชุญุฏูุซ ุญุงูุฉ ุงูุฑุณุงูุฉ (sent/failed)
  - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุตุญูุญ

---

## โ๏ธ TODOs ุงููุชุจููุฉ (ุฃููููุฉ ูุชูุณุทุฉ/ููุฎูุถุฉ):

### STS Router (3 TODOs):
- ุงูุณุทุฑ 627: ุงุณุชุฏุนุงุก API ููุชุญูู ูู ุญุงูุฉ ุงูุดุญู
- ุงูุณุทุฑ 767: ุชูููุฐ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุงููุนูู
- ุงูุณุทุฑ 799: ุชูููุฐ ูุฒุงููุฉ ุงูุนุฏุงุฏุงุช
- ุงูุณุทุฑ 842: ุงุณุชุฏุนุงุก API ููุญุตูู ุนูู ุงูุญุงูุฉ ุงููุนููุฉ

### Customer System Router (2 TODOs):
- ุงูุณุทุฑ 1268: ุชูููุฐ ุงูุฑุจุท ูุน ุงููุญุงูุธ ุงูุฎุงุฑุฌูุฉ
- ุงูุณุทุฑ 1284: ุชูููุฐ ุงูุดุญู ูู ุงููุญุงูุธ ุงูุฎุงุฑุฌูุฉ

### Notification Channels (5 TODOs):
- `server/notifications/channels/email.ts` (1 TODO)
- `server/notifications/channels/whatsapp.ts` (3 TODOs)
- `server/notifications/channels/sms.ts` (1 TODO)

### Engines (4 TODOs):
- `server/core/smart-assignment-engine.ts` (1 TODO)
- `server/core/preventive-scheduling-engine.ts` (3 TODOs)

### Utils (4 TODOs):
- `server/utils/consumption-calculator.ts` (4 TODOs)

### Other Routers (4 TODOs):
- `server/transitionSupportRouter.ts` (2 TODOs)
- `server/governmentSupportRouter.ts` (2 TODOs)

---

## ๐ ููุงุญุธุงุช:

1. **ุญุณุงุจ ุงูุชุนุฑูุงุช ุงูุฒูููุฉ:** ุงูุชุญุณูู ุงูุญุงูู ูุนุชูุฏ ุนูู ุชูุฑูุจ. ููุญุตูู ุนูู ุญุณุงุจ ุฏููู 100%ุ ูุญุชุงุฌ ูุฑุงุกุงุช ููุตูุฉ ุจููุช (time-stamped readings).

2. **ุงูุชุญูู ูู ุงูุฏูุน:** ุชู ุชุทุจูู ุงูุชุญูู ุงูุฃุณุงุณู. ูููู ุชุญุณููู ูุงุญูุงู ุจุฅุถุงูุฉ polling ุฃู webhooks.

3. **ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช:** ุชู ุงุณุชุฎุฏุงู `notificationService` ุงูููุญุฏุ ููุง ูุณูู ุงูุตูุงูุฉ ูุงูุชุทููุฑ.

---

**ุงูุฎุทูุฉ ุงูุชุงููุฉ:** ูููู ุงููุชุงุจุนุฉ ูุน TODOs ุฃููููุฉ ูุชูุณุทุฉ ุนูุฏ ุงูุญุงุฌุฉ.
