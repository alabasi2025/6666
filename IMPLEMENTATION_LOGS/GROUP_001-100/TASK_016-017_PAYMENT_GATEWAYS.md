# โ Task 016-017: ุชูุนูู Payment Gateways (Moyasar & Sadad)

**ุงูุชุงุฑูุฎ:** 2026-01-08  
**ุงูุญุงูุฉ:** โ ููุชูู

---

## ๐ ุงูููุงู ุงูููุฌุฒุฉ:

### 1. ุฅูุดุงุก Services:

#### โ Moyasar Service (`server/developer/integrations/payment-gateways/moyasar.ts`)
- โ `testConnection()` - ุงุฎุชุจุงุฑ ุงูุงุชุตุงู
- โ `createPayment()` - ุฅูุดุงุก ูุนุงููุฉ ุฏูุน
- โ `getPayment()` - ุฌูุจ ูุนูููุงุช ุงููุนุงููุฉ
- โ `verifyPayment()` - ุงูุชุญูู ูู ุญุงูุฉ ุงูุฏูุน
- โ `refundPayment()` - ุงุณุชุฑุฏุงุฏ ุงููุนุงููุฉ
- โ `verifyWebhookSignature()` - ุงูุชุญูู ูู ุชูููุน Webhook

#### โ Sadad Service (`server/developer/integrations/payment-gateways/sadad.ts`)
- โ ููุณ ุงููุธุงุฆู ุงููุฐููุฑุฉ ุฃุนูุงู

---

### 2. ุชุญุฏูุซ Payment Gateways Router:

#### โ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู (ุงูุณุทุฑ 140)
- โ ุงุณุชุจุฏุงู TODO ุจู ุงุณุชุฏุนุงุก ูุนูู ููู Service
- โ ุฏุนู Moyasar ู Sadad

#### โ ุฅูุดุงุก ุงููุนุงููุฉ (ุงูุณุทุฑ 207)
- โ ุงุณุชุฏุนุงุก API ุงูุจูุงุจุฉ ูุฅูุดุงุก ุงููุนุงููุฉ
- โ ุญูุธ ุงุณุชุฌุงุจุฉ ุงูุจูุงุจุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุชุญุฏูุซ ุญุงูุฉ ุงููุนุงููุฉ
- โ ุฅุฑุฌุงุน `paymentUrl` ููุนููู

#### โ ุงูุชุญูู ูู ุงูุฏูุน (ุงูุณุทุฑ 463)
- โ ุฅุถุงูุฉ ุงูุชุญูู ุงูุชููุงุฆู ูู `getStatus`
- โ ุชุญุฏูุซ ุญุงูุฉ ุงููุนุงููุฉ ุญุณุจ ุงูุงุณุชุฌุงุจุฉ ูู ุงูุจูุงุจุฉ

#### โ HMAC Verification (Webhooks)
- โ ุชุญุฏูุซ `verifyMoyasarSignature` ูู `payment-webhooks.ts`
- โ ุชุญุฏูุซ `verifySadadSignature` ูู `payment-webhooks.ts`
- โ ุชุญุฏูุซ `verifyWebhookSignature` ูู `paymentGatewaysRouter.ts`

---

## ๐ ุงููุชุงุฆุฌ:

### TODOs ุงููุญุฐููุฉ:
- โ ุงูุณุทุฑ 140: `TODO: ุชูููุฐ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุงููุนูู` โ
- โ ุงูุณุทุฑ 207: `TODO: ุงุณุชุฏุนุงุก API ุจูุงุจุฉ ุงูุฏูุน ูุฅูุดุงุก ุงููุนุงููุฉ` โ
- โ ุงูุณุทุฑ 463: `TODO: ุชูููุฐ ุงุณุชุฏุนุงุก API ูุนูู ุญุณุจ ููุน ุงูุจูุงุจุฉ` โ
- โ ุงูุณุทุฑ 600 (webhooks): `TODO: ุชูููุฐ ุงูุชุญูู ุงููุนูู ุจุงุณุชุฎุฏุงู HMAC SHA256` โ
- โ ุงูุณุทุฑ 977: `TODO: ุชูููุฐ ุงูุชุญูู ุงููุนูู ุจุงุณุชุฎุฏุงู HMAC SHA256` โ

**ุฅุฌูุงูู TODOs ุงููุญุฐููุฉ: 5**

---

## ๐ง ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ุงููุทููุจุฉ:

```env
# Moyasar
MOYASAR_API_KEY=your_api_key
MOYASAR_API_URL=https://api.moyasar.com
MOYASAR_TEST_MODE=true
MOYASAR_WEBHOOK_SECRET=your_webhook_secret

# Sadad
SADAD_MERCHANT_ID=your_merchant_id
SADAD_TERMINAL_ID=your_terminal_id
SADAD_API_KEY=your_api_key
SADAD_SECRET_KEY=your_secret_key
SADAD_API_URL=https://api.sadad.com.sa
SADAD_TEST_MODE=true
SADAD_WEBHOOK_SECRET=your_webhook_secret

# App
APP_URL=http://localhost:3000
```

---

## โ ุงูููุฒุงุช ุงูููุฌุฒุฉ:

1. โ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ูุน ุงูุจูุงุจุงุช
2. โ ุฅูุดุงุก ูุนุงููุงุช ุฏูุน ุฌุฏูุฏุฉ
3. โ ุงูุชุญูู ูู ุญุงูุฉ ุงูุฏูุน ุชููุงุฆูุงู
4. โ ูุนุงูุฌุฉ Webhooks ูุน ุงูุชุญูู ุงูุขูู
5. โ ุฏุนู ุงูุงุณุชุฑุฏุงุฏ (Refund)
6. โ ุญูุธ ุฌููุน ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
7. โ ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุชุฃููุฏ ุงูุฏูุน

---

## ๐ ููุงุญุธุงุช:

- โ ุงูููุฏ ูุฏุนู ูุถุน ุงูุงุฎุชุจุงุฑ ูุงููุถุน ุงูุฅูุชุงุฌู
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุดุงููุฉ
- โ Logging ููุตู ููู ุงูุนูููุงุช
- โ ุฏุนู ููุง ุงูุจูุงุจุชูู (Moyasar & Sadad)
- โ ุงูุชุญูู ุงูุขูู ูู Webhooks ุจุงุณุชุฎุฏุงู HMAC SHA256

---

**ุงูุญุงูุฉ:** โ **ููุชูู 100%**
